<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fitness Planner v2</title>

  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    html, body {
      height: 100%;
      overflow: hidden;
      background: black;
      color: white;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
    }
    .soft-border { border: 1px solid rgba(255,255,255,0.08); }
    .glass-nav {
      background: rgba(255,255,255,0.08);
      backdrop-filter: blur(20px);
    }
  </style>
</head>
<body>
  <div id="root"></div>

<script type="text/babel">
/* -------------------------------------------------
   CONSTANTS + HELPERS
--------------------------------------------------*/
const WEEK_DAYS = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];
const getWeekdayIndex = d => d.getDay() === 0 ? 6 : d.getDay() - 1;
const isSameDay = (a,b) => a.toDateString() === b.toDateString();

/* -------------------------------------------------
   PROGRESS RING (CUSTOMISABLE)
--------------------------------------------------*/
function ProgressRing({ progress, color, size = 56 }) {
  const stroke = 6;
  const r = (size - stroke) / 2;
  const c = 2 * Math.PI * r;
  return (
    <svg width={size} height={size}>
      <circle r={r} cx={size/2} cy={size/2} stroke="rgba(255,255,255,0.1)" strokeWidth={stroke} fill="none" />
      <circle
        r={r}
        cx={size/2}
        cy={size/2}
        stroke={color}
        strokeWidth={stroke}
        fill="none"
        strokeLinecap="round"
        strokeDasharray={c}
        strokeDashoffset={c * (1 - progress)}
        style={{ transform: "rotate(-90deg)", transformOrigin: "50% 50%" }}
      />
    </svg>
  );
}

/* -------------------------------------------------
   APP
--------------------------------------------------*/
function App() {
  const today = new Date();

  /* SETTINGS */
  const [settings, setSettings] = React.useState(() => JSON.parse(localStorage.getItem("settings_v2")) || {
    name: "Alex",
    weeklyGymGoal: 3,
    weeklyRunGoal: 3,
    monthlyGymGoal: 12,
    monthlyRunGoal: 12,
    restTime: 60,
    gymColor: "#22c55e",
    runColor: "#38bdf8"
  });

  React.useEffect(() => {
    localStorage.setItem("settings_v2", JSON.stringify(settings));
  }, [settings]);

  /* DATA */
  const [weeklyPlan, setWeeklyPlan] = React.useState(() => JSON.parse(localStorage.getItem("weeklyPlan_v2")) || Object.fromEntries(WEEK_DAYS.map(d=>[d,null])));
  const [runPlan, setRunPlan] = React.useState(() => JSON.parse(localStorage.getItem("runPlan_v2")) || Object.fromEntries(WEEK_DAYS.map(d=>[d,null])));
  const [workoutLogs, setWorkoutLogs] = React.useState(() => JSON.parse(localStorage.getItem("workoutLogs_v2")) || []);
  const [runLogs, setRunLogs] = React.useState(() => JSON.parse(localStorage.getItem("runLogs_v2")) || []);

  React.useEffect(()=>localStorage.setItem("weeklyPlan_v2",JSON.stringify(weeklyPlan)),[weeklyPlan]);
  React.useEffect(()=>localStorage.setItem("runPlan_v2",JSON.stringify(runPlan)),[runPlan]);
  React.useEffect(()=>localStorage.setItem("workoutLogs_v2",JSON.stringify(workoutLogs)),[workoutLogs]);
  React.useEffect(()=>localStorage.setItem("runLogs_v2",JSON.stringify(runLogs)),[runLogs]);

  /* NAV */
  const [tab,setTab] = React.useState("home");

  /* STREAK */
  const streak = (() => {
    let s = 0;
    let cursor = new Date();
    while (true) {
      const day = cursor.toDateString();
      const didWorkout = workoutLogs.some(l => new Date(l.timestamp).toDateString() === day);
      const didRun = runLogs.some(l => new Date(l.timestamp).toDateString() === day);
      if (didWorkout || didRun) {
        s++; cursor.setDate(cursor.getDate()-1);
      } else break;
    }
    return s;
  })();

  /* WEEK PROGRESS */
  const weekStart = new Date(today); weekStart.setDate(today.getDate() - getWeekdayIndex(today));
  const gymDone = workoutLogs.filter(l => new Date(l.timestamp) >= weekStart).length;
  const runDone = runLogs.filter(l => new Date(l.timestamp) >= weekStart).length;

  /* HOME */
  const Home = (
    <div className="h-screen overflow-y-auto px-4 pt-6 pb-32">

      <h1 className="text-2xl font-semibold mb-3">Hey, {settings.name}</h1>

      {/* WEEK STRIP */}
      <div className="flex gap-2 mb-4 overflow-x-auto">
        {WEEK_DAYS.map((d,i)=>{
          const date = new Date(weekStart); date.setDate(weekStart.getDate()+i);
          const gym = weeklyPlan[d];
          const run = runPlan[d];
          return (
            <div key={d} className={`min-w-[56px] p-2 rounded-2xl soft-border bg-[#1C1C1E] ${isSameDay(date,today)?"border-red-500":""}`}>
              <p className="text-sm font-semibold">{date.getDate()}</p>
              <p className="text-xs text-[#8E8E93]">{d}</p>
              {(gym||run) && <div className="w-2 h-2 rounded-full mt-1" style={{background: gym&&run?"white":gym?settings.gymColor:settings.runColor}}></div>}
            </div>
          );
        })}
      </div>

      {/* WEEKLY PROGRESS */}
      <div className="space-y-3 mb-6">
        <div className="flex justify-between items-center bg-[#1C1C1E] p-4 rounded-2xl soft-border">
          <div>
            <p className="font-semibold">Gym this week</p>
            <p className="text-xs text-[#8E8E93]">{gymDone}/{settings.weeklyGymGoal}</p>
          </div>
          <ProgressRing progress={Math.min(1,gymDone/settings.weeklyGymGoal)} color={settings.gymColor} />
        </div>

        <div className="flex justify-between items-center bg-[#1C1C1E] p-4 rounded-2xl soft-border">
          <div>
            <p className="font-semibold">Runs this week</p>
            <p className="text-xs text-[#8E8E93]">{runDone}/{settings.weeklyRunGoal}</p>
          </div>
          <ProgressRing progress={Math.min(1,runDone/settings.weeklyRunGoal)} color={settings.runColor} />
        </div>
      </div>

      {/* TODAY / TOMORROW */}
      <div className="grid grid-cols-2 gap-3 mb-6">
        {[0,1].map(offset=>{
          const d = new Date(today); d.setDate(today.getDate()+offset);
          const wd = WEEK_DAYS[getWeekdayIndex(d)];
          return (
            <div key={offset} className="bg-[#1C1C1E] p-4 rounded-2xl soft-border">
              <p className="text-xs text-[#8E8E93]">{offset===0?"Today":"Tomorrow"}</p>
              <p className="font-semibold">{wd} {d.getDate()}</p>
              <p className="text-xs mt-2">üèãÔ∏è {weeklyPlan[wd]?.name || "No workout"}</p>
              <p className="text-xs">üèÉ {runPlan[wd]?.type || "No run"}</p>
            </div>
          );
        })}
      </div>

      {/* QUICK ACTIONS */}
      <div className="grid grid-cols-2 gap-3 mb-6">
        <button className="bg-[#1C1C1E] p-4 rounded-2xl soft-border">üèãÔ∏è New Workout</button>
        <button className="bg-[#1C1C1E] p-4 rounded-2xl soft-border">üèÉ New Run</button>
      </div>

      {/* MONTHLY GOALS */}
      <div className="bg-[#1C1C1E] p-4 rounded-2xl soft-border">
        <p className="font-semibold mb-2">Monthly Goals</p>
        <p className="text-xs">Gym: {workoutLogs.length}/{settings.monthlyGymGoal}</p>
        <p className="text-xs">Runs: {runLogs.length}/{settings.monthlyRunGoal}</p>
      </div>

      <div className="mt-4 text-xs">üî• {streak} day streak</div>

    </div>
  );

  /* SETTINGS */
  const Settings = (
    <div className="h-screen overflow-y-auto px-4 pt-6 pb-32">
      <h2 className="text-xl font-semibold mb-4">Settings</h2>

      <label className="text-sm">Name</label>
      <input className="w-full p-3 mb-3 rounded-xl bg-[#2C2C2E]" value={settings.name} onChange={e=>setSettings({...settings,name:e.target.value})} />

      <label className="text-sm">Rest Timer (seconds)</label>
      <input type="number" className="w-full p-3 mb-3 rounded-xl bg-[#2C2C2E]" value={settings.restTime} onChange={e=>setSettings({...settings,restTime:+e.target.value})} />

      <button
        onClick={()=>{ localStorage.clear(); location.reload(); }}
        className="w-full bg-red-500 text-white rounded-xl py-3 mt-6"
      >
        Reset App
      </button>
    </div>
  );

  return (
    <div className="relative h-screen">
      {tab==="home" && Home}
      {tab==="settings" && Settings}

      <div className="fixed bottom-4 left-0 right-0 flex justify-center">
        <div className="glass-nav soft-border rounded-2xl px-6 py-2 flex gap-8">
          <button onClick={()=>setTab("home")}>üè†</button>
          <button onClick={()=>setTab("settings")}>‚öôÔ∏è</button>
        </div>
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
