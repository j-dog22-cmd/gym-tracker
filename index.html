<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fitness Planner</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Fonts -->
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
    rel="stylesheet"
  />

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: black;
      color: white;
    }

    .soft-border {
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .glass-nav {
      background: rgba(255, 255, 255, 0.06);
      backdrop-filter: blur(20px);
    }

    .no-scrollbar::-webkit-scrollbar {
      display: none;
    }
  </style>
</head>

<body class="no-scrollbar">
  <div id="root"></div>

  <script type="text/babel">
  /* -------------------------------------------
   GLOBAL HELPERS & UTILITIES
-------------------------------------------- */

const WEEK_DAYS = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];

function getWeekdayIndex(date) {
  // Monday = 0 ... Sunday = 6
  const js = date.getDay(); // Sunday = 0
  return (js + 6) % 7;
}

function isSameDay(a, b) {
  return (
    a.getFullYear() === b.getFullYear() &&
    a.getMonth() === b.getMonth() &&
    a.getDate() === b.getDate()
  );
}

function getStartOfMonth(date) {
  return new Date(date.getFullYear(), date.getMonth(), 1);
}

function getEndOfMonth(date) {
  return new Date(date.getFullYear(), date.getMonth() + 1, 0);
}

function getWeekOfMonth(dayNumber) {
  // Week 1 = days 1‚Äì7, Week 2 = 8‚Äì14, etc.
  return Math.ceil(dayNumber / 7);
}

/* -------------------------------------------
   LOCAL STORAGE HELPERS
-------------------------------------------- */

function load(key, fallback) {
  try {
    const raw = localStorage.getItem(key);
    if (!raw) return fallback;
    return JSON.parse(raw);
  } catch {
    return fallback;
  }
}

function save(key, value) {
  localStorage.setItem(key, JSON.stringify(value));
}

/* -------------------------------------------
   PROGRESS RING COMPONENT
-------------------------------------------- */

function ProgressRing({ size = 80, progress = 0, color = "#22c55e" }) {
  const stroke = 6;
  const radius = (size - stroke) / 2;
  const circumference = 2 * Math.PI * radius;
  const offset = circumference * (1 - progress);

  return (
    <svg width={size} height={size}>
      <circle
        stroke="#2C2C2E"
        fill="transparent"
        strokeWidth={stroke}
        r={radius}
        cx={size / 2}
        cy={size / 2}
      />
      <circle
        stroke={color}
        fill="transparent"
        strokeWidth={stroke}
        strokeLinecap="round"
        strokeDasharray={circumference}
        strokeDashoffset={offset}
        r={radius}
        cx={size / 2}
        cy={size / 2}
        style={{ transition: "stroke-dashoffset 0.4s ease" }}
      />
    </svg>
  );
}
/* -------------------------------------------
   APP COMPONENT ‚Äî STATE & CORE LOGIC
-------------------------------------------- */

function App() {
  /* -------------------------------------------
     STATE: WORKOUTS, RUNS, SETTINGS
  -------------------------------------------- */

  const [weeklyPlan, setWeeklyPlan] = React.useState(
    load("weeklyPlan", {
      Monday: null,
      Tuesday: null,
      Wednesday: null,
      Thursday: null,
      Friday: null,
      Saturday: null,
      Sunday: null,
    })
  );

  const [runPlan, setRunPlan] = React.useState(
    load("runPlan", {
      Monday: null,
      Tuesday: null,
      Wednesday: null,
      Thursday: null,
      Friday: null,
      Saturday: null,
      Sunday: null,
    })
  );

  const [workoutLogs, setWorkoutLogs] = React.useState(
    load("workoutLogs", [])
  );

  const [runLogs, setRunLogs] = React.useState(
    load("runLogs", [])
  );

  const [settings, setSettings] = React.useState(
    load("settings", {
      showAffirmations: true,
      showWeeklyProgress: true,
      showMonthlyGoal: true,
      showGraphs: true,
    })
  );

  const [tab, setTab] = React.useState("home");

  /* -------------------------------------------
     STATE: MODALS
  -------------------------------------------- */

  const [showGymCreator, setShowGymCreator] = React.useState(false);
  const [showRunCreator, setShowRunCreator] = React.useState(false);
  const [showCreateChooser, setShowCreateChooser] = React.useState(false);

  /* -------------------------------------------
     STATE: WORKOUT CREATION
  -------------------------------------------- */

  const [newRoutineName, setNewRoutineName] = React.useState("");
  const [newExerciseName, setNewExerciseName] = React.useState("");
  const [newExerciseSets, setNewExerciseSets] = React.useState("");
  const [newExerciseReps, setNewExerciseReps] = React.useState("");
  const [tempExercises, setTempExercises] = React.useState([]);

  /* -------------------------------------------
     STATE: RUN CREATION
  -------------------------------------------- */

  const [newRunType, setNewRunType] = React.useState("");
  const [newRunDistance, setNewRunDistance] = React.useState("");
  const [newRunPace, setNewRunPace] = React.useState("");

  /* -------------------------------------------
     STATE: WORKOUT EXECUTION
  -------------------------------------------- */

  const [activeWorkout, setActiveWorkout] = React.useState(null);

  /* -------------------------------------------
     STATE: DAY DETAILS
  -------------------------------------------- */

  const [selectedDay, setSelectedDay] = React.useState(null);

  /* -------------------------------------------
     STATE: CALENDAR MONTH
  -------------------------------------------- */

  const today = new Date();
  const [currentMonth, setCurrentMonth] = React.useState(
    new Date(today.getFullYear(), today.getMonth(), 1)
  );

  /* -------------------------------------------
     SAVE TO LOCAL STORAGE ON CHANGE
  -------------------------------------------- */

  React.useEffect(() => save("weeklyPlan", weeklyPlan), [weeklyPlan]);
  React.useEffect(() => save("runPlan", runPlan), [runPlan]);
  React.useEffect(() => save("workoutLogs", workoutLogs), [workoutLogs]);
  React.useEffect(() => save("runLogs", runLogs), [runLogs]);
  React.useEffect(() => save("settings", settings), [settings]);

  /* -------------------------------------------
     CORE LOGIC ‚Äî ADD EXERCISE
  -------------------------------------------- */

  function addTempExercise() {
    if (!newExerciseName || !newExerciseSets || !newExerciseReps) return;

    setTempExercises([
      ...tempExercises,
      {
        name: newExerciseName,
        sets: Number(newExerciseSets),
        reps: Number(newExerciseReps),
      },
    ]);

    setNewExerciseName("");
    setNewExerciseSets("");
    setNewExerciseReps("");
  }

  /* -------------------------------------------
     CORE LOGIC ‚Äî SAVE NEW WORKOUT
  -------------------------------------------- */

  function saveNewRoutine() {
    if (!newRoutineName || tempExercises.length === 0) return;

    const routine = {
      name: newRoutineName,
      exercises: tempExercises,
    };

    // Save to library (logs are separate)
    const updated = { ...weeklyPlan };
    setWeeklyPlan(updated);

    // Reset modal
    setNewRoutineName("");
    setTempExercises([]);
    setShowGymCreator(false);
  }

  function saveNewRoutineToDay(day) {
    if (!newRoutineName || tempExercises.length === 0) return;

    const routine = {
      name: newRoutineName,
      exercises: tempExercises,
    };

    setWeeklyPlan({
      ...weeklyPlan,
      [day]: routine,
    });

    setNewRoutineName("");
    setTempExercises([]);
    setShowGymCreator(false);
  }

  /* -------------------------------------------
     CORE LOGIC ‚Äî SAVE NEW RUN
  -------------------------------------------- */

  function saveNewRunRoutine() {
    if (!newRunType || !newRunDistance || !newRunPace) return;

    const routine = {
      type: newRunType,
      distance: Number(newRunDistance),
      pace: newRunPace,
    };

    setRunPlan({ ...runPlan, Monday: runPlan.Monday }); // placeholder

    setNewRunType("");
    setNewRunDistance("");
    setNewRunPace("");
    setShowRunCreator(false);
  }

  /* -------------------------------------------
     CORE LOGIC ‚Äî START WORKOUT
  -------------------------------------------- */

  function startWorkout(routine) {
    const completed = routine.exercises.map((ex) =>
      Array(ex.sets).fill(false)
    );

    setActiveWorkout({
      routine,
      completed,
      resting: false,
      restTime: 0,
    });

    setTab("workout");
  }

  /* -------------------------------------------
     CORE LOGIC ‚Äî COMPLETE SET
  -------------------------------------------- */

  function completeSet(exIndex, setIndex) {
    if (!activeWorkout) return;

    const updated = { ...activeWorkout };
    updated.completed[exIndex][setIndex] = true;

    // Start rest timer
    updated.resting = true;
    updated.restTime = 60;

    setActiveWorkout(updated);

    const interval = setInterval(() => {
      setActiveWorkout((prev) => {
        if (!prev) return prev;

        if (prev.restTime <= 1) {
          clearInterval(interval);
          return { ...prev, resting: false, restTime: 0 };
        }

        return { ...prev, restTime: prev.restTime - 1 };
      });
    }, 1000);
  }

  /* -------------------------------------------
     CORE LOGIC ‚Äî FINISH WORKOUT
  -------------------------------------------- */

  function finishWorkout() {
    if (!activeWorkout) return;

    const log = {
      date: new Date().toISOString(),
      routine: activeWorkout.routine.name,
    };

    setWorkoutLogs([...workoutLogs, log]);
    setActiveWorkout(null);
    setTab("home");
  }

  /* -------------------------------------------
     CORE LOGIC ‚Äî DELETE ROUTINES
  -------------------------------------------- */

  function deleteGymRoutine(name) {
    const updated = { ...weeklyPlan };

    for (const day of WEEK_DAYS) {
      if (updated[day] && updated[day].name === name) {
        updated[day] = null;
      }
    }

    setWeeklyPlan(updated);
  }

  function deleteRunRoutine(type) {
    const updated = { ...runPlan };

    for (const day of WEEK_DAYS) {
      if (updated[day] && updated[day].type === type) {
        updated[day] = null;
      }
    }

    setRunPlan(updated);
  }

  /* -------------------------------------------
     CORE LOGIC ‚Äî DAY DETAILS
  -------------------------------------------- */

  function openDayDetails(dayObj) {
    setSelectedDay(dayObj);
  }

  function closeDayDetails() {
    setSelectedDay(null);
  }

  /* -------------------------------------------
     CORE LOGIC ‚Äî RESET APP
  -------------------------------------------- */

  function resetApp() {
    localStorage.clear();
    window.location.reload();
  }
/* -------------------------------------------
   HOME TAB (UPDATED)
-------------------------------------------- */

const HomeTab = (() => {
  const todayDate = new Date();
  const todayWeekday = WEEK_DAYS[getWeekdayIndex(todayDate)];
  const todayNumber = todayDate.getDate();

  // Affirmations (only if enabled)
  const affirmations = [
    "Small steps add up.",
    "Stay consistent.",
    "You‚Äôre building momentum.",
    "Show up for yourself.",
    "Progress feels good.",
  ];
  const affirmationIndex = todayNumber % affirmations.length;

  // Start of this week (Mon‚ÄìSun)
  const startOfWeek = (() => {
    const d = new Date(todayDate);
    const offset = getWeekdayIndex(d);
    d.setDate(d.getDate() - offset);
    return d;
  })();

  const weekDaysWithDates = WEEK_DAYS.map((day, idx) => {
    const d = new Date(startOfWeek);
    d.setDate(startOfWeek.getDate() + idx);
    return { label: day, date: d };
  });

  // Weekly progress
  const completedWorkoutsThisWeek = workoutLogs.filter((log) => {
    const d = new Date(log.date);
    return (
      d >= startOfWeek &&
      d <= new Date(startOfWeek.getFullYear(), startOfWeek.getMonth(), startOfWeek.getDate() + 6)
    );
  }).length;

  const runCompletedThisWeek = runLogs.filter((log) => {
    const d = new Date(log.date);
    return (
      d >= startOfWeek &&
      d <= new Date(startOfWeek.getFullYear(), startOfWeek.getMonth(), startOfWeek.getDate() + 6)
    );
  }).length;

  const WEEKLY_GYM_GOAL = 4;
  const WEEKLY_RUN_GOAL = 3;

  const gymProgress = Math.min(completedWorkoutsThisWeek / WEEKLY_GYM_GOAL, 1);
  const runProgress = Math.min(runCompletedThisWeek / WEEKLY_RUN_GOAL, 1);

  // Monthly goal
  const startOfMonth = getStartOfMonth(todayDate);
  const endOfMonth = getEndOfMonth(todayDate);

  const workoutsThisMonth = workoutLogs.filter((log) => {
    const d = new Date(log.date);
    return d >= startOfMonth && d <= endOfMonth;
  }).length;

  const MONTHLY_WORKOUT_GOAL = 16;
  const monthlyProgress = Math.min(workoutsThisMonth / MONTHLY_WORKOUT_GOAL, 1);

  return (
    <div className="w-full min-h-screen overflow-y-auto bg-black pb-40 px-4 pt-6">

      {/* MOTIVATIONAL HEADER */}
      {settings.showAffirmations && (
        <div className="mb-4">
          <p className="text-xs text-[#8E8E93] mb-1">
            {affirmations[affirmationIndex]}
          </p>
          <div className="flex items-baseline gap-2">
            <h1 className="text-2xl font-semibold leading-tight">Today</h1>
            <span className="text-sm text-[#8E8E93]">
              {todayWeekday}, {todayNumber}
            </span>
          </div>
        </div>
      )}

      {/* WEEK STRIP */}
      <h2 className="text-lg font-semibold mb-2">This Week</h2>

      <div className="flex justify-between mb-4">
        {weekDaysWithDates.map(({ label, date }) => {
          const weekday = label;
          const gym = weeklyPlan[weekday];
          const run = runPlan[weekday];
          const isToday = isSameDay(date, todayDate);

          let dotColor = null;
          if (gym && run) dotColor = "bg-white";
          else if (gym) dotColor = "bg-green-400";
          else if (run) dotColor = "bg-blue-400";

          return (
            <button
              key={weekday}
              onClick={() => openDayDetails({ weekday, date })}
              className={`
                w-12 p-3 rounded-3xl soft-border bg-[#1C1C1E]
                flex flex-col items-center transition-all
                ${isToday ? "border border-red-500" : ""}
              `}
            >
              <p className="text-base font-semibold leading-none">
                {date.getDate()}
              </p>
              <p className="text-xs text-[#8E8E93] leading-none mt-1">
                {weekday.slice(0, 2)}
              </p>
              {dotColor && (
                <div className={`w-2 h-2 ${dotColor} rounded-full mt-1`} />
              )}
            </button>
          );
        })}
      </div>

      {/* WEEKLY PROGRESS BLOCKS */}
      {settings.showWeeklyProgress && (
        <div className="space-y-3 mb-6">

          {/* GYM PROGRESS */}
          <div className="w-full bg-[#1C1C1E] soft-border rounded-2xl p-4 flex items-center justify-between">
            <div>
              <p className="text-sm font-semibold mb-1">Gym Progress</p>
              <p className="text-xs text-[#8E8E93]">
                {completedWorkoutsThisWeek}/{WEEKLY_GYM_GOAL} workouts this week
              </p>
            </div>
            <ProgressRing size={80} progress={gymProgress} color="#22c55e" />
          </div>

          {/* RUN PROGRESS */}
          <div className="w-full bg-[#1C1C1E] soft-border rounded-2xl p-4 flex items-center justify-between">
            <div>
              <p className="text-sm font-semibold mb-1">Running Progress</p>
              <p className="text-xs text-[#8E8E93]">
                {runCompletedThisWeek}/{WEEKLY_RUN_GOAL} runs this week
              </p>
            </div>
            <ProgressRing size={80} progress={runProgress} color="#38bdf8" />
          </div>

        </div>
      )}

      {/* TODAY & TOMORROW BOXES */}
      <h2 className="text-lg font-semibold mb-3">Your Plan</h2>

      <div className="grid grid-cols-2 gap-3 mb-10">
        {[{ label: "Today", day: todayWeekday },
          { label: "Tomorrow", day: WEEK_DAYS[(getWeekdayIndex(todayDate) + 1) % 7] }].map(
          ({ label, day }) => {
            const gym = weeklyPlan[day];
            const run = runPlan[day];

            const idx = WEEK_DAYS.indexOf(day);
            const d = new Date(startOfWeek);
            d.setDate(startOfWeek.getDate() + idx);

            return (
              <button
                key={day}
                onClick={() => openDayDetails({ weekday: day, date: d })}
                className="bg-[#1C1C1E] p-4 rounded-2xl soft-border text-left"
              >
                <p className="text-xs text-[#8E8E93] mb-1">{label}</p>
                <p className="text-sm font-semibold mb-2">
                  {day} {d.getDate()}
                </p>

                {gym ? (
                  <p className="text-xs text-green-400 mb-1">
                    üèãÔ∏è {gym.name}
                  </p>
                ) : (
                  <p className="text-xs text-[#8E8E93] mb-1">
                    üèãÔ∏è No workout
                  </p>
                )}

                {run ? (
                  <p className="text-xs text-blue-400">
                    üèÉ {run.type}
                  </p>
                ) : (
                  <p className="text-xs text-[#8E8E93]">
                    üèÉ No run
                  </p>
                )}
              </button>
            );
          }
        )}
      </div>

      {/* MONTHLY GOAL ‚Äî MOVED TO BOTTOM */}
      {settings.showMonthlyGoal && (
        <div className="mb-6 bg-[#1C1C1E] rounded-2xl soft-border p-4">
          <div className="flex justify-between items-center mb-2">
            <p className="text-sm font-semibold">Monthly Goal</p>
            <p className="text-xs text-[#8E8E93]">
              {workoutsThisMonth}/{MONTHLY_WORKOUT_GOAL} workouts
            </p>
          </div>

          <div className="w-full h-2 rounded-full bg-[#2C2C2E] overflow-hidden mb-3">
            <div
              className="h-full rounded-full bg-gradient-to-r from-green-400 to-emerald-500 transition-all"
              style={{ width: `${monthlyProgress * 100}%` }}
            />
          </div>

          <p className="text-xs text-[#8E8E93]">
            Keep pushing ‚Äî consistency builds results.
          </p>
        </div>
      )}

    </div>
  );
})();
/* -------------------------------------------
   CALENDAR TAB (WITH WEEKLY LINE GRAPHS)
-------------------------------------------- */

const CalendarTab = (() => {
  /* -------------------------------------------
     SWIPE HANDLERS
  -------------------------------------------- */

  let touchStartX = 0;
  let touchEndX = 0;

  function handleTouchStart(e) {
    touchStartX = e.changedTouches[0].screenX;
  }

  function handleTouchEnd(e) {
    touchEndX = e.changedTouches[0].screenX;
    handleSwipe();
  }

  function handleSwipe() {
    const diff = touchEndX - touchStartX;
    if (Math.abs(diff) < 50) return;

    if (diff < 0) goNextMonth();
    if (diff > 0) goPrevMonth();
  }

  function goNextMonth() {
    const next = new Date(currentMonth);
    next.setMonth(next.getMonth() + 1);
    setCurrentMonth(next);
  }

  function goPrevMonth() {
    const prev = new Date(currentMonth);
    prev.setMonth(prev.getMonth() - 1);
    setCurrentMonth(prev);
  }

  /* -------------------------------------------
     CALENDAR GRID GENERATION
  -------------------------------------------- */

  const year = currentMonth.getFullYear();
  const month = currentMonth.getMonth();

  const firstDay = new Date(year, month, 1);
  const lastDay = new Date(year, month + 1, 0);

  const days = [];
  for (let d = 1; d <= lastDay.getDate(); d++) {
    const date = new Date(year, month, d);
    days.push({
      date,
      key: `${year}-${month + 1}-${d}`,
      weekday: WEEK_DAYS[getWeekdayIndex(date)],
    });
  }

  const leadingBlanks = getWeekdayIndex(firstDay);
  const paddedDays = [
    ...Array(leadingBlanks).fill({ blank: true }),
    ...days,
  ];

  /* -------------------------------------------
     WEEKLY GRAPH DATA (GYM + RUNS)
  -------------------------------------------- */

  const startOfMonth = new Date(year, month, 1);
  const endOfMonth = new Date(year, month + 1, 0);

  // Weekly buckets: Week 1‚Äì5
  const gymWeekly = [0, 0, 0, 0, 0];
  const runWeekly = [0, 0, 0, 0, 0];

  workoutLogs.forEach((log) => {
    const d = new Date(log.date);
    if (d >= startOfMonth && d <= endOfMonth) {
      const week = getWeekOfMonth(d.getDate()) - 1;
      gymWeekly[week]++;
    }
  });

  runLogs.forEach((log) => {
    const d = new Date(log.date);
    if (d >= startOfMonth && d <= endOfMonth) {
      const week = getWeekOfMonth(d.getDate()) - 1;
      runWeekly[week]++;
    }
  });

  /* -------------------------------------------
     GRAPH COMPONENT (WEEKLY LINE GRAPH)
  -------------------------------------------- */

  function WeeklyLineGraph({ title, data, color }) {
    const maxVal = Math.max(...data, 1);
    const points = data.map((v, i) => {
      const x = (i / 4) * 100;
      const y = 100 - (v / maxVal) * 100;
      return `${x},${y}`;
    }).join(" ");

    return (
      <div className="bg-[#1C1C1E] soft-border rounded-2xl p-4 mb-4">
        <p className="text-sm font-semibold mb-2">{title}</p>

        <svg viewBox="0 0 100 100" className="w-full h-24">
          {/* Line */}
          <polyline
            fill="none"
            stroke={color}
            strokeWidth="2"
            points={points}
            strokeLinecap="round"
          />

          {/* Dots */}
          {data.map((v, i) => {
            const x = (i / 4) * 100;
            const y = 100 - (v / maxVal) * 100;
            return (
              <circle
                key={i}
                cx={x}
                cy={y}
                r="2.5"
                fill="white"
              />
            );
          })}
        </svg>

        <div className="flex justify-between text-xs text-[#8E8E93] mt-1">
          <span>W1</span>
          <span>W2</span>
          <span>W3</span>
          <span>W4</span>
          <span>W5</span>
        </div>
      </div>
    );
  }

  /* -------------------------------------------
     RENDER CALENDAR TAB
  -------------------------------------------- */

  return (
    <div
      className="w-full min-h-screen overflow-y-auto bg-black px-4 pt-6 pb-40"
      onTouchStart={handleTouchStart}
      onTouchEnd={handleTouchEnd}
    >
      {/* MONTH HEADER */}
      <div className="text-xl font-semibold tracking-tight mb-2 text-center">
        {currentMonth.toLocaleString("default", {
          month: "long",
          year: "numeric",
        })}
      </div>

      {/* WEEKDAY LABELS */}
      <div className="grid grid-cols-7 gap-1 text-center text-xs text-[#8E8E93] mb-1">
        {["M", "T", "W", "T", "F", "S", "S"].map((d, i) => (
          <div key={i}>{d}</div>
        ))}
      </div>

      {/* CALENDAR GRID */}
      <div className="grid grid-cols-7 gap-1 text-center mb-6">
        {paddedDays.map((d, index) => {
          if (d.blank) return <div key={"blank-" + index}></div>;

          const isToday =
            new Date().toDateString() === d.date.toDateString();

          return (
            <button
              key={d.key}
              onClick={() => openDayDetails(d)}
              className={`py-1 rounded-lg text-sm ${
                isToday
                  ? "bg-red-500 text-white font-semibold"
                  : "bg-[#1C1C1E] text-white"
              }`}
            >
              {d.date.getDate()}
            </button>
          );
        })}
      </div>

      {/* WEEKLY GRAPHS */}
      {settings.showGraphs && (
        <>
          <WeeklyLineGraph
            title="Gym Workouts (Weekly)"
            data={gymWeekly}
            color="#22c55e"
          />

          <WeeklyLineGraph
            title="Runs Completed (Weekly)"
            data={runWeekly}
            color="#38bdf8"
          />
        </>
      )}

      {/* DAY DETAILS MODAL */}
      {selectedDay && (
        <div className="fixed inset-0 bg-black bg-opacity-60 flex items-end z-[999]">
          <div className="w-full bg-[#1C1C1E] rounded-t-3xl p-6 soft-border">

            <div className="flex justify-between items-center mb-4">
              <h2 className="text-xl font-semibold">
                {selectedDay.date.toDateString()}
              </h2>

              <button
                onClick={closeDayDetails}
                className="text-sm text-[#8E8E93]"
              >
                Close
              </button>
            </div>

            {/* GYM DETAILS */}
            {(() => {
              const weekday = selectedDay.weekday;
              const routine = weeklyPlan[weekday];

              if (!routine) {
                return (
                  <p className="text-sm text-[#8E8E93] mb-4">
                    No gym routine
                  </p>
                );
              }

              return (
                <div className="mb-6">
                  <h3 className="text-lg font-semibold mb-2">Workout</h3>

                  <div className="bg-[#2C2C2E] p-4 rounded-xl soft-border mb-3">
                    <p className="font-semibold mb-1">{routine.name}</p>

                    <ul className="text-sm text-[#E5E5EA] space-y-1">
                      {routine.exercises.map((ex, i) => (
                        <li key={i}>
                          {ex.name} ‚Äî {ex.sets}√ó{ex.reps}
                        </li>
                      ))}
                    </ul>
                  </div>

                  <button
                    onClick={() => deleteGymRoutine(routine.name)}
                    className="w-full bg-red-500 text-white rounded-xl py-2 mt-3 font-semibold"
                  >
                    Delete Workout
                  </button>

                  <button
                    onClick={() => startWorkout(routine)}
                    className="w-full bg-white text-black rounded-xl py-3 font-semibold mt-3"
                  >
                    Start Today‚Äôs Workout
                  </button>
                </div>
              );
            })()}

            {/* RUN DETAILS */}
            {(() => {
              const weekday = selectedDay.weekday;
              const routine = runPlan[weekday];

              if (!routine) {
                return (
                  <p className="text-sm text-[#8E8E93] mb-4">
                    No running routine
                  </p>
                );
              }

              return (
                <div className="mb-4">
                  <p className="text-blue-400 text-sm font-semibold mb-1">
                    Run: {routine.type}
                  </p>
                  <p className="text-sm text-[#8E8E93]">
                    {routine.distance} km ‚Äî {routine.pace}
                  </p>

                  <button
                    onClick={() => deleteRunRoutine(routine.type)}
                    className="w-full bg-red-500 text-white rounded-xl py-2 mt-3 font-semibold"
                  >
                    Delete Run
                  </button>
                </div>
              );
            })()}

          </div>
        </div>
      )}
    </div>
  );
})();
  /* -------------------------------------------
   WORKOUT EXECUTION SCREEN
-------------------------------------------- */

const WorkoutScreen = (() => {
  if (!activeWorkout) {
    return (
      <div className="w-full min-h-screen bg-black text-center pt-20">
        <p className="text-[#8E8E93]">No active workout</p>
      </div>
    );
  }

  const routine = activeWorkout.routine;
  const completed = activeWorkout.completed;

  return (
    <div className="w-full min-h-screen bg-black px-4 pt-6 pb-40">
      {/* HEADER */}
      <div className="flex justify-between items-center mb-6">
        <h1 className="text-xl font-semibold">{routine.name}</h1>

        <button
          onClick={() => setActiveWorkout(null)}
          className="text-sm text-[#8E8E93]"
        >
          Exit
        </button>
      </div>

      {/* REST TIMER */}
      {activeWorkout.resting && (
        <div className="mb-6 bg-[#1C1C1E] soft-border rounded-2xl p-4 text-center">
          <p className="text-sm text-[#8E8E93] mb-1">Resting</p>
          <p className="text-3xl font-semibold">
            {activeWorkout.restTime}s
          </p>
        </div>
      )}

      {/* EXERCISES */}
      <div className="space-y-6">
        {routine.exercises.map((ex, exIndex) => (
          <div
            key={exIndex}
            className="bg-[#1C1C1E] soft-border rounded-2xl p-4"
          >
            <p className="text-sm font-semibold mb-2">{ex.name}</p>

            <div className="flex gap-2 flex-wrap">
              {completed[exIndex].map((isDone, setIndex) => (
                <button
                  key={setIndex}
                  onClick={() => completeSet(exIndex, setIndex)}
                  disabled={isDone || activeWorkout.resting}
                  className={`
                    w-12 h-12 rounded-xl flex items-center justify-center
                    text-sm font-semibold transition-all
                    ${
                      isDone
                        ? "bg-green-500 text-black"
                        : "bg-[#2C2C2E] text-white soft-border"
                    }
                    ${activeWorkout.resting ? "opacity-40" : ""}
                  `}
                >
                  {setIndex + 1}
                </button>
              ))}
            </div>
          </div>
        ))}
      </div>

      {/* FINISH BUTTON */}
      <button
        onClick={finishWorkout}
        className="w-full bg-white text-black rounded-2xl py-3 font-semibold mt-10"
      >
        Finish Workout
      </button>
    </div>
  );
})();
  /* -------------------------------------------
   MODALS ‚Äî GYM CREATOR, RUN CREATOR, CHOOSER
-------------------------------------------- */

function ModalWrapper({ children, onClose }) {
  return (
    <div className="fixed inset-0 bg-black bg-opacity-60 flex items-end z-[999]">
      <div className="w-full bg-[#1C1C1E] rounded-t-3xl p-6 soft-border">
        <div className="flex justify-end mb-4">
          <button
            onClick={onClose}
            className="text-sm text-[#8E8E93]"
          >
            Close
          </button>
        </div>
        {children}
      </div>
    </div>
  );
}

/* -------------------------------------------
   CREATE CHOOSER MODAL
-------------------------------------------- */

const CreateChooserModal = () => (
  <ModalWrapper onClose={() => setShowCreateChooser(false)}>
    <h2 className="text-xl font-semibold mb-4">Create</h2>

    <div className="space-y-3">
      <button
        onClick={() => {
          setShowCreateChooser(false);
          setShowGymCreator(true);
        }}
        className="w-full bg-[#2C2C2E] soft-border rounded-xl py-3 font-semibold"
      >
        New Workout
      </button>

      <button
        onClick={() => {
          setShowCreateChooser(false);
          setShowRunCreator(true);
        }}
        className="w-full bg-[#2C2C2E] soft-border rounded-xl py-3 font-semibold"
      >
        New Run
      </button>
    </div>
  </ModalWrapper>
);

/* -------------------------------------------
   GYM CREATOR MODAL
-------------------------------------------- */

const GymCreatorModal = () => (
  <ModalWrapper onClose={() => setShowGymCreator(false)}>
    <h2 className="text-xl font-semibold mb-4">New Workout</h2>

    {/* Routine Name */}
    <div className="mb-4">
      <p className="text-sm text-[#8E8E93] mb-1">Routine Name</p>
      <input
        value={newRoutineName}
        onChange={(e) => setNewRoutineName(e.target.value)}
        className="w-full bg-[#2C2C2E] soft-border rounded-xl p-3 text-sm"
        placeholder="Push Day"
      />
    </div>

    {/* Add Exercise */}
    <div className="mb-4">
      <p className="text-sm text-[#8E8E93] mb-2">Add Exercise</p>

      <input
        value={newExerciseName}
        onChange={(e) => setNewExerciseName(e.target.value)}
        className="w-full bg-[#2C2C2E] soft-border rounded-xl p-3 text-sm mb-2"
        placeholder="Bench Press"
      />

      <div className="flex gap-2 mb-2">
        <input
          value={newExerciseSets}
          onChange={(e) => setNewExerciseSets(e.target.value)}
          className="w-1/2 bg-[#2C2C2E] soft-border rounded-xl p-3 text-sm"
          placeholder="Sets"
          type="number"
        />
        <input
          value={newExerciseReps}
          onChange={(e) => setNewExerciseReps(e.target.value)}
          className="w-1/2 bg-[#2C2C2E] soft-border rounded-xl p-3 text-sm"
          placeholder="Reps"
          type="number"
        />
      </div>

      <button
        onClick={addTempExercise}
        className="w-full bg-white text-black rounded-xl py-2 font-semibold"
      >
        Add Exercise
      </button>
    </div>

    {/* Exercise List */}
    {tempExercises.length > 0 && (
      <div className="mb-6">
        <p className="text-sm font-semibold mb-2">Exercises</p>
        <div className="space-y-2">
          {tempExercises.map((ex, i) => (
            <div
              key={i}
              className="bg-[#2C2C2E] soft-border rounded-xl p-3 text-sm"
            >
              {ex.name} ‚Äî {ex.sets}√ó{ex.reps}
            </div>
          ))}
        </div>
      </div>
    )}

    {/* Save */}
    <button
      onClick={saveNewRoutine}
      className="w-full bg-green-500 text-black rounded-xl py-3 font-semibold"
    >
      Save Workout
    </button>
  </ModalWrapper>
);

/* -------------------------------------------
   RUN CREATOR MODAL
-------------------------------------------- */

const RunCreatorModal = () => (
  <ModalWrapper onClose={() => setShowRunCreator(false)}>
    <h2 className="text-xl font-semibold mb-4">New Run</h2>

    {/* Run Type */}
    <div className="mb-4">
      <p className="text-sm text-[#8E8E93] mb-1">Run Type</p>
      <input
        value={newRunType}
        onChange={(e) => setNewRunType(e.target.value)}
        className="w-full bg-[#2C2C2E] soft-border rounded-xl p-3 text-sm"
        placeholder="Easy Run"
      />
    </div>

    {/* Distance */}
    <div className="mb-4">
      <p className="text-sm text-[#8E8E93] mb-1">Distance (km)</p>
      <input
        value={newRunDistance}
        onChange={(e) => setNewRunDistance(e.target.value)}
        className="w-full bg-[#2C2C2E] soft-border rounded-xl p-3 text-sm"
        placeholder="5"
        type="number"
      />
    </div>

    {/* Pace */}
    <div className="mb-6">
      <p className="text-sm text-[#8E8E93] mb-1">Pace</p>
      <input
        value={newRunPace}
        onChange={(e) => setNewRunPace(e.target.value)}
        className="w-full bg-[#2C2C2E] soft-border rounded-xl p-3 text-sm"
        placeholder="5:30 /km"
      />
    </div>

    {/* Save */}
    <button
      onClick={saveNewRunRoutine}
      className="w-full bg-blue-500 text-black rounded-xl py-3 font-semibold"
    >
      Save Run
    </button>
  </ModalWrapper>
);
  /* -------------------------------------------
   SETTINGS TAB
-------------------------------------------- */

const SettingsTab = (() => {
  function toggleSetting(key) {
    setSettings({
      ...settings,
      [key]: !settings[key],
    });
  }

  return (
    <div className="w-full min-h-screen bg-black px-4 pt-6 pb-40">
      <h1 className="text-xl font-semibold mb-6">Settings</h1>

      {/* TOGGLES */}
      <div className="space-y-4 mb-10">

        {/* Affirmations */}
        <div className="bg-[#1C1C1E] soft-border rounded-2xl p-4 flex justify-between items-center">
          <div>
            <p className="text-sm font-semibold">Show Affirmations</p>
            <p className="text-xs text-[#8E8E93]">Daily motivational message</p>
          </div>

          <button
            onClick={() => toggleSetting("showAffirmations")}
            className={`
              w-12 h-6 rounded-full transition-all
              ${settings.showAffirmations ? "bg-green-500" : "bg-[#2C2C2E]"}
            `}
          >
            <div
              className={`
                w-5 h-5 bg-white rounded-full transform transition-all
                ${settings.showAffirmations ? "translate-x-6" : "translate-x-1"}
              `}
            />
          </button>
        </div>

        {/* Weekly Progress */}
        <div className="bg-[#1C1C1E] soft-border rounded-2xl p-4 flex justify-between items-center">
          <div>
            <p className="text-sm font-semibold">Show Weekly Progress</p>
            <p className="text-xs text-[#8E8E93]">Gym + running progress rings</p>
          </div>

          <button
            onClick={() => toggleSetting("showWeeklyProgress")}
            className={`
              w-12 h-6 rounded-full transition-all
              ${settings.showWeeklyProgress ? "bg-green-500" : "bg-[#2C2C2E]"}
            `}
          >
            <div
              className={`
                w-5 h-5 bg-white rounded-full transform transition-all
                ${settings.showWeeklyProgress ? "translate-x-6" : "translate-x-1"}
              `}
            />
          </button>
        </div>

        {/* Monthly Goal */}
        <div className="bg-[#1C1C1E] soft-border rounded-2xl p-4 flex justify-between items-center">
          <div>
            <p className="text-sm font-semibold">Show Monthly Goal</p>
            <p className="text-xs text-[#8E8E93]">Workout target for the month</p>
          </div>

          <button
            onClick={() => toggleSetting("showMonthlyGoal")}
            className={`
              w-12 h-6 rounded-full transition-all
              ${settings.showMonthlyGoal ? "bg-green-500" : "bg-[#2C2C2E]"}
            `}
          >
            <div
              className={`
                w-5 h-5 bg-white rounded-full transform transition-all
                ${settings.showMonthlyGoal ? "translate-x-6" : "translate-x-1"}
              `}
            />
          </button>
        </div>

        {/* Graphs */}
        <div className="bg-[#1C1C1E] soft-border rounded-2xl p-4 flex justify-between items-center">
          <div>
            <p className="text-sm font-semibold">Show Graphs</p>
            <p className="text-xs text-[#8E8E93]">Weekly gym + run graphs</p>
          </div>

          <button
            onClick={() => toggleSetting("showGraphs")}
            className={`
              w-12 h-6 rounded-full transition-all
              ${settings.showGraphs ? "bg-green-500" : "bg-[#2C2C2E]"}
            `}
          >
            <div
              className={`
                w-5 h-5 bg-white rounded-full transform transition-all
                ${settings.showGraphs ? "translate-x-6" : "translate-x-1"}
              `}
            />
          </button>
        </div>

      </div>

      {/* RESET APP */}
      <div className="bg-[#1C1C1E] soft-border rounded-2xl p-4 mb-10">
        <p className="text-sm font-semibold mb-2">Reset App</p>
        <p className="text-xs text-[#8E8E93] mb-4">
          Clears all workouts, runs, logs, and settings.
        </p>

        <button
          onClick={resetApp}
          className="w-full bg-red-500 text-white rounded-xl py-3 font-semibold"
        >
          Reset Everything
        </button>
      </div>

      {/* ABOUT */}
      <div className="bg-[#1C1C1E] soft-border rounded-2xl p-4">
        <p className="text-sm font-semibold mb-1">About</p>
        <p className="text-xs text-[#8E8E93]">
          Fitness Planner ‚Äî built for clarity, consistency, and momentum.
        </p>
      </div>
    </div>
  );
})();
  /* -------------------------------------------
   FINAL APP RENDER + NAVIGATION + FLOATING BUTTON
-------------------------------------------- */

  return (
    <div className="relative w-full min-h-screen bg-black">

      {/* ACTIVE TAB */}
      {tab === "home" && <HomeTab />}
      {tab === "calendar" && <CalendarTab />}
      {tab === "workout" && <WorkoutScreen />}
      {tab === "settings" && <SettingsTab />}

      {/* FLOATING + BUTTON (TOP RIGHT) */}
      {tab !== "workout" && (
        <button
          onClick={() => setShowCreateChooser(true)}
          className="
            fixed top-4 right-4
            w-10 h-10
            rounded-full
            bg-[#1C1C1E]
            soft-border
            flex items-center justify-center
            text-white
            shadow-lg
            z-[999]
          "
        >
          <span className="text-xl leading-none">+</span>
        </button>
      )}

      {/* BOTTOM NAVIGATION */}
      <div
        className="
          fixed bottom-0 left-0 w-full
          glass-nav soft-border
          border-t border-white/10
          flex justify-around items-center
          py-3
          z-[998]
        "
      >
        <button
          onClick={() => setTab("home")}
          className={`text-sm ${
            tab === "home" ? "text-white font-semibold" : "text-[#8E8E93]"
          }`}
        >
          Home
        </button>

        <button
          onClick={() => setTab("calendar")}
          className={`text-sm ${
            tab === "calendar" ? "text-white font-semibold" : "text-[#8E8E93]"
          }`}
        >
          Calendar
        </button>

        <button
          onClick={() => setTab("settings")}
          className={`text-sm ${
            tab === "settings" ? "text-white font-semibold" : "text-[#8E8E93]"
          }`}
        >
          Settings
        </button>
      </div>

      {/* MODALS */}
      {showCreateChooser && <CreateChooserModal />}
      {showGymCreator && <GymCreatorModal />}
      {showRunCreator && <RunCreatorModal />}

    </div>
  );
}

/* -------------------------------------------
   RENDER APP
-------------------------------------------- */

ReactDOM.render(<App />, document.getElementById("root"));
  </script>
</body>
</html>
