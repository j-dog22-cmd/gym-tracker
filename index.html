<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Fitness Planner</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        background: black;
        height: 100%;
        width: 100%;
      }

      #root {
        height: 100%;
        width: 100%;
      }

      .soft-border {
        box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.06);
      }

      .glass-nav {
        background: rgba(28, 28, 30, 0.9);
        backdrop-filter: blur(20px);
      }

      .bottom-sheet-backdrop {
        background: rgba(0, 0, 0, 0.5);
      }
    </style>
  </head>
  <body class="bg-black text-white">
    <div id="root"></div>

    <script type="text/babel">
      const WEEK_DAYS = [
        "Monday",
        "Tuesday",
        "Wednesday",
        "Thursday",
        "Friday",
        "Saturday",
        "Sunday",
      ];

      const RUN_COLORS = {
        Easy: "#34C759",
        Tempo: "#FF9500",
        Interval: "#FF2D55",
        Long: "#0A84FF",
      };

      function save(key, value) {
        try {
          localStorage.setItem(key, JSON.stringify(value));
        } catch (e) {}
      }

      function load(key, fallback) {
        try {
          const raw = localStorage.getItem(key);
          if (!raw) return fallback;
          return JSON.parse(raw);
        } catch (e) {
          return fallback;
        }
      }

      function App() {
        // -------- STATE --------
        const [tab, setTab] = React.useState("home");

        const [selectedDate, setSelectedDate] = React.useState(new Date());
        const [showDaySheet, setShowDaySheet] = React.useState(false);

        const [showRunCreator, setShowRunCreator] = React.useState(false);
        const [showGymCreator, setShowGymCreator] = React.useState(false);
        const [showCreateChooser, setShowCreateChooser] = React.useState(false);

        const [gymPlan, setGymPlan] = React.useState(
          load("gymPlan", {
            Monday: null,
            Tuesday: null,
            Wednesday: null,
            Thursday: null,
            Friday: null,
            Saturday: null,
            Sunday: null,
          })
        );

        const [runPlan, setRunPlan] = React.useState(
          load("runPlan", {
            Monday: null,
            Tuesday: null,
            Wednesday: null,
            Thursday: null,
            Friday: null,
            Saturday: null,
            Sunday: null,
          })
        );

        // New workout state
        const [newRoutineName, setNewRoutineName] = React.useState("");
        const [newExerciseName, setNewExerciseName] = React.useState("");
        const [newExerciseSets, setNewExerciseSets] = React.useState("");
        const [newExerciseReps, setNewExerciseReps] = React.useState("");
        const [tempExercises, setTempExercises] = React.useState([]);

        // New run state
        const [newRunName, setNewRunName] = React.useState("");
        const [newRunCategory, setNewRunCategory] = React.useState("Easy");
        const [newRunDistance, setNewRunDistance] = React.useState("");
        const [newRunPace, setNewRunPace] = React.useState("");

        React.useEffect(() => save("gymPlan", gymPlan), [gymPlan]);
        React.useEffect(() => save("runPlan", runPlan), [runPlan]);

        // -------- HELPERS --------
        function getWeekdayFromDate(date) {
          const jsDay = date.getDay(); // 0 = Sunday
          if (jsDay === 0) return "Sunday";
          return WEEK_DAYS[jsDay - 1];
        }

        const today = new Date();
        const todayWeekday = getWeekdayFromDate(today);
        const tomorrow = new Date(today);
        tomorrow.setDate(today.getDate() + 1);
        const tomorrowWeekday = getWeekdayFromDate(tomorrow);

        // -------- WORKOUT LOGIC --------
        function addTempExercise() {
          if (!newExerciseName || !newExerciseSets || !newExerciseReps) return;
          setTempExercises((prev) => [
            ...prev,
            {
              name: newExerciseName,
              sets: Number(newExerciseSets),
              reps: Number(newExerciseReps),
            },
          ]);
          setNewExerciseName("");
          setNewExerciseSets("");
          setNewExerciseReps("");
        }

        function saveNewRoutine() {
          if (!newRoutineName || tempExercises.length === 0) return;

          const weekday = todayWeekday;

          setGymPlan((prev) => ({
            ...prev,
            [weekday]: {
              name: newRoutineName,
              exercises: tempExercises,
            },
          }));

          setNewRoutineName("");
          setTempExercises([]);
          setShowGymCreator(false);
        }

        function saveNewRoutineToDay(day) {
          if (!newRoutineName || tempExercises.length === 0) return;
          setGymPlan((prev) => ({
            ...prev,
            [day]: {
              name: newRoutineName,
              exercises: tempExercises,
            },
          }));
          setNewRoutineName("");
          setTempExercises([]);
          setShowGymCreator(false);
        }

        function deleteGymRoutine(name) {
          const updated = { ...gymPlan };
          for (const day of WEEK_DAYS) {
            if (updated[day] && updated[day].name === name) {
              delete updated[day];
            }
          }
          setGymPlan(updated);
        }

        // -------- RUN LOGIC --------
            function saveNewRunRoutine() {
          if (!newRunName) return;
        
          const weekday = todayWeekday;
        
          setRunPlan((prev) => ({
            ...prev,
            [weekday]: {
              name: newRunName,
              category: newRunCategory,
              color: RUN_COLORS[newRunCategory],
              distance: newRunDistance ? Number(newRunDistance) : null,
              pace: newRunPace || null,
              date: new Date().toISOString()   // ‚≠ê REQUIRED FOR CHARTS
            },
          }));
        
          setNewRunName("");
          setNewRunCategory("Easy");
          setNewRunDistance("");
          setNewRunPace("");
          setShowRunCreator(false);
        }
              function saveNewRunRoutineToDay(day) {
          if (!newRunName) return;
        
          setRunPlan((prev) => ({
            ...prev,
            [day]: {
              name: newRunName,
              category: newRunCategory,
              color: RUN_COLORS[newRunCategory],
              distance: newRunDistance ? Number(newRunDistance) : null,
              pace: newRunPace || null,
              date: new Date().toISOString()   // ‚≠ê REQUIRED FOR CHARTS
            },
          }));
        
          setNewRunName("");
          setNewRunCategory("Easy");
          setNewRunDistance("");
          setNewRunPace("");
          setShowRunCreator(false);
        }
        function deleteRunRoutine(name) {
          const updated = { ...runPlan };
          for (const day of WEEK_DAYS) {
            if (updated[day] && updated[day].name === name) {
              delete updated[day];
            }
          }
          setRunPlan(updated);
        }

        // -------- MODAL WRAPPER --------
        const ModalWrapper = ({ children, onClose }) => (
          <div className="fixed inset-0 bottom-sheet-backdrop flex items-end z-[999]">
            <div className="w-full bg-[#1C1C1E] rounded-t-3xl p-6 soft-border">
              <div className="flex justify-end mb-4">
                <button
                  onClick={onClose}
                  className="text-sm text-[#8E8E93]"
                >
                  Close
                </button>
              </div>
              {children}
            </div>
          </div>
        );

        // -------- MODALS --------
        const GymCreatorModal = () => (
          <ModalWrapper onClose={() => setShowGymCreator(false)}>
            <h2 className="text-xl font-semibold mb-4">New Workout</h2>

            <div className="mb-4">
              <p className="text-sm text-[#8E8E93] mb-1">Routine Name</p>
              <input
                value={newRoutineName}
                onChange={(e) => setNewRoutineName(e.target.value)}
                className="w-full bg-[#2C2C2E] soft-border rounded-xl p-3 text-sm"
                placeholder="Push Day"
              />
            </div>

            <div className="mb-4">
              <p className="text-sm text-[#8E8E93] mb-2">Add Exercise</p>

              <input
                value={newExerciseName}
                onChange={(e) => setNewExerciseName(e.target.value)}
                className="w-full bg-[#2C2C2E] soft-border rounded-xl p-3 text-sm mb-2"
                placeholder="Bench Press"
              />

              <div className="flex gap-2 mb-2">
                <input
                  value={newExerciseSets}
                  onChange={(e) => setNewExerciseSets(e.target.value)}
                  className="w-1/2 bg-[#2C2C2E] soft-border rounded-xl p-3 text-sm"
                  placeholder="Sets"
                  type="number"
                />
                <input
                  value={newExerciseReps}
                  onChange={(e) => setNewExerciseReps(e.target.value)}
                  className="w-1/2 bg-[#2C2C2E] soft-border rounded-xl p-3 text-sm"
                  placeholder="Reps"
                  type="number"
                />
              </div>

              <button
                onClick={addTempExercise}
                className="w-full bg-white text-black rounded-xl py-2 font-semibold"
              >
                Add Exercise
              </button>
            </div>

            {tempExercises.length > 0 && (
              <div className="mb-6">
                <p className="text-sm font-semibold mb-2">Exercises</p>
                <div className="space-y-2">
                  {tempExercises.map((ex, i) => (
                    <div
                      key={i}
                      className="bg-[#2C2C2E] soft-border rounded-xl p-3 text-sm"
                    >
                      {ex.name} ‚Äî {ex.sets}√ó{ex.reps}
                    </div>
                  ))}
                </div>
              </div>
            )}

            <button
              onClick={saveNewRoutine}
              className="w-full bg-green-500 text-black rounded-xl py-3 font-semibold"
            >
              Save Workout (Today)
            </button>
          </ModalWrapper>
        );

        const RunCreatorModal = () => (
          <ModalWrapper onClose={() => setShowRunCreator(false)}>
            <h2 className="text-xl font-semibold mb-4">New Run</h2>

            <div className="mb-4">
              <p className="text-sm text-[#8E8E93] mb-1">Run Name</p>
              <input
                value={newRunName}
                onChange={(e) => setNewRunName(e.target.value)}
                className="w-full bg-[#2C2C2E] soft-border rounded-xl p-3 text-sm"
                placeholder="Easy 5K"
              />
            </div>

            <div className="mb-4">
              <p className="text-sm text-[#8E8E93] mb-1">Category</p>
              <select
                value={newRunCategory}
                onChange={(e) => setNewRunCategory(e.target.value)}
                className="w-full bg-[#2C2C2E] soft-border rounded-xl p-3 text-sm"
              >
                <option>Easy</option>
                <option>Tempo</option>
                <option>Interval</option>
                <option>Long</option>
              </select>
            </div>

            <div className="mb-4 flex gap-2">
              <div className="w-1/2">
                <p className="text-sm text-[#8E8E93] mb-1">Distance (km)</p>
                <input
                  value={newRunDistance}
                  onChange={(e) => setNewRunDistance(e.target.value)}
                  className="w-full bg-[#2C2C2E] soft-border rounded-xl p-3 text-sm"
                  type="number"
                  placeholder="5"
                />
              </div>
              <div className="w-1/2">
                <p className="text-sm text-[#8E8E93] mb-1">Pace (min/km)</p>
                <input
                  value={newRunPace}
                  onChange={(e) => setNewRunPace(e.target.value)}
                  className="w-full bg-[#2C2C2E] soft-border rounded-xl p-3 text-sm"
                  placeholder="5:30"
                />
              </div>
            </div>

            <button
              onClick={saveNewRunRoutine}
              className="w-full bg-blue-500 text-black rounded-xl py-3 font-semibold"
            >
              Save Run (Today)
            </button>
          </ModalWrapper>
        );

        const CreateChooserModal = () => (
          <ModalWrapper onClose={() => setShowCreateChooser(false)}>
            <h2 className="text-xl font-semibold mb-4">What do you want to add?</h2>
            <div className="space-y-3">
              <button
                onClick={() => {
                  setShowCreateChooser(false);
                  setShowGymCreator(true);
                }}
                className="w-full bg-[#2C2C2E] soft-border rounded-xl p-3 text-left"
              >
                üèãÔ∏è New Workout
              </button>
              <button
                onClick={() => {
                  setShowCreateChooser(false);
                  setShowRunCreator(true);
                }}
                className="w-full bg-[#2C2C2E] soft-border rounded-xl p-3 text-left"
              >
                üèÉ New Run
              </button>
            </div>
          </ModalWrapper>
        );

        const DaySheet = () => {
          const weekday = getWeekdayFromDate(selectedDate);
          const gym = gymPlan[weekday];
          const run = runPlan[weekday];

          return (
            <ModalWrapper onClose={() => setShowDaySheet(false)}>
              <h2 className="text-xl font-semibold mb-4">
                {weekday}
              </h2>

              <div className="space-y-4">
                <div className="bg-[#2C2C2E] soft-border rounded-xl p-4">
                  <p className="text-sm text-[#8E8E93] mb-1">Gym</p>
                  {gym ? (
                    <div>
                      <p className="font-semibold mb-1">{gym.name}</p>
                      <ul className="text-sm space-y-1">
                        {gym.exercises.map((ex, i) => (
                          <li key={i}>
                            {ex.name} ‚Äî {ex.sets}√ó{ex.reps}
                          </li>
                        ))}
                      </ul>
                      <button
                        onClick={() => deleteGymRoutine(gym.name)}
                        className="mt-2 text-xs text-red-400"
                      >
                        Delete workout
                      </button>
                    </div>
                  ) : (
                    <p className="text-sm text-[#8E8E93]">No workout planned.</p>
                  )}
                </div>

                <div className="bg-[#2C2C2E] soft-border rounded-xl p-4">
                  <p className="text-sm text-[#8E8E93] mb-1">Run</p>
                  {run ? (
                    <div>
                      <p className="font-semibold mb-1">{run.name}</p>
                      <p className="text-sm">
                        {run.category}{" "}
                        {run.distance ? `‚Ä¢ ${run.distance} km` : ""}{" "}
                        {run.pace ? `‚Ä¢ ${run.pace} min/km` : ""}
                      </p>
                      <button
                        onClick={() => deleteRunRoutine(run.name)}
                        className="mt-2 text-xs text-red-400"
                      >
                        Delete run
                      </button>
                    </div>
                  ) : (
                    <p className="text-sm text-[#8E8E93]">No run planned.</p>
                  )}
                </div>
              </div>
            </ModalWrapper>
          );
        };
        
    const LineChart = ({ data, label }) => {
      const max = Math.max(...data, 1);
      const points = data
        .map((v, i) => {
          const x = (i / (data.length - 1)) * 300;
          const y = 100 - (v / max) * 100;
          return `${x},${y}`;
        })
        .join(" ");
    
      return (
        <div className="bg-[#1C1C1E] soft-border rounded-2xl p-4 mb-4">
          <p className="text-xs text-[#8E8E93] mb-2">{label}</p>
          <svg width="300" height="100">
            <polyline
              fill="none"
              stroke="white"
              strokeWidth="2"
              points={points}
            />
          </svg>
        </div>
      );
    };
        function getMonthlyCounts(plan) {
  const counts = Array(12).fill(0);

  for (const day of WEEK_DAYS) {
    const entry = plan[day];
    if (entry && entry.date) {
      const month = new Date(entry.date).getMonth();
      counts[month]++;
    }
  }

  return counts;
}
        // -------- TABS --------
        const HomeTab = () => {
          const weekDates = [];
          const start = new Date(today);
          start.setDate(today.getDate() - (today.getDay() === 0 ? 6 : today.getDay() - 1));
          for (let i = 0; i < 7; i++) {
            const d = new Date(start);
            d.setDate(start.getDate() + i);
            weekDates.push(d);
          }

          const workoutsThisMonth = Object.values(gymPlan).filter(Boolean).length;
          const runsThisMonth = Object.values(runPlan).filter(Boolean).length;

          return (
            <div className="w-full h-full px-4 pt-10 pb-24 overflow-y-auto">
              <h1 className="text-2xl font-semibold mb-4">Hi Joby üëã</h1>

              {/* Week strip */}
              <div className="flex gap-2 mb-4 overflow-x-auto">
                {weekDates.map((d, idx) => {
                  const isSelected =
                    d.toDateString() === selectedDate.toDateString();
                  const label = WEEK_DAYS[idx].slice(0, 3);
                  return (
                    <button
                      key={idx}
                      onClick={() => {
                        setSelectedDate(d);
                        setShowDaySheet(true);
                      }}
                      className={`flex flex-col items-center px-3 py-2 rounded-2xl soft-border ${
                        isSelected ? "bg-white text-black" : "bg-[#1C1C1E]"
                      }`}
                    >
                      <span className="text-xs">{label}</span>
                      <span className="text-sm">
                        {d.getDate()}
                      </span>
                    </button>
                  );
                })}
              </div>

              {/* Weekly summary */}
              <div className="grid grid-cols-2 gap-3 mb-4">
                <div className="bg-[#1C1C1E] soft-border rounded-2xl p-4">
                  <p className="text-xs text-[#8E8E93] mb-1">Gym this week</p>
                  <p className="text-lg font-semibold">0 / 3</p>
                </div>
                <div className="bg-[#1C1C1E] soft-border rounded-2xl p-4">
                  <p className="text-xs text-[#8E8E93] mb-1">Runs this week</p>
                  <p className="text-lg font-semibold">0 / 3</p>
                </div>
              </div>

              {/* New buttons */}
              <div className="flex gap-3 mb-4">
                <button
                  onClick={() => setShowGymCreator(true)}
                  className="flex-1 bg-[#1C1C1E] soft-border rounded-2xl p-3 flex items-center justify-center gap-2 text-sm"
                >
                  <span>üèãÔ∏è</span>
                  <span>New Workout</span>
                </button>
                <button
                  onClick={() => setShowRunCreator(true)}
                  className="flex-1 bg-[#1C1C1E] soft-border rounded-2xl p-3 flex items-center justify-center gap-2 text-sm"
                >
                  <span>üèÉ</span>
                  <span>New Run</span>
                </button>
              </div>

              {/* Today / Tomorrow */}
              <div className="space-y-3 mb-4">
                <div className="bg-[#1C1C1E] soft-border rounded-2xl p-4">
                  <p className="text-xs text-[#8E8E93] mb-1">
                    Today ‚Ä¢ {todayWeekday}
                  </p>
                  <p className="text-sm">
                    {gymPlan[todayWeekday]
                      ? `üèãÔ∏è ${gymPlan[todayWeekday].name}`
                      : "No workout planned."}
                  </p>
                  <p className="text-sm mt-1">
                    {runPlan[todayWeekday]
                      ? `üèÉ ${runPlan[todayWeekday].name}`
                      : "No run planned."}
                  </p>
                </div>

                <div className="bg-[#1C1C1E] soft-border rounded-2xl p-4">
                  <p className="text-xs text-[#8E8E93] mb-1">
                    Tomorrow ‚Ä¢ {tomorrowWeekday}
                  </p>
                  <p className="text-sm">
                    {gymPlan[tomorrowWeekday]
                      ? `üèãÔ∏è ${gymPlan[tomorrowWeekday].name}`
                      : "No workout planned."}
                  </p>
                  <p className="text-sm mt-1">
                    {runPlan[tomorrowWeekday]
                      ? `üèÉ ${runPlan[tomorrowWeekday].name}`
                      : "No run planned."}
                  </p>
                </div>
              </div>

              {/* Monthly summary */}
              <div className="bg-[#1C1C1E] soft-border rounded-2xl p-4 mb-4">
                <p className="text-xs text-[#8E8E93] mb-1">
                  WORKOUTS THIS MONTH
                </p>
                <p className="text-sm font-semibold">
                  {workoutsThisMonth} / 16
                </p>
                <p className="text-xs text-[#8E8E93] mt-2">
                  RUNS THIS MONTH
                </p>
                <p className="text-sm font-semibold">
                  {runsThisMonth} / 12
                </p>
              </div>
            </div>
          );
        };

        const CalendarTab = () => (
          <div className="w-full h-full flex items-center justify-center">
            <p className="text-sm text-[#8E8E93]">
              Calendar view coming soon.
            </p>
          </div>
        );

        const SettingsPage = () => {
          function resetAll() {
            setGymPlan({
              Monday: null,
              Tuesday: null,
              Wednesday: null,
              Thursday: null,
              Friday: null,
              Saturday: null,
              Sunday: null,
            });
            setRunPlan({
              Monday: null,
              Tuesday: null,
              Wednesday: null,
              Thursday: null,
              Friday: null,
              Saturday: null,
              Sunday: null,
            });
          }

          return (
            <div className="w-full h-full px-4 pt-10 pb-24">
              <h1 className="text-2xl font-semibold mb-4">Settings</h1>
              <button
                onClick={resetAll}
                className="w-full bg-red-500 text-black rounded-xl py-3 font-semibold"
              >
                Reset App Data
              </button>
            </div>
          );
        };

        const WorkoutTab = () => (
          <div className="w-full h-full px-4 pt-10 pb-24">
            <h1 className="text-2xl font-semibold mb-4">Workouts</h1>
            <p className="text-sm text-[#8E8E93]">
              You can manage workouts from Home and the day sheet.
            </p>
          </div>
        );

        // -------- RENDER --------
        return (
          <div className="w-full h-screen relative overflow-hidden">
            {tab === "home" && <HomeTab />}
            {tab === "calendar" && <CalendarTab />}
            {tab === "settings" && <SettingsPage />}
            {tab === "workout" && <WorkoutTab />}

            {/* Bottom Navigation (no Add button) */}
            <div className="fixed bottom-4 left-0 right-0 flex justify-center z-[50]">
              <div className="glass-nav soft-border rounded-[24px] py-2.5 px-6 flex gap-10 items-center">
                <button
                  onClick={() => setTab("home")}
                  className={`flex flex-col items-center text-xs ${
                    tab === "home" ? "text-white" : "text-[#8E8E93]"
                  }`}
                >
                  <span className="mb-1">üè†</span>
                  <span>Home</span>
                </button>

                <button
                  onClick={() => setTab("calendar")}
                  className={`flex flex-col items-center text-xs ${
                    tab === "calendar" ? "text-white" : "text-[#8E8E93]"
                  }`}
                >
                  <span className="mb-1">üìÖ</span>
                  <span>Calendar</span>
                </button>

                <button
                  onClick={() => setTab("settings")}
                  className={`flex flex-col items-center text-xs ${
                    tab === "settings" ? "text-white" : "text-[#8E8E93]"
                  }`}
                >
                  <span className="mb-1">‚öôÔ∏è</span>
                  <span>Settings</span>
                </button>
              </div>
            </div>

            {/* Modals */}
            {showRunCreator && <RunCreatorModal />}
            {showGymCreator && <GymCreatorModal />}
            {showCreateChooser && <CreateChooserModal />}
            {showDaySheet && <DaySheet />}
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
