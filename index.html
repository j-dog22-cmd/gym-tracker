<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fitness Planner</title>

  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    html, body {
      height: 100%;
      overflow: hidden;
    }
    body {
      background: black;
      color: white;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      overscroll-behavior: none;
    }
    .soft-border {
      border: 1px solid rgba(255, 255, 255, 0.08);
    }
    .glass-nav {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(20px);
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    /* -------------------------------------------
       WEEKDAY HELPERS ‚Äî MONDAY FIRST
    -------------------------------------------- */

    const WEEK_DAYS = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"];

    function getWeekdayIndex(date) {
      const js = date.getDay(); // 0 = Sun
      return js === 0 ? 6 : js - 1;
    }

    function getTodayNames() {
      const now = new Date();
      const todayIndex = getWeekdayIndex(now);
      const tomorrowIndex = (todayIndex + 1) % 7;
      return {
        todayName: WEEK_DAYS[todayIndex],
        tomorrowName: WEEK_DAYS[tomorrowIndex],
      };
    }

    function isSameDay(d1, d2) {
      return (
        d1.getFullYear() === d2.getFullYear() &&
        d1.getMonth() === d2.getMonth() &&
        d1.getDate() === d2.getDate()
      );
    }

    /* -------------------------------------------
       PROGRESS RING COMPONENT
    -------------------------------------------- */

    function ProgressRing({ size = 80, strokeWidth = 8, progress = 0, color = "#22c55e", label, sublabel }) {
      const radius = (size - strokeWidth) / 2;
      const circumference = 2 * Math.PI * radius;
      const clamped = Math.max(0, Math.min(1, progress));
      const offset = circumference * (1 - clamped);

      return (
        <div className="flex flex-col items-center">
          <svg width={size} height={size}>
            <circle
              stroke="rgba(255,255,255,0.08)"
              fill="transparent"
              strokeWidth={strokeWidth}
              r={radius}
              cx={size / 2}
              cy={size / 2}
            />
            <circle
              stroke={color}
              fill="transparent"
              strokeWidth={strokeWidth}
              strokeLinecap="round"
              r={radius}
              cx={size / 2}
              cy={size / 2}
              style={{
                strokeDasharray: circumference,
                strokeDashoffset: offset,
                transition: "stroke-dashoffset 0.6s ease-out",
                transform: "rotate(-90deg)",
                transformOrigin: "50% 50%",
              }}
            />
          </svg>
          <p className="mt-2 text-sm font-semibold">{label}</p>
          {sublabel && (
            <p className="text-xs text-[#8E8E93]">{sublabel}</p>
          )}
        </div>
      );
    }

    /* -------------------------------------------
       APP START
    -------------------------------------------- */

    function App() {
      /* NAVIGATION */
      const [tab, setTab] = React.useState("home");

      /* GYM ROUTINES */
      const [routines, setRoutines] = React.useState(() => {
        const saved = localStorage.getItem("routines_v1");
        return saved ? JSON.parse(saved) : [];
      });

      const saveRoutines = (updated) => {
        setRoutines(updated);
        localStorage.setItem("routines_v1", JSON.stringify(updated));
      };

      /* WEEKLY GYM PLAN */
      const [weeklyPlan, setWeeklyPlan] = React.useState(() => {
        const saved = localStorage.getItem("weeklyPlan_v1");
        return saved
          ? JSON.parse(saved)
          : {
              Mon: null,
              Tue: null,
              Wed: null,
              Thu: null,
              Fri: null,
              Sat: null,
              Sun: null,
            };
      });

      const saveWeeklyPlan = (updated) => {
        setWeeklyPlan(updated);
        localStorage.setItem("weeklyPlan_v1", JSON.stringify(updated));
      };

      /* RUNNING PLAN + ROUTINES */
      const [runPlan, setRunPlan] = React.useState(() => {
        const saved = localStorage.getItem("runPlan_v1");
        return saved
          ? JSON.parse(saved)
          : {
              Mon: null,
              Tue: null,
              Wed: null,
              Thu: null,
              Fri: null,
              Sat: null,
              Sun: null,
            };
      });

      const saveRunPlan = (updated) => {
        setRunPlan(updated);
        localStorage.setItem("runPlan_v1", JSON.stringify(updated));
      };

      const [runRoutines, setRunRoutines] = React.useState(() => {
        const saved = localStorage.getItem("runRoutines_v1");
        return saved ? JSON.parse(saved) : [];
      });

      const saveRunRoutines = (updated) => {
        setRunRoutines(updated);
        localStorage.setItem("runRoutines_v1", JSON.stringify(updated));
      };

      /* DELETE + MODAL STATE */
      const [showGymCreator, setShowGymCreator] = React.useState(false);
      const [showRunCreator, setShowRunCreator] = React.useState(false);
      const [showCreateChooser, setShowCreateChooser] = React.useState(false);
      const [selectedDay, setSelectedDay] = React.useState(null);

      function deleteGymRoutine(routineName) {
        const updatedRoutines = routines.filter(r => r.name !== routineName);
        saveRoutines(updatedRoutines);

        const updatedPlan = { ...weeklyPlan };
        WEEK_DAYS.forEach(day => {
          if (updatedPlan[day] && updatedPlan[day].name === routineName) {
            updatedPlan[day] = null;
          }
        });
        saveWeeklyPlan(updatedPlan);

        setSelectedDay(null);
      }

      function deleteRunRoutine(runType) {
        const updatedRoutines = runRoutines.filter(r => r.type !== runType);
        saveRunRoutines(updatedRoutines);

        const updatedPlan = { ...runPlan };
        WEEK_DAYS.forEach(day => {
          if (updatedPlan[day] && updatedPlan[day].type === runType) {
            updatedPlan[day] = null;
          }
        });
        saveRunPlan(updatedPlan);

        setSelectedDay(null);
      }

      /* AUTO-ASSIGN HELPERS */
      const WEEK_ORDER = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"];

      const autoAssignGym = (routine) => {
        for (let d of WEEK_ORDER) {
          if (!weeklyPlan[d]) {
            saveWeeklyPlan({ ...weeklyPlan, [d]: routine });
            return;
          }
        }
      };

      const autoAssignRun = (routine) => {
        for (let d of WEEK_ORDER) {
          if (!runPlan[d]) {
            saveRunPlan({ ...runPlan, [d]: routine });
            return;
          }
        }
      };

      /* ACTIVE WORKOUT + LOGS */
      const [activeWorkout, setActiveWorkout] = React.useState(null);

      const [workoutLogs, setWorkoutLogs] = React.useState(() => {
        const saved = localStorage.getItem("workoutLogs_v1");
        return saved ? JSON.parse(saved) : [];
      });

      function buildCompletedStructure(routine) {
        const completed = {};
        routine.exercises.forEach((ex, idx) => {
          completed[idx] = Array(ex.sets).fill(false);
        });
        return completed;
      }

      function startWorkout(routine) {
        setActiveWorkout({
          routine,
          completed: buildCompletedStructure(routine),
          logs: [],
          restTime: 0,
          resting: false,
          lastExerciseIndex: null,
          lastSetIndex: null,
        });
        setTab("workout");
      }

      function finishWorkout() {
        if (!activeWorkout) {
          setTab("home");
          return;
        }
        const updated = [...workoutLogs, ...activeWorkout.logs];
        setWorkoutLogs(updated);
        localStorage.setItem("workoutLogs_v1", JSON.stringify(updated));
        setActiveWorkout(null);
        setTab("home");
      }

      function completeSet(exIndex, setIndex) {
        if (!activeWorkout) return;

        const currentCompleted = activeWorkout.completed[exIndex];
        if (!currentCompleted || currentCompleted[setIndex]) return;

        const newCompleted = {
          ...activeWorkout.completed,
          [exIndex]: [...currentCompleted],
        };
        newCompleted[exIndex][setIndex] = true;

        const ex = activeWorkout.routine.exercises[exIndex];

        const newLogs = [
          ...activeWorkout.logs,
          {
            exercise: ex.name,
            set: setIndex + 1,
            timestamp: Date.now(),
          },
        ];

        const allDone = activeWorkout.routine.exercises.every((_, eIdx) =>
          newCompleted[eIdx].every(Boolean)
        );

        if (allDone) {
          const tempWorkout = {
            ...activeWorkout,
            completed: newCompleted,
            logs: newLogs,
          };
          setActiveWorkout(tempWorkout);
          const updated = [...workoutLogs, ...newLogs];
          setWorkoutLogs(updated);
          localStorage.setItem("workoutLogs_v1", JSON.stringify(updated));
          setActiveWorkout(null);
          setTab("home");
          return;
        }

        setActiveWorkout({
          ...activeWorkout,
          completed: newCompleted,
          logs: newLogs,
          resting: true,
          restTime: 60,
          lastExerciseIndex: exIndex,
          lastSetIndex: setIndex,
        });
      }

      React.useEffect(() => {
        if (!activeWorkout || !activeWorkout.resting) return;

        if (activeWorkout.restTime > 0) {
          const timer = setTimeout(() => {
            setActiveWorkout((prev) => ({
              ...prev,
              restTime: prev.restTime - 1,
            }));
          }, 1000);

          return () => clearTimeout(timer);
        }

        setActiveWorkout((prev) =>
          prev ? { ...prev, resting: false } : prev
        );
      }, [activeWorkout]);

      /* GYM CREATOR FORM */
      const [newRoutineName, setNewRoutineName] = React.useState("");
      const [newExerciseName, setNewExerciseName] = React.useState("");
      const [newExerciseSets, setNewExerciseSets] = React.useState("");
      const [newExerciseReps, setNewExerciseReps] = React.useState("");
      const [tempExercises, setTempExercises] = React.useState([]);

      const addTempExercise = () => {
        if (!newExerciseName || !newExerciseSets || !newExerciseReps) return;
        setTempExercises([
          ...tempExercises,
          {
            name: newExerciseName,
            sets: Number(newExerciseSets),
            reps: Number(newExerciseReps),
          },
        ]);
        setNewExerciseName("");
        setNewExerciseSets("");
        setNewExerciseReps("");
      };

      const saveNewRoutine = () => {
        if (!newRoutineName || tempExercises.length === 0) return;
        const routine = {
          name: newRoutineName,
          exercises: tempExercises,
        };
        saveRoutines([...routines, routine]);
        autoAssignGym(routine);
        setNewRoutineName("");
        setTempExercises([]);
        setShowGymCreator(false);
      };

      function saveNewRoutineToDay(day) {
        if (!newRoutineName || tempExercises.length === 0) return;

        const routine = {
          name: newRoutineName,
          exercises: tempExercises,
        };

        saveRoutines([...routines, routine]);
        saveWeeklyPlan({ ...weeklyPlan, [day]: routine });

        setNewRoutineName("");
        setTempExercises([]);
        setShowGymCreator(false);
      }

      /* RUN CREATOR FORM */
      const [newRunType, setNewRunType] = React.useState("");
      const [newRunDistance, setNewRunDistance] = React.useState("");
      const [newRunPace, setNewRunPace] = React.useState("");

      const saveNewRunRoutine = () => {
        if (!newRunType || !newRunDistance || !newRunPace) return;
        const routine = {
          type: newRunType,
          distance: Number(newRunDistance),
          pace: newRunPace,
        };
        saveRunRoutines([...runRoutines, routine]);
        autoAssignRun(routine);
        setNewRunType("");
        setNewRunDistance("");
        setNewRunPace("");
        setShowRunCreator(false);
      };

      /* DAY DETAILS HELPERS */
      function openDayDetails(dayObj) {
        setSelectedDay(dayObj);
      }

      function closeDayDetails() {
        setSelectedDay(null);
      }

      /* TODAY / TOMORROW */
      const { todayName, tomorrowName } = getTodayNames();

      /* MOTIVATIONAL HEADER STATE */
      const affirmations = [
        "Let‚Äôs crush it today.",
        "Small steps, big results.",
        "You‚Äôre building something strong.",
        "Consistency beats intensity.",
      ];
      const [affirmationIndex, setAffirmationIndex] = React.useState(0);

      React.useEffect(() => {
        const id = setInterval(() => {
          setAffirmationIndex((prev) => (prev + 1) % affirmations.length);
        }, 8000);
        return () => clearInterval(id);
      }, []);

      /* STATS + PROGRESS CALCULATIONS */

      const todayDate = new Date();

      // Weekly targets
      const WEEKLY_GYM_GOAL = 3;
      const WEEKLY_RUN_GOAL = 3;

      // Count planned gym/run this week
      const plannedGymThisWeek = WEEK_DAYS.filter(d => weeklyPlan[d]).length;
      const plannedRunThisWeek = WEEK_DAYS.filter(d => runPlan[d]).length;

      // Completed workouts from logs (per day)
      const completedDaysSet = new Set(
        workoutLogs.map(log => {
          const d = new Date(log.timestamp);
          return d.toDateString();
        })
      );
      const completedWorkoutsThisWeek = Array.from(completedDaysSet).filter(ds => {
        const d = new Date(ds);
        const weekStart = new Date(todayDate);
        const offset = getWeekdayIndex(weekStart);
        weekStart.setDate(weekStart.getDate() - offset);
        const weekEnd = new Date(weekStart);
        weekEnd.setDate(weekEnd.getDate() + 6);
        return d >= weekStart && d <= weekEnd;
      }).length;

      const gymProgress = Math.min(1, completedWorkoutsThisWeek / WEEKLY_GYM_GOAL);

      // Simple run completion: count days where runPlan exists and date <= today
      const runCompletedDays = WEEK_DAYS.filter((day, idx) => {
        const weekStart = new Date(todayDate);
        const offset = getWeekdayIndex(weekStart);
        weekStart.setDate(weekStart.getDate() - offset);
        const d = new Date(weekStart);
        d.setDate(weekStart.getDate() + idx);
        return runPlan[day] && d <= todayDate;
      }).length;
      const runProgress = Math.min(1, runCompletedDays / WEEKLY_RUN_GOAL);

      // Streak: count consecutive days (backwards) where either a workout log exists or a run is planned
      function computeStreak() {
        let streak = 0;
        const logsByDay = new Set(
          workoutLogs.map(l => new Date(l.timestamp).toDateString())
        );
        let cursor = new Date(todayDate);
        while (true) {
          const dayName = WEEK_DAYS[getWeekdayIndex(cursor)];
          const hasRun = !!runPlan[dayName];
          const hasWorkout = logsByDay.has(cursor.toDateString());
          if (hasRun || hasWorkout) {
            streak += 1;
            cursor.setDate(cursor.getDate() - 1);
          } else {
            break;
          }
        }
        return streak;
      }

      const streak = computeStreak();

      // Monthly stats
      const currentMonthIndex = todayDate.getMonth();
      const currentYear = todayDate.getFullYear();

      const workoutsThisMonth = workoutLogs.filter(log => {
        const d = new Date(log.timestamp);
        return d.getMonth() === currentMonthIndex && d.getFullYear() === currentYear;
      }).length;

      const totalKmThisMonth = Object.values(runPlan).reduce((sum, r) => {
        if (!r) return sum;
        return sum + (r.distance || 0);
      }, 0);

            const MONTHLY_WORKOUT_GOAL = 12;
      const monthlyProgress = Math.min(1, workoutsThisMonth / MONTHLY_WORKOUT_GOAL);

      const HomeTab = (
        <div className="p-4 flex flex-col gap-6">

          {/* HEADER */}
          <div className="flex justify-between items-center">
            <div className="text-2xl font-bold">
              Hello, {userName || "Friend"}
            </div>
            <button onClick={() => navigate("/settings")}>
              <i className="fa-solid fa-gear text-2xl"></i>
            </button>
          </div>

          {/* 7 DAY STRIP */}
          <div>
            <WeekdayStrip 
              selectedDay={selectedDay} 
              onSelect={setSelectedDay} 
            />
          </div>

          {/* CUSTOMISABLE RINGS */}
          <div>
            <ProgressRings 
              rings={userRings} 
              onRingClick={handleRingClick} 
            />
          </div>

          {/* YOUR PLAN */}
          <div className="mt-2">
            <h2 className="text-xl font-bold mb-2">Your Plan</h2>

            <div className="flex flex-col gap-4">
              <TodayBox 
                plan={todayPlan} 
                onSelect={handleSelectToday} 
              />

              <TomorrowBox 
                plan={tomorrowPlan} 
                onSelect={handleSelectTomorrow} 
              />
            </div>
          </div>

          {/* QUICK ADD */}
          <div className="mt-2">
            <QuickAddRow 
              onAddWorkout={openAddWorkout} 
              onAddRun={openAddRun} 
              onAddGym={openAddGym} 
            />
          </div>

          {/* MONTHLY GOALS */}
          <div className="mt-4">
            <h2 className="text-xl font-bold mb-2">Monthly Goals</h2>

            <MonthlyGoals 
              goals={userGoals} 
              progress={goalProgress} 
            />
          </div>

        </div>
      );

      /* SWIPEABLE CALENDAR TAB */
      const today = new Date();
      const MIN_MONTH = new Date(today.getFullYear(), today.getMonth(), 1);

      const [currentMonth, setCurrentMonth] = React.useState(
        new Date(today.getFullYear(), today.getMonth(), 1)
      );

      let touchStartX = 0;
      let touchEndX = 0;

      function handleTouchStart(e) {
        touchStartX = e.changedTouches[0].screenX;
      }

      function handleTouchEnd(e) {
        touchEndX = e.changedTouches[0].screenX;
        handleSwipe();
      }

      function handleSwipe() {
        const diff = touchEndX - touchStartX;
        if (Math.abs(diff) < 50) return;
        if (diff < 0) goNextMonth();
        if (diff > 0) goPrevMonth();
      }

      function goNextMonth() {
        const next = new Date(currentMonth);
        next.setMonth(next.getMonth() + 1);
        setCurrentMonth(next);
      }

      function goPrevMonth() {
        const prev = new Date(currentMonth);
        prev.setMonth(prev.getMonth() - 1);
        if (prev < MIN_MONTH) return;
        setCurrentMonth(prev);
      }

      const CalendarTab = (
        <div
          className="w-full h-screen overflow-hidden bg-black px-4 pt-6"
          onTouchStart={handleTouchStart}
          onTouchEnd={handleTouchEnd}
        >
          <div className="text-xl font-semibold tracking-tight mb-2 text-center">
            {currentMonth.toLocaleString("default", {
              month: "long",
              year: "numeric",
            })}
          </div>

          <div className="grid grid-cols-7 gap-1 text-center text-xs text-[#8E8E93] mb-1">
            {["M", "T", "W", "T", "F", "S", "S"].map((d, i) => (
              <div key={i}>{d}</div>
            ))}
          </div>

          {(() => {
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();

            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);

            const days = [];
            for (let d = 1; d <= lastDay.getDate(); d++) {
              const date = new Date(year, month, d);
              days.push({
                date,
                key: `${year}-${month + 1}-${d}`,
                weekday: WEEK_DAYS[getWeekdayIndex(date)],
              });
            }

            const leadingBlanks = getWeekdayIndex(firstDay);
            const paddedDays = [
              ...Array(leadingBlanks).fill({ blank: true }),
              ...days,
            ];

            const renderDots = (dayObj) => {
              if (dayObj.blank) return null;

              const weekday = dayObj.weekday;
              const gym = weeklyPlan[weekday];
              const run = runPlan[weekday];

              if (gym && run)
                return (
                  <div className="w-1.5 h-1.5 bg-white rounded-full mx-auto mt-1"></div>
                );

              if (gym)
                return (
                  <div className="w-1.5 h-1.5 bg-green-400 rounded-full mx-auto mt-1"></div>
                );

              if (run)
                return (
                  <div className="w-1.5 h-1.5 bg-blue-400 rounded-full mx-auto mt-1"></div>
                );

              return null;
            };

            return (
              <div className="grid grid-cols-7 gap-1 text-center">
                {paddedDays.map((d, index) => {
                  if (d.blank) return <div key={"blank-" + index}></div>;

                  const isToday =
                    new Date().toDateString() === d.date.toDateString();

                  return (
                    <button
                      key={d.key}
                      onClick={() => openDayDetails(d)}
                      className={`py-1 rounded-lg text-sm ${
                        isToday
                          ? "bg-red-500 text-white font-semibold"
                          : "bg-[#1C1C1E] text-white"
                      }`}
                    >
                      {d.date.getDate()}
                      {renderDots(d)}
                    </button>
                  );
                })}
              </div>
            );
          })()}

          {/* DAY DETAILS PANEL (CALENDAR MODAL) */}
          {selectedDay && (
            <div className="fixed inset-0 bg-black bg-opacity-60 flex items-end z-[999]">
              <div className="w-full bg-[#1C1C1E] rounded-t-3xl p-6 soft-border">

                <div className="flex justify-between items-center mb-4">
                  <h2 className="text-xl font-semibold">
                    {selectedDay.date.toDateString()}
                  </h2>

                <button
                  onClick={closeDayDetails}
                  className="text-sm text-[#8E8E93]"
                >
                  Close
                </button>
              </div>

              {/* WORKOUT PREVIEW */}
              {(() => {
                const weekday = selectedDay.weekday;
                const routine = weeklyPlan[weekday];

                if (!routine) {
                  return (
                    <p className="text-sm text-[#8E8E93] mb-4">
                      No gym routine
                    </p>
                  );
                }

                return (
                  <div className="mb-6">
                    <h3 className="text-lg font-semibold mb-2">Workout</h3>

                    <div className="bg-[#2C2C2E] p-4 rounded-xl soft-border mb-3">
                      <p className="font-semibold mb-1">{routine.name}</p>

                      <ul className="text-sm text-[#E5E5EA] space-y-1">
                        {routine.exercises.map((ex, i) => (
                          <li key={i}>
                            {ex.name} ‚Äî {ex.sets}√ó{ex.reps}
                          </li>
                        ))}
                      </ul>
                    </div>

                    <button
                      onClick={() => deleteGymRoutine(routine.name)}
                      className="w-full bg-red-500 text-white rounded-xl py-2 mt-3 font-semibold"
                    >
                      Delete Workout
                    </button>

                    <button
                      onClick={() => startWorkout(routine)}
                      className="w-full bg-white text-black rounded-xl py-3 font-semibold mt-3"
                    >
                      Start Today‚Äôs Workout
                    </button>
                  </div>
                );
              })()}

              {/* RUN PREVIEW */}
              {(() => {
                const weekday = selectedDay.weekday;
                const routine = runPlan[weekday];

                if (!routine) {
                  return (
                    <p className="text-sm text-[#8E8E93] mb-4">
                      No running routine
                    </p>
                  );
                }

                return (
                  <div className="mb-4">
                    <p className="text-blue-400 text-sm font-semibold mb-1">
                      Run: {routine.type}
                    </p>
                    <p className="text-sm text-[#8E8E93]">
                      {routine.distance} km ‚Äî {routine.pace}
                    </p>

                    <button
                      onClick={() => deleteRunRoutine(routine.type)}
                      className="w-full bg-red-500 text-white rounded-xl py-2 mt-3 font-semibold"
                    >
                      Delete Run
                    </button>
                  </div>
                );
              })()}

            </div>
          </div>
        )}
      </div>
    );

    /* WORKOUT TAB */
    const WorkoutTab = activeWorkout && (
      <div className="w-full h-screen overflow-y-auto bg-black pb-32 px-4 pt-6">
        <h2 className="text-2xl font-semibold mb-4">
          {activeWorkout.routine.name}
        </h2>

        {activeWorkout.routine.exercises.map((ex, exIndex) => (
          <div
            key={exIndex}
            className="mb-4 bg-[#1C1C1E] p-4 rounded-xl soft-border"
          >
            <p className="font-semibold mb-1">{ex.name}</p>
            <p className="text-xs text-[#8E8E93] mb-2">
              {ex.sets} sets ‚Äî {ex.reps} reps
            </p>

            <div className="space-y-2">
              {Array.from({ length: ex.sets }).map((_, setIndex) => {
                const done =
                  activeWorkout.completed[exIndex] &&
                  activeWorkout.completed[exIndex][setIndex];

                return (
                  <button
                    key={setIndex}
                    onClick={() => completeSet(exIndex, setIndex)}
                    disabled={done || activeWorkout.resting}
                    className={`w-full flex items-center justify-between px-3 py-2 rounded-lg text-sm ${
                      done
                        ? "bg-green-500 text-black"
                        : "bg-[#2C2C2E] text-white"
                    }`}
                  >
                    <span>
                      Set {setIndex + 1} ‚Äî {ex.reps} reps
                    </span>
                    <span>{done ? "‚úÖ" : "Tap to complete"}</span>
                  </button>
                );
              })}
            </div>
          </div>
        ))}

        {activeWorkout.resting && (
          <div className="text-center mt-4 mb-4">
            <p className="text-lg mb-2">Resting...</p>
            <p className="text-4xl font-bold">
              {activeWorkout.restTime}s
            </p>
          </div>
        )}

        <button
          onClick={finishWorkout}
          className="w-full text-[#8E8E93] mt-4"
        >
          End Workout
        </button>
      </div>
    );

    /* MODALS */
    const GymCreatorModal = showGymCreator && (
      <div className="fixed inset-0 bg-black bg-opacity-60 flex items-end z-[999]">
        <div className="w-full bg-[#1C1C1E] rounded-t-3xl p-6 soft-border">
          <h2 className="text-xl font-semibold mb-4">Create Workout</h2>

          <input
            type="text"
            placeholder="Routine name"
            className="w-full mb-3 p-3 rounded-xl bg-[#2C2C2E]"
            value={newRoutineName}
            onChange={(e) => setNewRoutineName(e.target.value)}
          />

          <div className="mb-3">
            <div className="flex gap-2 mb-2">
              <input
                type="text"
                placeholder="Exercise"
                className="flex-1 p-3 rounded-xl bg-[#2C2C2E]"
                value={newExerciseName}
                onChange={(e) => setNewExerciseName(e.target.value)}
              />
              <input
                type="number"
                placeholder="Sets"
                className="w-20 p-3 rounded-xl bg-[#2C2C2E]"
                value={newExerciseSets}
                onChange={(e) => setNewExerciseSets(e.target.value)}
              />
              <input
                type="number"
                placeholder="Reps"
                className="w-20 p-3 rounded-xl bg-[#2C2C2E]"
                value={newExerciseReps}
                onChange={(e) => setNewExerciseReps(e.target.value)}
              />
            </div>

            <button
              onClick={addTempExercise}
              className="w-full bg-white text-black rounded-xl py-2 text-sm font-semibold"
            >
              Add Exercise
            </button>
          </div>

          {tempExercises.length > 0 && (
            <div className="mb-4">
              <p className="text-sm text-[#8E8E93] mb-1">Exercises:</p>
              <ul className="text-sm text-[#E5E5EA] space-y-1">
                {tempExercises.map((ex, i) => (
                  <li key={i}>
                    {ex.name} ‚Äî {ex.sets}√ó{ex.reps}
                  </li>
                ))}
              </ul>
            </div>
          )}

          {tempExercises.length > 0 && newRoutineName && (
            <>
              <p className="text-sm text-[#8E8E93] mb-2">
                Assign to day (optional)
              </p>
              <div className="grid grid-cols-7 gap-2 mb-4">
                {WEEK_DAYS.map((day) => (
                  <button
                    key={day}
                    onClick={() => saveNewRoutineToDay(day)}
                    className="bg-[#2C2C2E] rounded-xl py-2 text-sm"
                  >
                    {day}
                  </button>
                ))}
              </div>
            </>
          )}

          <button
            onClick={saveNewRoutine}
            className="w-full bg-white text-black rounded-xl py-3 font-semibold mt-2"
          >
            Save Workout
          </button>

          <button
            onClick={() => {
              setShowGymCreator(false);
              setTempExercises([]);
            }}
            className="w-full text-[#8E8E93] mt-3"
          >
            Cancel
          </button>
        </div>
      </div>
    );

    const RunCreatorModal = showRunCreator && (
      <div className="fixed inset-0 bg-black bg-opacity-60 flex items-end z-[999]">
        <div className="w-full bg-[#1C1C1E] rounded-t-3xl p-6 soft-border">
          <h2 className="text-xl font-semibold mb-4">
            Create Running Routine
          </h2>

          <input
            type="text"
            placeholder="Type (e.g., Tempo, Easy, Long)"
            className="w-full mb-3 p-3 rounded-xl bg-[#2C2C2E]"
            value={newRunType}
            onChange={(e) => setNewRunType(e.target.value)}
          />

          <input
            type="number"
            placeholder="Distance (km)"
            className="w-full mb-3 p-3 rounded-xl bg-[#2C2C2E]"
            value={newRunDistance}
            onChange={(e) => setNewRunDistance(e.target.value)}
          />

          <input
            type="text"
            placeholder="Pace (e.g., 5:00/km)"
            className="w-full mb-3 p-3 rounded-xl bg-[#2C2C2E]"
            value={newRunPace}
            onChange={(e) => setNewRunPace(e.target.value)}
          />

          <button
            onClick={saveNewRunRoutine}
            className="w-full bg-white text-black rounded-xl py-3 font-semibold mt-2"
          >
            Save Running Routine
          </button>

          <button
            onClick={() => setShowRunCreator(false)}
            className="w-full text-[#8E8E93] mt-3"
          >
            Cancel
          </button>
        </div>
      </div>
    );

    const CreateChooserModal = showCreateChooser && (
      <div className="fixed inset-0 bg-black bg-opacity-60 flex items-end z-[999]">
        <div className="w-full bg-[#1C1C1E] rounded-t-3xl p-6 soft-border">
          <h2 className="text-xl font-semibold mb-4">Create</h2>

          <button
            onClick={() => {
              setShowCreateChooser(false);
              setShowGymCreator(true);
            }}
            className="w-full bg-[#2C2C2E] rounded-xl p-4 mb-3 text-left"
          >
            <p className="font-semibold">Gym Routine</p>
            <p className="text-sm text-[#8E8E93]">
              Build a strength workout with exercises
            </p>
          </button>

          <button
            onClick={() => {
              setShowCreateChooser(false);
              setShowRunCreator(true);
            }}
            className="w-full bg-[#2C2C2E] rounded-xl p-4 mb-3 text-left"
          >
            <p className="font-semibold">Running Routine</p>
            <p className="text-sm text-[#8E8E93]">
              Plan a structured run with distance and pace
            </p>
          </button>

          <button
            onClick={() => setShowCreateChooser(false)}
            className="w-full text-[#8E8E93] mt-3"
          >
            Cancel
          </button>
        </div>
      </div>
    );

    /* FINAL RENDER */
    return (
      <div className="w-full h-screen relative overflow-hidden">

        {tab === "home" && HomeTab}
        {tab === "calendar" && CalendarTab}
        {tab === "workout" && WorkoutTab}

        <button
          onClick={() => setShowCreateChooser(true)}
          className="fixed bottom-20 right-6 w-14 h-14 rounded-full bg-white text-black flex items-center justify-center text-3xl font-semibold shadow-lg z-[60]"
        >
          +
        </button>

        <div className="fixed bottom-4 left-0 right-0 flex justify-center z-[50]">
          <div className="glass-nav soft-border rounded-[24px] py-2.5 px-6 flex gap-8 items-center">

            <button
              onClick={() => setTab("home")}
              className={`flex flex-col items-center text-xs ${
                tab === "home" ? "text-white" : "text-[#8E8E93]"
              }`}
            >
              <span className="mb-1">üè†</span>
              <span>Home</span>
            </button>

            <button
              onClick={() => setTab("calendar")}
              className={`flex flex-col items-center text-xs ${
                tab === "calendar" ? "text-white" : "text-[#8E8E93]"
              }`}
            >
              <span className="mb-1">üìÖ</span>
              <span>Calendar</span>
            </button>

          </div>
        </div>

        {GymCreatorModal}
        {RunCreatorModal}
        {CreateChooserModal}

      </div>
    );
  }

  ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
