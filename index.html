<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fitness Planner</title>

  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      background: black;
      color: white;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      overscroll-behavior: none;
    }

    .soft-border {
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .glass-nav {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(20px);
    }

    .sticky-month {
      position: sticky;
      top: 0;
      background: black;
      padding: 8px 0;
      z-index: 20;
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">

    const WEEK_DAYS = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"];

    function App() {

      /* -------------------------
         NAVIGATION
      -------------------------- */
      const [tab, setTab] = React.useState("home");

      /* -------------------------
         RUNNING SESSIONS (KEEP)
      -------------------------- */
      const [runs, setRuns] = React.useState(() => {
        const saved = localStorage.getItem("runs_v1");
        return saved ? JSON.parse(saved) : {};
      });

      const saveRuns = (updated) => {
        setRuns(updated);
        localStorage.setItem("runs_v1", JSON.stringify(updated));
      };

      /* -------------------------
         GYM ROUTINES (KEEP)
         â€” but workout execution removed
      -------------------------- */
      const [routines, setRoutines] = React.useState(() => {
        const saved = localStorage.getItem("routines_v1");
        return saved ? JSON.parse(saved) : [];
      });

      const saveRoutines = (updated) => {
        setRoutines(updated);
        localStorage.setItem("routines_v1", JSON.stringify(updated));
      };

      /* -------------------------
         WEEKLY PLAN (KEEP but smaller)
         â€” only show today + tomorrow
      -------------------------- */
      const [weeklyPlan, setWeeklyPlan] = React.useState(() => {
        const saved = localStorage.getItem("weeklyPlan_v1");
        return saved ? JSON.parse(saved) : {
          Mon: null,
          Tue: null,
          Wed: null,
          Thu: null,
          Fri: null,
          Sat: null,
          Sun: null
        };
      });

      const saveWeeklyPlan = (updated) => {
        setWeeklyPlan(updated);
        localStorage.setItem("weeklyPlan_v1", JSON.stringify(updated));
      };

      /* -------------------------
         CALENDAR STATE
      -------------------------- */
      const [calendarMonths, setCalendarMonths] = React.useState([]);
      const calendarRef = React.useRef(null);

      React.useEffect(() => {
        const now = new Date();
        const start = new Date(now.getFullYear(), now.getMonth() - 1, 1);
        const months = [];

        for (let i = -1; i <= 2; i++) {
          const d = new Date(now.getFullYear(), now.getMonth() + i, 1);
          months.push(generateMonth(d));
        }

        setCalendarMonths(months);
      }, []);

      function generateMonth(date) {
        const year = date.getFullYear();
        const month = date.getMonth();
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);

        const days = [];
        for (let d = 1; d <= lastDay.getDate(); d++) {
          days.push({
            date: new Date(year, month, d),
            key: `${year}-${month + 1}-${d}`
          });
        }

        return {
          year,
          month,
          label: date.toLocaleString("default", { month: "long", year: "numeric" }),
          days
        };
      }

      function handleCalendarScroll(e) {
        const el = e.target;
        if (el.scrollTop < 200) {
          prependMonth();
        }
        if (el.scrollHeight - el.scrollTop - el.clientHeight < 200) {
          appendMonth();
        }
      }

      function prependMonth() {
        const first = calendarMonths[0];
        const newDate = new Date(first.year, first.month - 1, 1);
        const newMonth = generateMonth(newDate);
        setCalendarMonths([newMonth, ...calendarMonths]);
      }

      function appendMonth() {
        const last = calendarMonths[calendarMonths.length - 1];
        const newDate = new Date(last.year, last.month + 1, 1);
        const newMonth = generateMonth(newDate);
        setCalendarMonths([...calendarMonths, newMonth]);
      }
            /* -------------------------
         DAY DETAILS PANEL
      -------------------------- */
      const [selectedDay, setSelectedDay] = React.useState(null);

      function openDayDetails(dateObj) {
        setSelectedDay(dateObj);
      }

      function closeDayDetails() {
        setSelectedDay(null);
      }

      /* -------------------------
         RENDER CALENDAR DAY DOTS
         (runs + gym routines)
      -------------------------- */
      function renderDots(dateKey) {
        const dots = [];

        if (runs[dateKey]) {
          dots.push(<div key="run" className="w-2 h-2 rounded-full bg-blue-400"></div>);
        }

        const routine = weeklyPlan[
          WEEK_DAYS[new Date(dateKey).getDay() === 0 ? 6 : new Date(dateKey).getDay() - 1]
        ];

        if (routine) {
          dots.push(<div key="gym" className="w-2 h-2 rounded-full bg-green-400"></div>);
        }

        return (
          <div className="flex gap-1 mt-1">
            {dots}
          </div>
        );
      }

      /* -------------------------
         CALENDAR TAB (FULL SCREEN)
      -------------------------- */
      const CalendarTab = (
        <div
          className="w-full h-screen overflow-y-auto bg-black pb-32"
          onScroll={handleCalendarScroll}
          ref={calendarRef}
        >
          {calendarMonths.map((m, idx) => (
            <div key={idx} className="px-4 pt-6">
              
              {/* Sticky Month Header */}
              <div className="sticky-month text-xl font-semibold tracking-tight">
                {m.label}
              </div>

              {/* Month Grid */}
              <div className="grid grid-cols-7 gap-2 mt-4 text-center text-sm text-[#8E8E93]">
                {["M", "T", "W", "T", "F", "S", "S"].map((d, i) => (
                  <div key={i}>{d}</div>
                ))}
              </div>

              <div className="grid grid-cols-7 gap-2 mt-2 text-center">
                {m.days.map((d) => {
                  const key = d.key;
                  const isToday =
                    new Date().toDateString() === d.date.toDateString();

                  return (
                    <button
                      key={key}
                      onClick={() => openDayDetails(d)}
                      className={`py-2 rounded-xl ${
                        isToday ? "bg-white text-black font-semibold" : "bg-[#1C1C1E]"
                      }`}
                    >
                      {d.date.getDate()}
                      {renderDots(key)}
                    </button>
                  );
                })}
              </div>
            </div>
          ))}

          {/* DAY DETAILS PANEL */}
          {selectedDay && (
            <div className="fixed inset-0 bg-black bg-opacity-60 flex items-end">
              <div className="w-full bg-[#1C1C1E] rounded-t-3xl p-6 soft-border">
                <div className="flex justify-between items-center mb-4">
                  <h2 className="text-xl font-semibold">
                    {selectedDay.date.toDateString()}
                  </h2>
                  <button
                    onClick={closeDayDetails}
                    className="text-sm text-[#8E8E93]"
                  >
                    Close
                  </button>
                </div>

                {/* Runs */}
                {runs[selectedDay.key] ? (
                  <div className="mb-4">
                    <p className="text-sm text-blue-400">Run: {runs[selectedDay.key].distance} km</p>
                  </div>
                ) : (
                  <p className="text-sm text-[#8E8E93] mb-4">No run logged</p>
                )}

                {/* Gym Routine */}
                {(() => {
                  const weekdayIndex = selectedDay.date.getDay() === 0 ? 6 : selectedDay.date.getDay() - 1;
                  const routine = weeklyPlan[WEEK_DAYS[weekdayIndex]];

                  if (!routine) {
                    return <p className="text-sm text-[#8E8E93]">No gym routine</p>;
                  }

                  return (
                    <div>
                      <p className="text-green-400 text-sm font-semibold mb-2">
                        Gym: {routine.name}
                      </p>
                      <ul className="text-sm text-[#8E8E93] space-y-1">
                        {routine.exercises.map((ex, i) => (
                          <li key={i}>{ex.name} â€” {ex.sets}Ã—{ex.reps}</li>
                        ))}
                      </ul>
                    </div>
                  );
                })()}
              </div>
            </div>
          )}
        </div>
      );
                      /* -------------------------
         GET TODAY + TOMORROW
      -------------------------- */
      function getTodayTomorrow() {
        const today = new Date();
        const tomorrow = new Date();
        tomorrow.setDate(today.getDate() + 1);

        const format = (d) =>
          WEEK_DAYS[d.getDay() === 0 ? 6 : d.getDay() - 1];

        return {
          todayKey: format(today),
          tomorrowKey: format(tomorrow),
          todayDate: today,
          tomorrowDate: tomorrow
        };
      }

      /* -------------------------
         HOME TAB
      -------------------------- */
      const HomeTab = (() => {
        const { todayKey, tomorrowKey } = getTodayTomorrow();

        const todayPlan = weeklyPlan[todayKey];
        const tomorrowPlan = weeklyPlan[tomorrowKey];

        return (
          <div className="px-6 pt-6 pb-28 space-y-8">

            {/* HEADER */}
            <h1 className="text-3xl font-semibold tracking-tight">
              Weekly Plan
            </h1>

            {/* TODAY */}
            <div className="bg-[#1C1C1E] soft-border rounded-2xl p-4">
              <p className="text-xs text-[#8E8E93] uppercase mb-1">Today</p>
              {todayPlan ? (
                <div>
                  <p className="font-semibold">{todayPlan.name}</p>
                  <ul className="text-sm text-[#8E8E93] mt-1 space-y-1">
                    {todayPlan.exercises.map((ex, i) => (
                      <li key={i}>{ex.name} â€” {ex.sets}Ã—{ex.reps}</li>
                    ))}
                  </ul>
                </div>
              ) : (
                <p className="text-sm text-[#8E8E93]">No routine today</p>
              )}
            </div>

            {/* TOMORROW */}
            <div className="bg-[#1C1C1E] soft-border rounded-2xl p-4">
              <p className="text-xs text-[#8E8E93] uppercase mb-1">Tomorrow</p>
              {tomorrowPlan ? (
                <div>
                  <p className="font-semibold">{tomorrowPlan.name}</p>
                  <ul className="text-sm text-[#8E8E93] mt-1 space-y-1">
                    {tomorrowPlan.exercises.map((ex, i) => (
                      <li key={i}>{ex.name} â€” {ex.sets}Ã—{ex.reps}</li>
                    ))}
                  </ul>
                </div>
              ) : (
                <p className="text-sm text-[#8E8E93]">No routine tomorrow</p>
              )}
            </div>

          </div>
        );
      })();

      /* -------------------------
         ROUTINE CREATION (KEPT)
      -------------------------- */
      const [creatingRoutine, setCreatingRoutine] = React.useState(false);
      const [routineName, setRoutineName] = React.useState("");
      const [routineExercises, setRoutineExercises] = React.useState([]);

      function addExercise() {
        const name = prompt("Exercise name:");
        const sets = prompt("Sets:");
        const reps = prompt("Reps:");

        if (!name || !sets || !reps) return;

        setRoutineExercises([
          ...routineExercises,
          { name, sets, reps }
        ]);
      }

      function saveRoutine() {
        if (!routineName.trim()) return;

        const newRoutine = {
          name: routineName,
          exercises: routineExercises
        };

        saveRoutines([...routines, newRoutine]);

        setRoutineName("");
        setRoutineExercises([]);
        setCreatingRoutine(false);
      }

      const RoutineCreator = creatingRoutine && (
        <div className="px-6 pt-6 pb-28 space-y-6">
          <h1 className="text-2xl font-semibold">New Routine</h1>

          <input
            value={routineName}
            onChange={(e) => setRoutineName(e.target.value)}
            placeholder="Routine name"
            className="w-full bg-[#1C1C1E] soft-border rounded-xl p-3"
          />

          <div className="space-y-2">
            {routineExercises.map((ex, i) => (
              <div key={i} className="bg-[#1C1C1E] soft-border rounded-xl p-3">
                {ex.name} â€” {ex.sets}Ã—{ex.reps}
              </div>
            ))}
          </div>

          <button
            onClick={addExercise}
            className="w-full bg-white text-black rounded-xl py-3 font-semibold"
          >
            Add Exercise
          </button>

          <button
            onClick={saveRoutine}
            className="w-full bg-green-500 text-black rounded-xl py-3 font-semibold"
          >
            Save Routine
          </button>

          <button
            onClick={() => setCreatingRoutine(false)}
            className="w-full text-[#8E8E93] py-2"
          >
            Cancel
          </button>
        </div>
      );

      /* -------------------------
         RUN CREATION (KEPT)
      -------------------------- */
      const [creatingRun, setCreatingRun] = React.useState(false);
      const [runDistance, setRunDistance] = React.useState("");

      function saveRun(dateKey) {
        if (!runDistance.trim()) return;

        const updated = {
          ...runs,
          [dateKey]: { distance: runDistance }
        };

        saveRuns(updated);
        setRunDistance("");
        setCreatingRun(false);
      }

      const RunCreator = creatingRun && selectedDay && (
        <div className="fixed inset-0 bg-black bg-opacity-60 flex items-end">
          <div className="w-full bg-[#1C1C1E] rounded-t-3xl p-6 soft-border">
            <h2 className="text-xl font-semibold mb-4">Log Run</h2>

            <input
              value={runDistance}
              onChange={(e) => setRunDistance(e.target.value)}
              placeholder="Distance (km)"
              className="w-full bg-black soft-border rounded-xl p-3 mb-4"
            />

            <button
              onClick={() => saveRun(selectedDay.key)}
              className="w-full bg-white text-black rounded-xl py-3 font-semibold"
            >
              Save Run
            </button>

            <button
              onClick={() => setCreatingRun(false)}
              className="w-full text-[#8E8E93] py-2 mt-2"
            >
              Cancel
            </button>
          </div>
        </div>
      );
                    /* -------------------------
         ASSIGN ROUTINES TO WEEKLY PLAN
      -------------------------- */
      const [assigningDay, setAssigningDay] = React.useState(null);

      function assignRoutineToDay(dayKey, routine) {
        const updated = {
          ...weeklyPlan,
          [dayKey]: routine
        };
        saveWeeklyPlan(updated);
        setAssigningDay(null);
      }

      const RoutineAssigner = assigningDay && (
        <div className="fixed inset-0 bg-black bg-opacity-60 flex items-end">
          <div className="w-full bg-[#1C1C1E] rounded-t-3xl p-6 soft-border">

            <h2 className="text-xl font-semibold mb-4">
              Assign Routine to {assigningDay}
            </h2>

            {routines.length === 0 && (
              <p className="text-sm text-[#8E8E93] mb-4">
                No routines created yet.
              </p>
            )}

            <div className="space-y-3">
              {routines.map((r, i) => (
                <button
                  key={i}
                  onClick={() => assignRoutineToDay(assigningDay, r)}
                  className="w-full bg-white text-black rounded-xl py-3 font-semibold"
                >
                  {r.name}
                </button>
              ))}
            </div>

            <button
              onClick={() => setAssigningDay(null)}
              className="w-full text-[#8E8E93] py-3 mt-4"
            >
              Cancel
            </button>
          </div>
        </div>
      );

      /* -------------------------
         MAIN APP RENDER
      -------------------------- */
      return (
        <div className="max-w-md mx-auto relative">

          {/* TABS */}
          {tab === "home" && !creatingRoutine && !creatingRun && HomeTab}
          {tab === "calendar" && CalendarTab}
          {creatingRoutine && RoutineCreator}
          {creatingRun && RunCreator}
          {assigningDay && RoutineAssigner}

          {/* FLOATING + BUTTON */}
          {!creatingRoutine && !creatingRun && tab === "home" && (
            <button
              onClick={() => setCreatingRoutine(true)}
              className="fixed bottom-24 right-6 w-14 h-14 bg-white text-black rounded-full text-3xl flex items-center justify-center soft-glow active:scale-95"
            >
              +
            </button>
          )}

          {/* NAVIGATION BAR (NO WORKOUT TAB) */}
          <div className="fixed bottom-4 left-0 right-0 max-w-md mx-auto px-6">
            <div className="glass-nav soft-border rounded-[24px] py-2.5">
              <div className="grid grid-cols-2 text-center text-xs">
                {[
                  ["home", "Home", "ðŸ "],
                  ["calendar", "Calendar", "ðŸ“…"]
                ].map(([key, label, icon], idx) => (
                  <button
                    key={idx}
                    onClick={() => setTab(key)}
                    className={`flex flex-col items-center gap-0.5 transition ${
                      tab === key ? "text-white" : "text-[#8E8E93]"
                    }`}
                  >
                    <span className="text-lg">{icon}</span>
                    <span>{label}</span>
                  </button>
                ))}
              </div>
            </div>
          </div>

        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
