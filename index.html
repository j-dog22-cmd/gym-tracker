<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Fitness Planner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      background: black;
      color: white;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
    }
    .soft-border {
      border: 1px solid rgba(255,255,255,0.08);
    }
    .glass-nav {
      background: rgba(255,255,255,0.08);
      backdrop-filter: blur(20px);
    }
  </style>
</head>

<body>
<div id="root"></div>

<script type="text/babel">

const WEEK_DAYS = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];

const getWeekIndex = d => (d.getDay() === 0 ? 6 : d.getDay() - 1);

/* -------------------- PROGRESS RING -------------------- */
function Ring({ value, color }) {
  const r = 22;
  const c = 2 * Math.PI * r;
  const o = c * (1 - value);
  return (
    <svg width="60" height="60">
      <circle r={r} cx="30" cy="30" stroke="rgba(255,255,255,.1)" strokeWidth="6" fill="none" />
      <circle r={r} cx="30" cy="30" stroke={color} strokeWidth="6" fill="none"
        strokeDasharray={c} strokeDashoffset={o}
        transform="rotate(-90 30 30)" />
    </svg>
  );
}

/* -------------------- MONTHLY GRAPH -------------------- */
function MonthlyGraph({ title, color, data, onSelect }) {
  return (
    <div className="bg-[#1C1C1E] p-4 rounded-xl soft-border mb-4">
      <p className="text-sm font-semibold mb-2">{title}</p>

      <div className="flex">
        <div className="flex flex-col justify-between text-xs text-[#8E8E93] mr-2">
          {[5,4,3,2,1,0].map(v => <span key={v}>{v}</span>)}
        </div>

        <div className="flex-1 flex items-end h-32">
          {data.map((v,i)=>(
            <button key={i} onClick={()=>onSelect(i)}
              className="flex-1 mx-1 flex flex-col items-center">
              <div className={`w-full rounded-md ${color}`}
                style={{height: `${v*20}px`}} />
              <span className="text-xs text-[#8E8E93] mt-1">W{i+1}</span>
            </button>
          ))}
        </div>
      </div>
    </div>
  );
}

/* -------------------- APP -------------------- */
function App() {

  /* SETTINGS */
  const [settings, setSettings] = React.useState(() => {
    const s = localStorage.getItem("settings");
    return s ? JSON.parse(s) : {
      name: "User",
      rest: 60,
      weeklyGym: 3,
      weeklyRun: 3,
      monthlyGoal: 12,
      gymColor: "#22c55e",
      runColor: "#38bdf8"
    };
  });

  React.useEffect(()=>{
    localStorage.setItem("settings", JSON.stringify(settings));
  },[settings]);

  /* STATE */
  const [tab,setTab]=React.useState("home");
  const [logs,setLogs]=React.useState(()=>JSON.parse(localStorage.getItem("logs")||"[]"));
  const [active,setActive]=React.useState(null);
  const [showGym,setShowGym]=React.useState(false);
  const [showRun,setShowRun]=React.useState(false);
  const [selectedDay,setSelectedDay]=React.useState(null);

  React.useEffect(()=>localStorage.setItem("logs",JSON.stringify(logs)),[logs]);

  const today = new Date();

  /* STREAK */
  const daysDone = new Set(logs.map(l=>new Date(l).toDateString()));
  let streak=0;
  let d=new Date();
  while(daysDone.has(d.toDateString())){ streak++; d.setDate(d.getDate()-1); }

  /* HOME */
  const Home = (
    <div className="px-4 pt-6 pb-32">

      <h1 className="text-2xl font-semibold mb-4">Hey, {settings.name}</h1>

      <div className="flex justify-between mb-4">
        {WEEK_DAYS.map((d,i)=>{
          const dt=new Date(); dt.setDate(today.getDate()-getWeekIndex(today)+i);
          return (
            <button key={d} onClick={()=>setSelectedDay(dt)}
              className="bg-[#1C1C1E] w-12 rounded-2xl py-2 text-center soft-border">
              <p className="text-sm">{dt.getDate()}</p>
              <p className="text-xs text-[#8E8E93]">{d}</p>
            </button>
          );
        })}
      </div>

      <div className="flex justify-between mb-4">
        <div className="flex items-center gap-3 bg-[#1C1C1E] p-3 rounded-xl soft-border flex-1 mr-2">
          <p>Gym</p>
          <Ring value={Math.min(1,daysDone.size/settings.weeklyGym)} color={settings.gymColor}/>
        </div>
        <div className="flex items-center gap-3 bg-[#1C1C1E] p-3 rounded-xl soft-border flex-1">
          <p>Run</p>
          <Ring value={Math.min(1,daysDone.size/settings.weeklyRun)} color={settings.runColor}/>
        </div>
      </div>

      <div className="flex gap-2 mb-4">
        <button onClick={()=>setShowGym(true)} className="flex-1 bg-[#1C1C1E] py-3 rounded-xl">üèãÔ∏è New Workout</button>
        <button onClick={()=>setShowRun(true)} className="flex-1 bg-[#1C1C1E] py-3 rounded-xl">üèÉ New Run</button>
      </div>

      <div className="bg-[#1C1C1E] p-4 rounded-xl soft-border">
        <p className="text-sm mb-1">üî• {streak} day streak</p>
        <p className="text-xs text-[#8E8E93]">Monthly goal: {settings.monthlyGoal}</p>
      </div>

    </div>
  );

  /* CALENDAR */
  const weeks=[0,0,0,0,0];
  logs.forEach(l=>{
    const w=Math.floor((new Date(l).getDate()-1)/7);
    weeks[w]++;
  });

  const Calendar = (
    <div className="px-4 pt-6 pb-32">
      <MonthlyGraph title="Gym Workouts" color="bg-green-400" data={weeks} onSelect={()=>{}}/>
      <MonthlyGraph title="Runs" color="bg-blue-400" data={weeks} onSelect={()=>{}}/>
    </div>
  );

  /* SETTINGS */
  const Settings = (
    <div className="px-4 pt-6 pb-32">
      <input value={settings.name}
        onChange={e=>setSettings({...settings,name:e.target.value})}
        className="w-full p-3 rounded-xl bg-[#1C1C1E] mb-3" placeholder="Name"/>

      <button onClick={()=>{
        localStorage.clear();
        location.reload();
      }} className="w-full bg-red-500 py-3 rounded-xl">Reset App</button>
    </div>
  );

  return (
    <div className="h-screen">
      {tab==="home"&&Home}
      {tab==="calendar"&&Calendar}
      {tab==="settings"&&Settings}

      <div className="fixed bottom-4 left-0 right-0 flex justify-center">
        <div className="glass-nav px-6 py-3 rounded-2xl flex gap-8">
          <button onClick={()=>setTab("home")}>üè†</button>
          <button onClick={()=>setTab("calendar")}>üìÖ</button>
          <button onClick={()=>setTab("settings")}>‚öôÔ∏è</button>
        </div>
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
