<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fitness Planner</title>

  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    html, body {
      height: 100%;
      background: black;
      color: white;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      margin: 0;
    }
    .soft-border { border: 1px solid rgba(255,255,255,0.08); }
    .glass-nav { background: rgba(255,255,255,0.08); backdrop-filter: blur(20px); }
  </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
/* ---------------- HELPERS ---------------- */
const WEEK = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];
const dayIndex = d => d.getDay() === 0 ? 6 : d.getDay() - 1;
const today = new Date();

function sameDay(a,b){
  const da = new Date(a), db = new Date(b);
  return da.toDateString() === db.toDateString();
}

/* ---------------- RING ---------------- */
function Ring({ value, total, color }) {
  const size = 52, stroke = 6;
  const r = (size - stroke) / 2;
  const c = 2 * Math.PI * r;
  return (
    <svg width={size} height={size}>
      <circle r={r} cx={size/2} cy={size/2} stroke="rgba(255,255,255,0.15)" strokeWidth={stroke} fill="none" />
      <circle
        r={r}
        cx={size/2}
        cy={size/2}
        stroke={color}
        strokeWidth={stroke}
        fill="none"
        strokeLinecap="round"
        strokeDasharray={c}
        strokeDashoffset={c * (1 - Math.min(1,value/total))}
        style={{ transform: "rotate(-90deg)", transformOrigin: "50% 50%" }}
      />
    </svg>
  );
}

/* ---------------- APP ---------------- */
function App() {
  /* SETTINGS */
  const [settings,setSettings] = React.useState(()=>{
    return JSON.parse(localStorage.getItem("settings")) || {
      name:" ",
      weeklyGym:3,
      weeklyRun:3,
      monthlyGym:12,
      monthlyRun:12,
      rest:60,
      gymColor:"#22c55e",
      runColor:"#38bdf8"
    };
  });
  React.useEffect(()=>{
    localStorage.setItem("settings",JSON.stringify(settings));
  },[settings]);

  /* LOGS */
  const [logs,setLogs] = React.useState(()=>{
    return JSON.parse(localStorage.getItem("logs")) || [];
  });
  React.useEffect(()=>{
    localStorage.setItem("logs",JSON.stringify(logs));
  },[logs]);

  /* UI STATE */
  const [tab,setTab] = React.useState("home");
  const [activeDay,setActiveDay] = React.useState(dayIndex(today));
  const [popupDay,setPopupDay] = React.useState(null); // index 0‚Äì6

  const [showGymBuilder,setShowGymBuilder] = React.useState(false);
  const [showRunBuilder,setShowRunBuilder] = React.useState(false);
  const [activeWorkout, setActiveWorkout] = React.useState(null);

  const [workoutProgress, setWorkoutProgress] = React.useState({});
  const [restTimer, setRestTimer] = React.useState(null);

  // Gym builder state
  const [gymName,setGymName] = React.useState("");
  const [gymDayIndex,setGymDayIndex] = React.useState(dayIndex(today));
  const [warmupItems,setWarmupItems] = React.useState([]);
  const [exercises,setExercises] = React.useState([]);
  const [warmDownItems,setWarmDownItems] = React.useState([]);

  // Run builder state
  const [runName,setRunName] = React.useState("");
  const [runType,setRunType] = React.useState("Easy");
  const [runDayIndex,setRunDayIndex] = React.useState(dayIndex(today));
  const [runWarmup, setRunWarmup] = React.useState([]);
  const [runStretches, setRunStretches] = React.useState([]);

  /* WEEK CALC */
  const weekStart = new Date(today);
  weekStart.setDate(today.getDate() - dayIndex(today));

  function dateFromWeekIndex(idx) {
    const d = new Date(weekStart);
    d.setDate(weekStart.getDate() + idx);
    return d;
  }

  const weekLogs = logs.filter(l => {
    const d = new Date(l.date);
    return d >= weekStart;
  });

  const gymWeek = weekLogs.filter(l => l.type === "gym").length;
  const runWeek = weekLogs.filter(l => l.type === "run").length;

  function logsForDate(d) {
    return logs.filter(l => sameDay(l.date,d));
  }

  /* ADD GYM WORKOUT */
  function saveGymWorkout() {
    const date = dateFromWeekIndex(gymDayIndex);
    const newLog = {
      type: "gym",
      date,
      name: gymName || "Gym Workout",
      warmup: warmupItems,
      exercises: exercises,
      warmdown: warmDownItems

    };
    setLogs([...logs,newLog]);
    setGymName("");
    setWarmupItems([]);
    setExercises([]);
    setShowGymBuilder(false);
    setWarmDownItems([]);
  }

  /* ADD RUN */
  function saveRun() {
    const date = dateFromWeekIndex(runDayIndex);
    const newLog = {
      type: "run",
      date,
      name: runName || "Run",
      runType,
      warmup: runWarmup,
      stretches: runStretches
      
    };
    const next = [...plan];
    next[runDayIndex].push(newLog);
    setPlan(next);
    setRunName("");
    setRunType("Easy");
    setShowRunBuilder(false);
    setRunWarmup([]);
    setRunStretches([]);
  }

  /* DELETE WORKOUT (by global index) */
  function deleteLog(globalIndex){
    setLogs(logs.filter((_,i)=>i!==globalIndex));
  }

  /* HOME */
  const Home = (
    <div className="p-5 pb-40 space-y-6">
      <h1 className="text-2xl font-semibold">Hey, {settings.name}</h1>

      {/* WEEK SELECTOR WITH DOTS + TODAY HIGHLIGHT */}
      <div className="flex gap-2 mt-3">
        {WEEK.map((d,i)=>{
          const dateObj = dateFromWeekIndex(i);
          const hasGym = logs.some(l => l.type==="gym" && sameDay(l.date,dateObj));
          const hasRun = logs.some(l => l.type==="run" && sameDay(l.date,dateObj));
          let dotColor = null;
          if (hasGym && hasRun) dotColor = "#ef4444";      // red
          else if (hasRun) dotColor = "#38bdf8";           // blue
          else if (hasGym) dotColor = "#22c55e";           // green

          const isToday = sameDay(dateObj,today);

          return (
            <button
              key={i}
              onClick={()=>{
                setActiveDay(i);
                setPopupDay(i);
              }}
              className={
                "p-3 rounded-xl soft-border flex flex-col items-center " +
                (i===activeDay ? "bg-[#1C1C1E] " : "") +
                (isToday ? "border border-white/40 bg-[#1C1C1E] " : "")
              }
            >
              <p className="text-xs">{d}</p>
              <p className={"text-sm " + (isToday ? "font-bold text-white" : "")}>
                {dateObj.getDate()}
              </p>
              {dotColor && (
                <div
                  className="mt-1 rounded-full"
                  style={{width:"4px",height:"4px",backgroundColor:dotColor}}
                />
              )}
            </button>
          );
        })}
      </div>

      {/* WEEK PROGRESS */}
      <div className="space-y-4 mt-4">
        <div className="p-4 bg-[#1C1C1E] rounded-2xl soft-border flex justify-between items-center">
          <div>
            <p>Gym this week</p>
            <p className="text-xs">{gymWeek}/{settings.weeklyGym}</p>
          </div>
          <Ring value={gymWeek} total={settings.weeklyGym} color={settings.gymColor} />
        </div>
        <div className="p-4 bg-[#1C1C1E] rounded-2xl soft-border flex justify-between items-center">
          <div>
            <p>Runs this week</p>
            <p className="text-xs">{runWeek}/{settings.weeklyRun}</p>
          </div>
          <Ring value={runWeek} total={settings.weeklyRun} color={settings.runColor} />
        </div>
      </div>

  <p className="text-lg font-semibold mt-4">Your Plan</p>
      
      {/* TODAY / TOMORROW WITH DOTS PER WORKOUT */}
      <div className="grid grid-cols-2 gap-3">
        {[0,1].map(o=>{
          const d = new Date();
          d.setDate(today.getDate()+o);
          const label = o === 0 ? "Today" : "Tomorrow";
          const dayLogs = logsForDate(d);

          return (
            <div
              key={o}
              onClick={()=>setPopupDay(dayIndex(d))}
              className="p-4 bg-[#1C1C1E] rounded-2xl soft-border space-y-2"
            >
              <p className="text-xs">{label}</p>
              <p className="font-semibold">{WEEK[dayIndex(d)]}</p>

              {dayLogs.length > 0 ? (
                dayLogs.map((l,i)=>(
                  <p key={i} className="text-xs flex items-center gap-1">
                    <span
                      className="inline-block rounded-full"
                      style={{
                        width:"4px",
                        height:"4px",
                        backgroundColor:
                          l.type === "gym" ? "#22c55e" :
                          l.type === "run" ? "#38bdf8" :
                          "#ef4444"
                      }}
                    />
                    {l.name || (l.type==="gym" ? "Gym Workout" : "Run")}
                  </p>
                ))
              ) : (
                <p className="text-xs text-gray-400">No workouts scheduled</p>
              )}
            </div>
          );
        })}
      </div>

      {/* QUICK ADD */}
      <div className="grid grid-cols-2 gap-3">
        <button
          onClick={()=>{
            setGymDayIndex(activeDay);
            setShowGymBuilder(true);
          }}
          className="p-4 bg-[#1C1C1E] rounded-2xl soft-border"
        >
          ‚ûï New Workout
        </button>
        <button
          onClick={()=>{
            setRunDayIndex(activeDay);
            setShowRunBuilder(true);
          }}
          className="p-4 bg-[#1C1C1E] rounded-2xl soft-border"
        >
          ‚ûï New Run
        </button>
      </div>

      {/* MONTHLY GOALS */}
      <div className="p-4 bg-[#1C1C1E] rounded-2xl soft-border">
        <p className="font-semibold mb-2">Monthly Goals</p>
        <p className="text-xs">
          Gym {logs.filter(l=>l.type==="gym").length}/{settings.monthlyGym}
        </p>
        <p className="text-xs">
          Run {logs.filter(l=>l.type==="run").length}/{settings.monthlyRun}
        </p>
      </div>
    </div>
  );

  /* PLACEHOLDER CALENDAR & SETTINGS */
  const Calendar = (
    <div className="p-4">
      <p className="font-semibold">Calendar (to be built next)</p>
    </div>
  );

  const SettingsView = (
    <div className="p-4 space-y-3">
      <p className="font-semibold">Settings</p>
      <input
        className="w-full p-3 rounded-xl bg-[#2C2C2E] text-base"
        value={settings.name}
        onChange={e=>setSettings({...settings,name:e.target.value})}
        placeholder="Name"
      />
      <button
        onClick={()=>{
          localStorage.clear();
          location.reload();
        }}
        className="bg-red-500 p-3 rounded-xl text-sm"
      >
        Reset App
      </button>
    </div>
  );

  <div className="p-4 bg-[#1C1C1E] rounded-2xl soft-border space-y-2">
    <p className="text-sm font-semibold">Rest Timer (seconds)</p>
    <input
      type="number"
      min="5"
      max="300"
      value={settings.rest}
      onChange={e => setSettings({...settings, rest: Number(e.target.value)})}
      className="w-full p-2 rounded-xl bg-[#2A2A2A] text-sm"
    />
  </div>

/* DAY POPUP WITH DELETE */
const DayPopup = popupDay !== null ? (() => {
  const d = dateFromWeekIndex(popupDay);
  const dayLogs = logs
    .map((l,i)=>({...l,_idx:i}))
    .filter(l=>sameDay(l.date,d));

  
const WorkoutScreen = activeWorkout ? (
  <div className="fixed inset-0 bg-black z-50 p-5 overflow-y-auto">

    {/* HEADER */}
    <div className="flex justify-between items-center mb-4">
      <p className="text-lg font-semibold">{activeWorkout.name}</p>
      <button
        onClick={()=>setActiveWorkout(null)}
        className="text-sm text-gray-400"
      >
        Close
      </button>
    </div>

    {/* RUN WORKOUT EXECUTION */}
    {activeWorkout.type === "run" && (
      <div className="space-y-6">

        {/* RUN TYPE */}
        <div>
          <p className="text-sm text-gray-400 mb-2">Run Type</p>
          <div className="p-4 bg-[#1C1C1E] rounded-2xl mb-3">
            <p className="text-base font-medium">{activeWorkout.runType}</p>
          </div>
        </div>

        {/* Warm-up */}
        {activeWorkout.warmup?.length > 0 && (
          <div>
            <p className="text-sm text-gray-400 mb-2">Warm‚Äëup</p>
            {activeWorkout.warmup.map((w,i)=>(
              <div key={i} className="p-4 bg-[#1C1C1E] rounded-2xl mb-3">
                <p className="text-base font-medium">{w.name}</p>
                <p className="text-sm text-gray-400">{w.reps}</p>
              </div>
            ))}
          </div>
        )}

        {/* Stretches */}
        {activeWorkout.stretches?.length > 0 && (
          <div>
            <p className="text-sm text-gray-400 mb-2">Stretches</p>
            {activeWorkout.stretches.map((s,i)=>(
              <div key={i} className="p-4 bg-[#1C1C1E] rounded-2xl mb-3">
                <p className="text-base font-medium">{s.name}</p>
                <p className="text-sm text-gray-400">{s.reps}</p>
              </div>
            ))}
          </div>
        )}

       {/* MARK RUN AS DONE */}
        <button
          onClick={() => {
            const completedRun = {
              ...activeWorkout,
              completed: true,
              date: new Date()
            };
        
            // 1. Add to logs
            setLogs([...logs, completedRun]);
        
            // 2. Remove from plan
            const next = [...plan];
            next[activeWorkout.dayIndex].splice(activeWorkout.workoutIndex, 1);
            setPlan(next);
        
            // 3. Close workout screen
            setActiveWorkout(null);
          }}
          className="w-full bg-blue-500 py-4 rounded-2xl text-lg font-semibold mt-4"
        >
          Mark Run as Done
        </button>

    {/* GYM WORKOUT EXECUTION */}
    {activeWorkout.type === "gym" && (
    <div className="space-y-4">
  
      {/* Warm-up */}
      {activeWorkout.warmup?.length > 0 && (
        <div>
          <p className="text-xs text-gray-400 mb-1">Warm‚Äëup</p>
          {activeWorkout.warmup.map((w,i)=>(
            <div key={i} className="p-3 bg-[#1C1C1E] rounded-xl mb-2">
              <p className="text-sm">{w.name}</p>
              <p className="text-xs text-gray-400">{w.reps}</p>
            </div>
          ))}
        </div>
      )}
  
      {/* Exercises */}
      {activeWorkout.exercises?.length > 0 && (
        <div>
          <p className="text-xs text-gray-400 mb-1">Exercises</p>
  
          {activeWorkout.exercises.map((ex,i)=>{
            const sets = Number(ex.sets) || 0;
            const completed = workoutProgress[i] || 0;
  
            return (
              <div key={i} className="p-3 bg-[#1C1C1E] rounded-xl mb-2">
                <p className="text-sm mb-3">{ex.name}</p>
  
                <div className="flex flex-col gap-3">
                  {[...Array(sets)].map((_,s)=>(
                    <div
                      key={s}
                      onClick={()=>{
                        const next = {...workoutProgress};
                        next[i] = s + 1;
                        setWorkoutProgress(next);
                        setRestTimer(settings.rest);
                      }}
                      className="flex items-center gap-3 cursor-pointer"
                    >
                      <div
                        className={
                          "w-7 h-7 rounded-full border-2 flex items-center justify-center transition-all " +
                          (s < completed
                            ? "bg-green-500 border-green-500"
                            : "border-gray-500")
                        }
                      >
                        {s < completed && (
                          <span className="text-white text-lg leading-none">‚úì</span>
                        )}
                      </div>
  
                      <span className="text-sm text-gray-300">
                        Set {s+1} ‚Äî {ex.reps} reps
                      </span>
                    </div>
                  ))}
                </div>
              </div>
            );
          })}
        </div>
      )}
  
      {/* ‚≠ê MARK GYM WORKOUT AS DONE BUTTON GOES HERE ‚≠ê */}
      <button
        onClick={() => {
          const completedWorkout = {
            ...activeWorkout,
            completed: true,
            date: new Date()
          };
  
          // 1. Add to logs
          setLogs([...logs, completedWorkout]);
  
          // 2. Remove from plan
          const next = [...plan];
          next[activeWorkout.dayIndex].splice(activeWorkout.workoutIndex, 1);
          setPlan(next);
  
          // 3. Close workout screen
          setActiveWorkout(null);
        }}
        className="w-full bg-blue-500 py-4 rounded-2xl text-lg font-semibold mt-4"
      >
        Mark Workout as Done
      </button>
  
    </div>
  )}
  </div>
) : null;
  
  return (
    <div className="fixed inset-0 bg-black/60 flex items-end justify-center z-40">
      <div className="w-full max-h-[80%] bg-[#111111] rounded-t-3xl p-5 space-y-3 overflow-y-auto">

        <div className="flex justify-between items-center mb-2">
          <p className="font-semibold text-lg">{WEEK[popupDay]} routines</p>
          <button onClick={()=>setPopupDay(null)} className="text-sm text-gray-400">Close</button>
        </div>

        {dayLogs.length === 0 ? (
          <p className="text-xs text-gray-400">No workouts scheduled.</p>
        ) : (
          dayLogs.map((l,i)=>(
            <div key={i} className="p-3 rounded-2xl bg-[#1C1C1E] soft-border space-y-2">

              {/* TITLE */}
              <p className="text-sm font-semibold">
                {l.type === "gym" ? (l.name || "Gym Workout") : (l.name || "Run")}
              </p>

              {/* ---------------- RUN SECTION ---------------- */}
              {l.type === "run" && (
                <>
                  <p className="text-xs text-gray-400">Type: {l.runType}</p>

                  {/* RUN WARM-UP */}
                  {l.warmup && l.warmup.length > 0 && (
                    <div className="mt-1">
                      <p className="text-[11px] text-gray-400 mb-1">Warm‚Äëup</p>
                      {l.warmup.map((w,j)=>(
                        <p key={j} className="text-[11px]">‚Ä¢ {w.name} ({w.reps})</p>
                      ))}
                    </div>
                  )}

                  {/* RUN STRETCHES */}
                  {l.stretches && l.stretches.length > 0 && (
                    <div className="mt-1">
                      <p className="text-[11px] text-gray-400 mb-1">Stretches</p>
                      {l.stretches.map((w,j)=>(
                        <p key={j} className="text-[11px]">‚Ä¢ {w.name} ({w.reps})</p>
                      ))}
                    </div>
                  )}
                </>
              )}

              {/* ---------------- GYM SECTION ---------------- */}
              {l.type === "gym" && (
                <>
                  {/* GYM WARM-UP */}
                  {l.warmup && l.warmup.length > 0 && (
                    <div className="mt-1">
                      <p className="text-[11px] text-gray-400 mb-1">Warm‚Äëup</p>
                      {l.warmup.map((w,j)=>(
                        <p key={j} className="text-[11px]">‚Ä¢ {w.name} ({w.reps})</p>
                      ))}
                    </div>
                  )}

                  {/* GYM EXERCISES */}
                  {l.exercises && l.exercises.length > 0 && (
                    <div className="mt-1">
                      <p className="text-[11px] text-gray-400 mb-1">Exercises</p>
                      {l.exercises.map((ex,j)=>(
                        <p key={j} className="text-[11px]">
                          ‚Ä¢ {ex.name} ‚Äî {ex.sets} x {ex.reps}
                        </p>
                      ))}
                    </div>
                  )}

                  {/* GYM WARM-DOWN */}
                  {l.warmdown && l.warmdown.length > 0 && (
                    <div className="mt-1">
                      <p className="text-[11px] text-gray-400 mb-1">Warm‚Äëdown</p>
                      {l.warmdown.map((w,j)=>(
                        <p key={j} className="text-[11px]">‚Ä¢ {w.name} ({w.reps})</p>
                      ))}
                    </div>
                  )}
                </>
              )}

              <button
                onClick={()=>{
                  setActiveWorkout(l);
                  setWorkoutProgress({});
                }}
                className="w-full bg-green-600 rounded-xl py-2 text-xs"
              >
                Start Workout
              </button>

              {/* DELETE BUTTON */}
              <button
                onClick={()=>deleteLog(l._idx)}
                className="w-full bg-red-600 rounded-xl py-2 text-xs mt-1"
              >
                Delete Workout
              </button>

            </div>
          ))
        )}

      </div>
    </div>
  );
})() : null;

  /* BOTTOM-SHEET GYM BUILDER (AUTO HEIGHT, NO ZOOM) */
  const GymBuilder = showGymBuilder ? (
    <div className="fixed inset-0 bg-black/60 flex items-end justify-center z-50">
      <div className="w-full max-h-[85%] bg-[#111111] rounded-t-3xl pt-4 px-5 pb-6 overflow-y-auto">
        <div className="flex justify-between items-center mb-4">
          <p className="font-semibold text-lg">New Gym Workout</p>
          <button
            onClick={()=>setShowGymBuilder(false)}
            className="text-sm text-gray-400"
          >
            Close
          </button>
        </div>

        <div className="space-y-2 mb-4">
          <p className="text-xs text-gray-400">Routine name</p>
          <input
            className="w-full p-3 rounded-xl bg-[#2C2C2E] text-base"
            placeholder="Push Day, Legs, Upper A..."
            value={gymName}
            onChange={e=>setGymName(e.target.value)}
          />
        </div>

        <div className="space-y-2 mb-4">
          <div className="flex justify-between items-center">
            <p className="text-xs text-gray-400">Warm-up</p>
            <button
              onClick={()=>setWarmupItems([...warmupItems,{name:"",reps:""}])}
              className="text-xs text-blue-400"
            >
              + Add
            </button>
          </div>
          {warmupItems.length === 0 && (
            <p className="text-[11px] text-gray-500">No warm-up items yet.</p>
          )}
          {warmupItems.map((w,i)=>(
            <div key={i} className="flex gap-2 mb-1">
              <input
                className="flex-1 p-2 rounded-lg bg-[#2C2C2E] text-base"
                placeholder="Movement"
                value={w.name}
                onChange={e=>{
                  const next=[...warmupItems];
                  next[i]={...next[i],name:e.target.value};
                  setWarmupItems(next);
                }}
              />
              <input
                className="w-28 p-2 rounded-lg bg-[#2C2C2E] text-base"
                placeholder="Reps/time"
                value={w.reps}
                onChange={e=>{
                  const next=[...warmupItems];
                  next[i]={...next[i],reps:e.target.value};
                  setWarmupItems(next);
                }}
              />
            </div>
          ))}
        </div>

        <div className="space-y-2 mb-4">
          <div className="flex justify-between items-center">
            <p className="text-xs text-gray-400">Exercises</p>
            <button
              onClick={()=>setExercises([...exercises,{name:"",sets:"",reps:""}])}
              className="text-xs text-blue-400"
            >
              + Add
            </button>
          </div>
          {exercises.length === 0 && (
            <p className="text-[11px] text-gray-500">No exercises yet.</p>
          )}
          {exercises.map((ex,i)=>(
            <div key={i} className="flex gap-2 mb-1">
              <input
                className="flex-1 p-2 rounded-lg bg-[#2C2C2E] text-base"
                placeholder="Exercise"
                value={ex.name}
                onChange={e=>{
                  const next=[...exercises];
                  next[i]={...next[i],name:e.target.value};
                  setExercises(next);
                }}
              />
              <input
                className="w-20 p-2 rounded-lg bg-[#2C2C2E] text-base"
                placeholder="Sets"
                value={ex.sets}
                onChange={e=>{
                  const next=[...exercises];
                  next[i]={...next[i],sets:e.target.value};
                  setExercises(next);
                }}
              />
              <input
                className="w-20 p-2 rounded-lg bg-[#2C2C2E] text-base"
                placeholder="Reps"
                value={ex.reps}
                onChange={e=>{
                  const next=[...exercises];
                  next[i]={...next[i],reps:e.target.value};
                  setExercises(next);
                }}
              />
            </div>
          ))}
        </div>
        
        {/* WARM-DOWN */}
        <div className="space-y-2 mb-4">
          <div className="flex justify-between items-center">
            <p className="text-xs text-gray-400">Warm‚Äëdown</p>
            <button
              onClick={()=>setWarmDownItems([...warmDownItems,{name:"",reps:""}])}
              className="text-xs text-blue-400"
            >
              + Add
            </button>
          </div>
        
          {warmDownItems.length === 0 && (
            <p className="text-[11px] text-gray-500">No warm‚Äëdown items yet.</p>
          )}
        
          {warmDownItems.map((w,i)=>(
            <div key={i} className="flex gap-2 mb-1">
              <input
                className="flex-1 p-2 rounded-lg bg-[#2C2C2E] text-base"
                placeholder="Movement"
                value={w.name}
                onChange={e=>{
                  const next=[...warmDownItems];
                  next[i]={...next[i],name:e.target.value};
                  setWarmDownItems(next);
                }}
              />
              <input
                className="w-28 p-2 rounded-lg bg-[#2C2C2E] text-base"
                placeholder="Reps/time"
                value={w.reps}
                onChange={e=>{
                  const next=[...warmDownItems];
                  next[i]={...next[i],reps:e.target.value};
                  setWarmDownItems(next);
                }}
              />
            </div>
          ))}
        </div>
        
        <div className="space-y-2 mb-6">
          <p className="text-xs text-gray-400">Day</p>
          <select
            className="w-full p-3 rounded-xl bg-[#2C2C2E] text-base"
            value={gymDayIndex}
            onChange={e=>setGymDayIndex(+e.target.value)}
          >
            {WEEK.map((d,i)=>(
              <option key={i} value={i}>{d}</option>
            ))}
          </select>
        </div>

        <button
          onClick={saveGymWorkout}
          className="w-full bg-blue-500 rounded-xl py-3 text-sm font-semibold"
        >
          Save Workout
        </button>
      </div>
    </div>
  ) : null;

  /* BOTTOM-SHEET RUN BUILDER (AUTO HEIGHT, NO ZOOM) */
  const RunBuilder = showRunBuilder ? (
    <div className="fixed inset-0 bg-black/60 flex items-end justify-center z-50">
      <div className="w-full max-h-[70%] bg-[#111111] rounded-t-3xl pt-4 px-5 pb-6 overflow-y-auto">
        <div className="flex justify-between items-center mb-4">
          <p className="font-semibold text-lg">New Run</p>
          <button
            onClick={()=>setShowRunBuilder(false)}
            className="text-sm text-gray-400"
          >
            Close
          </button>
        </div>

        <div className="space-y-2 mb-4">
          <p className="text-xs text-gray-400">Run name</p>
          <input
            className="w-full p-3 rounded-xl bg-[#2C2C2E] text-base"
            placeholder="5K Tempo, Easy Loop..."
            value={runName}
            onChange={e=>setRunName(e.target.value)}
          />
        </div>

        <div className="space-y-2 mb-4">
          <p className="text-xs text-gray-400">Run type</p>
          <select
            className="w-full p-3 rounded-xl bg-[#2C2C2E] text-base"
            value={runType}
            onChange={e=>setRunType(e.target.value)}
          >
            <option>Easy</option>
            <option>Tempo</option>
            <option>Long</option>
            <option>Other</option>
          </select>
        </div>
        
        {/* RUN WARM-UP */}
        <div className="space-y-2 mb-4">
          <div className="flex justify-between items-center">
            <p className="text-xs text-gray-400">Warm‚Äëup</p>
            <button
              onClick={()=>setRunWarmup([...runWarmup,{name:"",reps:""}])}
              className="text-xs text-blue-400"
            >
              + Add
            </button>
          </div>
        
          {runWarmup.length === 0 && (
            <p className="text-[11px] text-gray-500">No warm‚Äëup items yet.</p>
          )}
        
          {runWarmup.map((w,i)=>(
            <div key={i} className="flex gap-2 mb-1">
              <input
                className="flex-1 p-2 rounded-lg bg-[#2C2C2E] text-base"
                placeholder="Movement"
                value={w.name}
                onChange={e=>{
                  const next=[...runWarmup];
                  next[i]={...next[i],name:e.target.value};
                  setRunWarmup(next);
                }}
              />
              <input
                className="w-28 p-2 rounded-lg bg-[#2C2C2E] text-base"
                placeholder="Reps/time"
                value={w.reps}
                onChange={e=>{
                  const next=[...runWarmup];
                  next[i]={...next[i],reps:e.target.value};
                  setRunWarmup(next);
                }}
              />
            </div>
          ))}
        </div>
        
        {/* RUN STRETCHES / WARM-DOWN */}
        <div className="space-y-2 mb-6">
          <div className="flex justify-between items-center">
            <p className="text-xs text-gray-400">Stretches / Warm‚Äëdown</p>
            <button
              onClick={()=>setRunStretches([...runStretches,{name:"",reps:""}])}
              className="text-xs text-blue-400"
            >
              + Add
            </button>
          </div>
        
          {runStretches.length === 0 && (
            <p className="text-[11px] text-gray-500">No stretches yet.</p>
          )}
        
          {runStretches.map((w,i)=>(
            <div key={i} className="flex gap-2 mb-1">
              <input
                className="flex-1 p-2 rounded-lg bg-[#2C2C2E] text-base"
                placeholder="Stretch"
                value={w.name}
                onChange={e=>{
                  const next=[...runStretches];
                  next[i]={...next[i],name:e.target.value};
                  setRunStretches(next);
                }}
              />
              <input
                className="w-28 p-2 rounded-lg bg-[#2C2C2E] text-base"
                placeholder="Reps/time"
                value={w.reps}
                onChange={e=>{
                  const next=[...runStretches];
                  next[i]={...next[i],reps:e.target.value};
                  setRunStretches(next);
                }}
              />
            </div>
          ))}
        </div>
        
        <div className="space-y-2 mb-6">
          <p className="text-xs text-gray-400">Day</p>
          <select
            className="w-full p-3 rounded-xl bg-[#2C2C2E] text-base"
            value={runDayIndex}
            onChange={e=>setRunDayIndex(+e.target.value)}
          >
            {WEEK.map((d,i)=>(
              <option key={i} value={i}>{d}</option>
            ))}
          </select>
        </div>

        <button
          onClick={saveRun}
          className="w-full bg-blue-500 rounded-xl py-3 text-sm font-semibold"
        >
          Save Run
        </button>
      </div>
    </div>
  ) : null;

const WorkoutScreen = activeWorkout ? (
  <div className="fixed inset-0 bg-gradient-to-b from-black to-[#0f0f0f] z-50 p-6 overflow-y-auto text-lg">

    {/* HEADER */}
    <div className="flex justify-between items-center mb-6">
      <p className="text-2xl font-bold">{activeWorkout.name}</p>
      <button
        onClick={() => setActiveWorkout(null)}
        className="text-gray-400 text-lg"
      >
        Close
      </button>
    </div>

    React.useEffect(() => {
      if (restTimer === null) return;
    
      if (restTimer > 0) {
        const interval = setInterval(() => {
          setRestTimer(t => t - 1);
        }, 1000);
    
        return () => clearInterval(interval);
      }
    
      if (restTimer === 0) {
        // Optional: phone vibration when rest ends
        if (navigator.vibrate) {
          navigator.vibrate(300);
        }
      }
    }, [restTimer]);
    

    {/* ---------------- RUN WORKOUT EXECUTION ---------------- */}
    {activeWorkout.type === "run" && (
      <div className="space-y-6">

        {/* RUN TYPE */}
        <div>
          <p className="text-sm text-gray-400 mb-2">Run Type</p>
          <div className="p-4 bg-[#1C1C1E] rounded-2xl mb-3">
            <p className="text-base font-medium">{activeWorkout.runType}</p>
          </div>
        </div>

        {/* Warm-up */}
        {activeWorkout.warmup?.length > 0 && (
          <div>
            <p className="text-sm text-gray-400 mb-2">Warm‚Äëup</p>
            {activeWorkout.warmup.map((w,i)=>(
              <div key={i} className="p-4 bg-[#1C1C1E] rounded-2xl mb-3">
                <p className="text-base font-medium">{w.name}</p>
                <p className="text-sm text-gray-400">{w.reps}</p>
              </div>
            ))}
          </div>
        )}

        {/* Stretches */}
        {activeWorkout.stretches?.length > 0 && (
          <div>
            <p className="text-sm text-gray-400 mb-2">Stretches</p>
            {activeWorkout.stretches.map((s,i)=>(
              <div key={i} className="p-4 bg-[#1C1C1E] rounded-2xl mb-3">
                <p className="text-base font-medium">{s.name}</p>
                <p className="text-sm text-gray-400">{s.reps}</p>
              </div>
            ))}
          </div>
        )}

        {/* MARK RUN AS DONE */}
        <button
          onClick={() => {
            const completed = {
              ...activeWorkout,
              completed: true,
              date: new Date()
            };

            // Add to logs
            setLogs([...logs, completed]);

            // Remove from plan
            const next = [...plan];
            next[activeWorkout.dayIndex].splice(activeWorkout.workoutIndex, 1);
            setPlan(next);

            // Close screen
            setActiveWorkout(null);
          }}
          className="w-full bg-blue-500 py-4 rounded-2xl text-lg font-semibold mt-4"
        >
          Mark Run as Done
        </button>

      </div>
    )}

    {/* ---------------- GYM WORKOUT EXECUTION ---------------- */}
    {activeWorkout.type === "gym" && (
      <div className="space-y-6">

        {/* Warm-up */}
        {activeWorkout.warmup?.length > 0 && (
          <div>
            <p className="text-sm text-gray-400 mb-2">Warm‚Äëup</p>
            {activeWorkout.warmup.map((w,i)=>(
              <div key={i} className="p-4 bg-[#1C1C1E] rounded-2xl mb-3">
                <p className="text-base font-medium">{w.name}</p>
                <p className="text-sm text-gray-400">{w.reps}</p>
              </div>
            ))}
          </div>
        )}

      {/* Exercises */}
      {activeWorkout.exercises?.length > 0 && (
        <div>
          <p className="text-xs text-gray-400 mb-1">Exercises</p>
      
          {activeWorkout.exercises.map((ex, i) => {
            const sets = Number(ex.sets) || 0;
            const completed = workoutProgress[i] || 0;
      
            return (
              <div key={i} className="p-3 bg-[#1C1C1E] rounded-xl mb-2">
                <p className="text-sm mb-3">{ex.name}</p>
      
                <div className="flex flex-col gap-3">
                  {[...Array(sets)].map((_, s) => (
                    <div
                      key={s}
                      onClick={() => {
                        const next = { ...workoutProgress };
                        next[i] = s + 1;
                        setWorkoutProgress(next);
      
                        // Start rest timer
                        setRestTimer(settings.rest);
                      }}
                      className="flex items-center gap-3 cursor-pointer"
                    >
                      <div
                        className={
                          "w-7 h-7 rounded-full border-2 flex items-center justify-center transition-all " +
                          (s < completed
                            ? "bg-green-500 border-green-500"
                            : "border-gray-500")
                        }
                      >
                        {s < completed && (
                          <span className="text-white text-lg leading-none">‚úì</span>
                        )}
                      </div>
      
                      <span className="text-sm text-gray-300">
                        Set {s + 1} ‚Äî {ex.reps} reps
                      </span>
                    </div>
                  ))}
                </div>
              </div>
            );
          })}
        </div>
      )}

        {/* Warm-down */}
        {activeWorkout.warmdown?.length > 0 && (
          <div>
            <p className="text-sm text-gray-400 mb-2">Warm‚Äëdown</p>
            {activeWorkout.warmdown.map((w,i)=>(
              <div key={i} className="p-4 bg-[#1C1C1E] rounded-2xl mb-3">
                <p className="text-base font-medium">{w.name}</p>
                <p className="text-sm text-gray-400">{w.reps}</p>
              </div>
            ))}
          </div>
        )}

        {/* MARK GYM AS DONE */}
        <button
          onClick={() => {
            const completed = {
              ...activeWorkout,
              completed: true,
              date: new Date()
            };

            // Add to logs
            setLogs([...logs, completed]);

            // Remove from plan
            const next = [...plan];
            next[activeWorkout.dayIndex].splice(activeWorkout.workoutIndex, 1);
            setPlan(next);

            // Close screen
            setActiveWorkout(null);
          }}
          className="w-full bg-blue-500 py-4 rounded-2xl text-lg font-semibold mt-4"
        >
          Mark Workout as Done
        </button>

      </div>
    )}

  </div>
) : null;
  
return (
    <div>
      {tab==="home" && Home}
      {tab==="calendar" && Calendar}
      {tab==="settings" && SettingsView}
      {WorkoutScreen}

      <div className="fixed bottom-4 inset-x-0 flex justify-center">
        <div className="glass-nav px-6 py-2 rounded-2xl flex gap-8">
          <button onClick={()=>setTab("home")}>üè†</button>
          <button onClick={()=>setTab("calendar")}>üìÖ</button>
          <button onClick={()=>setTab("settings")}>‚öôÔ∏è</button>
        </div>
      </div>

      {DayPopup}
      {GymBuilder}
      {RunBuilder}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
