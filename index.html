<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JPB Fitness</title>

  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    html, body {
      height: 100%;
      background: black;
      color: white;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      margin: 0;
    }
    .soft-border { border: 1px solid rgba(255,255,255,0.08); }
    .glass-nav { background: rgba(255,255,255,0.08); backdrop-filter: blur(20px); }
  </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
/* ---------------- HELPERS ---------------- */
const WEEK = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];
const dayIndex = d => d.getDay() === 0 ? 6 : d.getDay() - 1;
const today = new Date();

function sameDay(a,b){
  const da = new Date(a), db = new Date(b);
  return da.toDateString() === db.toDateString();
}

/* ---------------- RING ---------------- */
function Ring({ value, total, color }) {
  const size = 52, stroke = 6;
  const r = (size - stroke) / 2;
  const c = 2 * Math.PI * r;
  const ratio = total > 0 ? Math.min(1, value / total) : 0;

  return (
    <svg width={size} height={size}>
      <circle
        r={r}
        cx={size/2}
        cy={size/2}
        stroke="rgba(255,255,255,0.15)"
        strokeWidth={stroke}
        fill="none"
      />
      <circle
        r={r}
        cx={size/2}
        cy={size/2}
        stroke={color}
        strokeWidth={stroke}
        fill="none"
        strokeLinecap="round"
        strokeDasharray={c}
        strokeDashoffset={c * (1 - ratio)}
        style={{ transform: "rotate(-90deg)", transformOrigin: "50% 50%" }}
      />
    </svg>
  );
}

/* ---------------- line graph ---------------- */
function CombinedLineGraph({ gymData, runData, gymColor, runColor }) {
  const rawMax = Math.max(...gymData, ...runData, 1);
  const max = Math.max(5, rawMax + 1);   // always at least 5, with headroom
  const min = 0;

  const width = window.innerWidth - 40;  // ‚≠ê full width minus padding
  const height = 220;                    // ‚≠ê taller graph
  const padding = 40;                    // ‚≠ê more breathing room

  function makePoints(data) {
    return data.map((v, i) => {
      const x = padding + (i / (data.length - 1)) * (width - padding * 2);
      const y = height - padding - ((v - min) / (max - min)) * (height - padding * 2);
      return { x, y };
    });
  }

  const gymPoints = makePoints(gymData);
  const runPoints = makePoints(runData);

  return (
    <svg
      width="100%"
      height={height}
      viewBox={`0 0 ${width} ${height}`}
      className="mt-3"
    >
      {/* Y-axis */}
      <line
        x1={padding}
        y1={padding}
        x2={padding}
        y2={height - padding}
        stroke="#666"
        strokeWidth="1.4"
      />

      {/* X-axis */}
      <line
        x1={padding}
        y1={height - padding}
        x2={width - padding}
        y2={height - padding}
        stroke="#666"
        strokeWidth="1.4"
      />

     {/* Y-axis labels 0‚Äì5 */}
<text
  x={padding - 10}
  y={height - padding + 4}
  fontSize="12"
  textAnchor="end"
  fill="#aaa"
>
  0
</text>

{[1, 2, 3, 4, 5].map((n) => {
  const y = height - padding - ((n - min) / (max - min)) * (height - padding * 2);
  return (
    <text
      key={n}
      x={padding - 10}
      y={y + 4}
      fontSize="12"
      textAnchor="end"
      fill="#aaa"
    >
      {n}
    </text>
  );
})}

      {/* X labels */}
      {gymPoints.map((p, i) => (
        <text
          key={i}
          x={p.x}
          y={height - padding + 20}
          fontSize="12"
          textAnchor="middle"
          fill="#aaa"
        >
          W{i + 1}
        </text>
      ))}

      {/* Gym line */}
      <polyline
        fill="none"
        stroke={gymColor}
        strokeWidth="3"
        points={gymPoints.map(p => `${p.x},${p.y}`).join(" ")}
      />

      {/* Run line */}
      <polyline
        fill="none"
        stroke={runColor}
        strokeWidth="3"
        points={runPoints.map(p => `${p.x},${p.y}`).join(" ")}
      />

      {/* Dots */}
      {gymPoints.map((p, i) => {
        const same = gymData[i] === runData[i];
        return (
          <circle
            key={"g" + i}
            cx={p.x}
            cy={p.y}
            r="5"
            fill={same ? "red" : gymColor}
          />
        );
      })}

      {runPoints.map((p, i) => {
        const same = gymData[i] === runData[i];
        return (
          <circle
            key={"r" + i}
            cx={p.x}
            cy={p.y}
            r="5"
            fill={same ? "red" : runColor}
          />
        );
      })}
    </svg>
  );
}
/* ---------------- APP ---------------- */
function App() {
  /* SETTINGS */
  const [settings, setSettings] = React.useState(() => {
    return JSON.parse(localStorage.getItem("settings")) || {
      name: "User",
      weeklyGym: 3,
      weeklyRun: 3,
      monthlyGym: 12,
      monthlyRun: 12,
      defaultRest: 60,
      gymColor: "#22c55e",
      runColor: "#38bdf8"
    };
  });

// Background‚Äësafe rest timer
const [restEndTime, setRestEndTime] = React.useState(null);
const [currentTime, setCurrentTime] = React.useState(Date.now());

// Update currentTime every 500ms
React.useEffect(() => {
  const interval = setInterval(() => {
    setCurrentTime(Date.now());
  }, 500);

  return () => clearInterval(interval);
}, []);

// Start rest timer
function startRest(seconds) {
  setRestEndTime(Date.now() + seconds * 1000);
}

// Time left
const timeLeft = restEndTime
  ? Math.max(0, Math.floor((restEndTime - currentTime) / 1000))
  : 0;

// When timer finishes
React.useEffect(() => {
  if (restEndTime && timeLeft === 0) {
    setRestEndTime(null);
  }
}, [timeLeft, restEndTime]);

  React.useEffect(() => {
    localStorage.setItem("settings", JSON.stringify(settings));
  }, [settings]);

  /* LOGS */
  const [logs,setLogs] = React.useState(()=>{
    return JSON.parse(localStorage.getItem("logs")) || [];
  });
  React.useEffect(()=>{
    localStorage.setItem("logs",JSON.stringify(logs));
  },[logs]);

  // Build weekly data for the current month
  const now = new Date();
  const year = now.getFullYear();
  const month = now.getMonth();
  
  // First and last day of the month
  const firstDay = new Date(year, month, 1);
  const lastDay = new Date(year, month + 1, 0);
  
  // Convert JS Sunday=0 ‚Üí Monday=0
  function weekday(d) {
    return (d.getDay() + 6) % 7;
  }
  
  // Build week ranges inside this month
  const monthWeeks = [];
  let current = new Date(firstDay);
  
  // Move back to Monday of the first week
  current.setDate(current.getDate() - weekday(current));
  
  while (current <= lastDay) {
    const weekStart = new Date(current);
    const weekEnd = new Date(current);
    weekEnd.setDate(weekEnd.getDate() + 7);
  
    monthWeeks.push({ weekStart, weekEnd });
  
    current.setDate(current.getDate() + 7);
  }

   const gymWeeksOfMonth = monthWeeks.map(({ weekStart, weekEnd }) =>
  logs.filter(l =>
    l?.completed === true &&
    l?.type === "gym" &&
    l?.dateCompleted &&
    new Date(l.dateCompleted) >= weekStart &&
    new Date(l.dateCompleted) < weekEnd
  ).length
);

const runWeeksOfMonth = monthWeeks.map(({ weekStart, weekEnd }) =>
  logs.filter(l =>
    l?.completed === true &&
    l?.type === "run" &&
    l?.dateCompleted &&
    new Date(l.dateCompleted) >= weekStart &&
    new Date(l.dateCompleted) < weekEnd
  ).length
);

  /* UI STATE */
  const [tab,setTab] = React.useState("home");
  const [activeDay,setActiveDay] = React.useState(dayIndex(today));
  const [popupDay,setPopupDay] = React.useState(null);

  const [showGymBuilder,setShowGymBuilder] = React.useState(false);
  const [showRunBuilder,setShowRunBuilder] = React.useState(false);

  const [activeWorkout, setActiveWorkout] = React.useState(null);

  // Weekly recurring plan
  const [gymDayIndex, setGymDayIndex] = React.useState(0);
  const [runDayIndex, setRunDayIndex] = React.useState(0);

  // Gym builder state
  const [gymName,setGymName] = React.useState("");
  const [warmupItems,setWarmupItems] = React.useState([]);
  const [exercises,setExercises] = React.useState([]);
  const [warmDownItems,setWarmDownItems] = React.useState([]);

  // Run builder state
  const [runName,setRunName] = React.useState("");
  const [runType,setRunType] = React.useState("Easy");
  const [runWarmup, setRunWarmup] = React.useState([]);
  const [runStretches, setRunStretches] = React.useState([]);
  
  const [goals, setGoals] = React.useState({
      gym: { weekly: 3, monthly: 12 },
      run: { weekly: 2, monthly: 8 }
    });
  
      function updateGoal(type, period, value) {
      setGoals(prev => ({
        ...prev,
        [type]: {
          ...prev[type],
          [period]: Number(value)
        }
      }));
    }
  /* WEEK CALC */
  const weekStart = new Date(today);
  weekStart.setDate(today.getDate() - dayIndex(today));

  const weekLogs = logs.filter(l => {
    if (!l.date) return false;
    const d = new Date(l.date);
    return d >= weekStart;
  });

  const gymWeek = weekLogs.filter(l => l.type === "gym" && l.completed).length;
  const runWeek = weekLogs.filter(l => l.type === "run" && l.completed).length;

  function logsForDate(d) {
    const idx = dayIndex(d);
    return logs.filter(l => l.dayIndex === idx);
  }
  const WorkoutScreen = (
    <div style={{ display: activeWorkout ? "block" : "none" }}>
      {activeWorkout?.type === "gym" ? (
        <GymWorkoutScreen
          activeWorkout={activeWorkout}
          setActiveWorkout={setActiveWorkout}
          logs={logs}
          setLogs={setLogs}
          handleSetComplete={handleSetComplete}
        />
      ) : activeWorkout?.type === "run" ? (
        <RunWorkoutScreen
          activeWorkout={activeWorkout}
          setActiveWorkout={setActiveWorkout}
          logs={logs}
          setLogs={setLogs}
        />
      ) : null}
    </div>
  );
  
  /* ADD GYM WORKOUT (planned) */
  function saveGymWorkout() {
    const grouped = {};

    exercises.forEach(ex => {
      const setsCount = parseInt(ex.sets);
      const reps = parseInt(ex.reps);

      if (!ex.name || !Number.isFinite(setsCount) || !Number.isFinite(reps)) return;

      if (!grouped[ex.name]) grouped[ex.name] = [];

      for (let i = 0; i < setsCount; i++) {
        grouped[ex.name].push({ weight: 0, reps, completed: false });
      }
    });

    const finalExercises = Object.entries(grouped).map(([name, sets]) => ({
      name,
      sets
    }));

    const newPlan = {
      type: "gym",
      dayIndex: gymDayIndex,
      name: gymName || "Gym Workout",
      warmup: warmupItems,
      exercises: finalExercises,
      warmdown: warmDownItems,
      completed: false
    };

    setLogs([...logs, newPlan]);
    setGymName("");
    setWarmupItems([]);
    setExercises([]);
    setWarmDownItems([]);
    setShowGymBuilder(false);
  }

  /* ADD RUN (planned) */
  function saveRun() {
    const newPlan = {
      type: "run",
      dayIndex: runDayIndex,
      name: runName || "Run",
      runType,
      warmup: runWarmup,
      stretches: runStretches,
      completed: false
    };

    setLogs([...logs, newPlan]);
    setRunName("");
    setRunType("Easy");
    setRunWarmup([]);
    setRunStretches([]);
    setShowRunBuilder(false);
  }

  /* DELETE WORKOUT (by global index) */
  function deleteLog(globalIndex){
    setLogs(logs.filter((_,i)=>i!==globalIndex));
  }
  
  function handleSetComplete(exIndex, setIndex) {
    if (!activeWorkout?.exercises) return;
  
    const updatedExercises = activeWorkout.exercises.map((ex, i) => {
      if (i !== exIndex) return ex;
  
      const updatedSets = ex.sets.map((s, j) => {
        if (j !== setIndex) return s;
        return { ...s, completed: !s.completed };
      });
  
      return { ...ex, sets: updatedSets };
    });
  
    const updatedWorkout = {
      ...activeWorkout,
      exercises: updatedExercises
    };
  
    setActiveWorkout(updatedWorkout);
  
    const toggled = updatedExercises[exIndex].sets[setIndex];
  
    if (toggled.completed) {
      startRest(settings.defaultRest || 60);
    }
  }
    
  /* HOME */
  const Home = (
    <div className="p-5 pb-40 space-y-6">
      <h1 className="text-2xl font-semibold">Hey, {settings.name}</h1>

      {/* WEEK SELECTOR */}
      <div className="flex gap-2 mt-3">
        {WEEK.map((d, i) => {
          const hasGym = logs.some(l => l.type === "gym" && l.dayIndex === i);
          const hasRun = logs.some(l => l.type === "run" && l.dayIndex === i);

          let dotColor = null;
          if (hasGym && hasRun) dotColor = "#ef4444";
          else if (hasRun) dotColor = "#38bdf8";
          else if (hasGym) dotColor = "#22c55e";

          const isToday = dayIndex(today) === i;

          return (
            <button
              key={i}
              onClick={() => {
                setActiveDay(i);
                setPopupDay(i);
              }}
              className={
                "p-3 rounded-xl soft-border flex flex-col items-center " +
                (i === activeDay ? "bg-[#1C1C1E] " : "") +
                (isToday ? "border border-white/40 bg-[#1C1C1E] " : "")
              }
            >
              <p className="text-xs">{d}</p>
              <p className={"text-sm " + (isToday ? "font-bold text-white" : "")}>
                {d.slice(0, 3)}
              </p>
              {dotColor && (
                <div
                  className="mt-1 rounded-full"
                  style={{ width: "4px", height: "4px", backgroundColor: dotColor }}
                />
              )}
            </button>
          );
        })}
      </div>

      {/* WEEK PROGRESS */}
      <div className="space-y-4 mt-4">
        <div className="p-4 bg-[#1C1C1E] rounded-2xl soft-border flex justify-between items-center">
          <div>
            <p>Gym this week</p>
            <p className="text-xs">{gymWeek}/{goals.gym.weekly}</p>
          </div>
          <Ring value={gymWeek} total={goals.gym.weekly} color={settings.gymColor} />
        </div>
      
        <div className="p-4 bg-[#1C1C1E] rounded-2xl soft-border flex justify-between items-center">
          <div>
            <p>Runs this week</p>
            <p className="text-xs">{runWeek}/{goals.run.weekly}</p>
          </div>
          <Ring value={runWeek} total={goals.run.weekly} color={settings.runColor} />
        </div>
      </div>

      {/* PLAN HEADER */}
      <p className="text-lg font-semibold mt-4">Your Plan</p>

      {/* TODAY / TOMORROW */}
      <div className="grid grid-cols-2 gap-3">
        {[0,1].map(o=>{
          const d = new Date();
          d.setDate(today.getDate()+o);
          const label = o === 0 ? "Today" : "Tomorrow";
          const dayLogs = logsForDate(d);

          return (
            <div
              key={o}
              onClick={()=>setPopupDay(dayIndex(d))}
              className="p-4 bg-[#1C1C1E] rounded-2xl soft-border space-y-2"
            >
              <p className="text-xs">{label}</p>
              <p className="font-semibold">{WEEK[dayIndex(d)]}</p>

              {dayLogs.length > 0 ? (
                dayLogs.map((l,i)=>(
                  <p key={i} className="text-xs flex items-center gap-1">
                    <span
                      className="inline-block rounded-full"
                      style={{
                        width:"4px",
                        height:"4px",
                        backgroundColor:
                          l.type === "gym" ? "#22c55e" :
                          l.type === "run" ? "#38bdf8" :
                          "#ef4444"
                      }}
                    />
                    {l.name || (l.type==="gym" ? "Gym Workout" : "Run")}
                    {l.completed && (
                      <span className="ml-1 text-[10px] text-green-400">‚úì</span>
                    )}
                  </p>
                ))
              ) : (
                <p className="text-xs text-gray-400">No workouts scheduled</p>
              )}
            </div>
          );
        })}
      </div>

      {/* QUICK ADD */}
      <div className="grid grid-cols-2 gap-3 mt-2">
        <button
          onClick={()=>{
            setGymDayIndex(activeDay);
            setShowGymBuilder(true);
          }}
          className="p-4 bg-[#1C1C1E] rounded-2xl soft-border"
        >
          ‚ûï New Workout
        </button>

        <button
          onClick={()=>{
            setRunDayIndex(activeDay);
            setShowRunBuilder(true);
          }}
          className="p-4 bg-[#1C1C1E] rounded-2xl soft-border"
        >
          ‚ûï New Run
        </button>
      </div>

      {/* MONTHLY GOALS */}
      <div className="p-4 bg-[#1C1C1E] rounded-2xl soft-border mt-2">
        <p className="font-semibold mb-2">Monthly Goals</p>
      
        <p className="text-xs">
          Gym {logs.filter(l => l.type === "gym" && l.completed).length}/{goals.gym.monthly}
        </p>
      
        <p className="text-xs">
          Run {logs.filter(l => l.type === "run" && l.completed).length}/{goals.run.monthly}
        </p>
      </div>
    </div>
  );
  
  /* CALENDAR */
  const Calendar = (() => {
    const [currentMonth, setCurrentMonth] = React.useState(() => {
      const d = new Date();
      return new Date(d.getFullYear(), d.getMonth(), 1);
    });
  
    const year = currentMonth.getFullYear();
    const month = currentMonth.getMonth();
  
    const firstDay = new Date(year, month, 1);
    const startDay = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1;
  
    const daysInMonth = new Date(year, month + 1, 0).getDate();
  
    const cells = [];
    for (let i = 0; i < 42; i++) {
      const dayNum = i - startDay + 1;
      const dateObj = new Date(year, month, dayNum);
      const valid = dayNum >= 1 && dayNum <= daysInMonth;
  
      let hasGym = false;
      let hasRun = false;
  
      if (valid) {
        const completedLogs = logs.filter(l => l.date && sameDay(l.date, dateObj));
  
        if (completedLogs.some(l => l.type === "gym")) hasGym = true;
        if (completedLogs.some(l => l.type === "run")) hasRun = true;
  
        const weekday = (dateObj.getDay() + 6) % 7;
        const plannedLogs = logs.filter(l => l.dayIndex === weekday);
  
        if (plannedLogs.some(l => l.type === "gym")) hasGym = true;
        if (plannedLogs.some(l => l.type === "run")) hasRun = true;
      }
  
      let dotColor = null;
      if (hasGym && hasRun) dotColor = "#ef4444";
      else if (hasGym) dotColor = "#22c55e";
      else if (hasRun) dotColor = "#38bdf8";
  
      const isToday = valid && sameDay(dateObj, today);
  
      cells.push({
        valid,
        dateObj,
        dayNum,
        dotColor,
        isToday
      });
    }
  
    return (
      <div className="p-5 pb-32 space-y-4">
        <div className="flex justify-between items-center">
          <button
            onClick={() =>
              setCurrentMonth(new Date(year, month - 1, 1))
            }
            className="text-xl"
          >
            ‚Äπ
          </button>
  
          <p className="text-lg font-semibold">
            {currentMonth.toLocaleString("default", { month: "long" })} {year}
          </p>
  
          <button
            onClick={() =>
              setCurrentMonth(new Date(year, month + 1, 1))
            }
            className="text-xl"
          >
            ‚Ä∫
          </button>
        </div>
  
        <div className="grid grid-cols-7 text-center text-xs text-gray-400">
          {["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map(d => (
            <p key={d}>{d}</p>
          ))}
        </div>
  
        <div className="grid grid-cols-7 gap-2 mt-2">
          {cells.map((c, i) => (
            <button
              key={i}
              disabled={!c.valid}
              onClick={() => {
                setPopupDay(dayIndex(c.dateObj));
                setActiveDay(dayIndex(c.dateObj));
              }}
              className={
                "h-14 rounded-xl flex flex-col items-center justify-center soft-border " +
                (c.valid ? "bg-[#1C1C1E]" : "opacity-20") +
                (c.isToday ? " border border-white/40" : "")
              }
            >
              <p className="text-sm">{c.valid ? c.dayNum : ""}</p>
  
              {c.dotColor && (
                <div
                  className="mt-1 rounded-full"
                  style={{
                    width: "5px",
                    height: "5px",
                    backgroundColor: c.dotColor
                  }}
                />
              )}
            </button>
          ))}
        </div>
  
        {/* ‚≠ê MONTHLY WEEK TRENDS ADDED HERE ‚≠ê */}
      <div className="p-4 bg-[#1C1C1E] rounded-2xl soft-border mt-4 space-y-4">
        <p className="font-semibold">This Month‚Äôs Weekly Trends</p>
      
        <CombinedLineGraph
          gymData={gymWeeksOfMonth}
          runData={runWeeksOfMonth}
          gymColor={settings.gymColor}
          runColor={settings.runColor}
        />
      </div>
      {/* ‚≠ê END OF ADDED SECTION ‚≠ê */}
        
            </div>
          );
        })();

  function SettingsView({ settings, setSettings, goals, updateGoal }) {
  const [tempGoals, setTempGoals] = React.useState({
    gymWeekly: goals.gym.weekly.toString(),
    gymMonthly: goals.gym.monthly.toString(),
    runWeekly: goals.run.weekly.toString(),
    runMonthly: goals.run.monthly.toString()
  });
  
  return (
    <div className="p-4 space-y-3">
      <p className="font-semibold">Settings</p>

      <input
        className="w-full p-3 rounded-xl bg-[#2C2C2E] text-base"
        value={settings.name}
        onChange={e => setSettings({ ...settings, name: e.target.value })}
        placeholder="Name"
      />

      {/* GOALS */}
      <div className="bg-[#1C1C1E] p-4 rounded-2xl soft-border space-y-6 mt-6">
        <p className="font-semibold text-base">Workout Goals</p>

        {/* GYM GOALS */}
        <div className="space-y-3">
          <p className="text-xs text-gray-400">Gym Goals</p>

          <div>
            <p className="text-[11px] text-gray-400 mb-1">Weekly Gym Goal</p>
            <input
              className="w-full bg-black rounded-xl p-2 text-base"
              value={tempGoals.gymWeekly}
              onChange={e =>
                setTempGoals(prev => ({ ...prev, gymWeekly: e.target.value }))
              }
              onBlur={() =>
                updateGoal("gym", "weekly", tempGoals.gymWeekly)
              }
            />
          </div>

          <div>
            <p className="text-[11px] text-gray-400 mb-1">Monthly Gym Goal</p>
            <input
              className="w-full bg-black rounded-xl p-2 text-base"
              value={tempGoals.gymMonthly}
              onChange={e =>
                setTempGoals(prev => ({ ...prev, gymMonthly: e.target.value }))
              }
              onBlur={() =>
                updateGoal("gym", "monthly", tempGoals.gymMonthly)
              }
            />
          </div>
        </div>

        {/* RUN GOALS */}
        <div className="space-y-3">
          <p className="text-xs text-gray-400">Run Goals</p>

          <div>
            <p className="text-[11px] text-gray-400 mb-1">Weekly Run Goal</p>
            <input
              className="w-full bg-black rounded-xl p-2 text-base"
              value={tempGoals.runWeekly}
              onChange={e =>
                setTempGoals(prev => ({ ...prev, runWeekly: e.target.value }))
              }
              onBlur={() =>
                updateGoal("run", "weekly", tempGoals.runWeekly)
              }
            />
          </div>

          <div>
            <p className="text-[11px] text-gray-400 mb-1">Monthly Run Goal</p>
            <input
              className="w-full bg-black rounded-xl p-2 text-base"
              value={tempGoals.runMonthly}
              onChange={e =>
                setTempGoals(prev => ({ ...prev, runMonthly: e.target.value }))
              }
              onBlur={() =>
                updateGoal("run", "monthly", tempGoals.runMonthly)
              }
            />
          </div>
        </div>
      </div>

      {/* REST TIMER */}
      <div className="p-4 bg-[#1C1C1E] rounded-2xl soft-border space-y-2">
        <p className="text-base font-semibold">Rest Timer (seconds)</p>
        <input
          type="number"
          min="5"
          max="300"
          value={settings.defaultRest}
          onChange={e =>
            setSettings({
              ...settings,
              defaultRest: Number(e.target.value) || 0
            })
          }
          className="w-full p-2 rounded-xl bg-[#2A2A2A] text-base"
        />
      </div>

      <button
        onClick={() => {
          localStorage.clear();
          location.reload();
        }}
        className="bg-red-500 p-3 rounded-xl text-base"
      >
        Reset App
      </button>
    </div>
  );
}
  /* DAY POPUP */
  const DayPopup = popupDay !== null ? (() => {
    const dayLogs = logs
      .map((l, i) => ({ ...l, _idx: i }))
      .filter(l => l.dayIndex === popupDay);

    return (
      <div className="fixed inset-0 bg-black/60 flex items-end justify-center z-40">
        <div className="w-full max-h-[80%] bg-[#111111] rounded-t-3xl p-5 space-y-3 overflow-y-auto">
          <div className="flex justify-between items-center mb-2">
            <p className="font-semibold text-lg">{WEEK[popupDay]} routines</p>
            <button onClick={() => setPopupDay(null)} className="text-sm text-gray-400">
              Close
            </button>
          </div>

          {dayLogs.length === 0 ? (
            <p className="text-xs text-gray-400">No workouts scheduled.</p>
          ) : (
            dayLogs.map((l, i) => (
              <div key={i} className="p-3 rounded-2xl bg-[#1C1C1E] soft-border space-y-2">
                <p className="text-sm font-semibold">
                  {l.type === "gym" ? (l.name || "Gym Workout") : (l.name || "Run")}
                  {l.completed && (
                    <span className="ml-1 text-[10px] text-green-400">‚úì Done</span>
                  )}
                </p>

                {l.type === "run" && (
                  <>
                    <p className="text-xs text-gray-400">Type: {l.runType}</p>

                    {l.warmup && l.warmup.length > 0 && (
                      <div className="mt-1">
                        <p className="text-[11px] text-gray-400 mb-1">Warm‚Äëup</p>
                        {l.warmup.map((w, j) => (
                          <p key={j} className="text-[11px]">‚Ä¢ {w.name} ({w.reps})</p>
                        ))}
                      </div>
                    )}

                    {l.stretches && l.stretches.length > 0 && (
                      <div className="mt-1">
                        <p className="text-[11px] text-gray-400 mb-1">Stretches</p>
                        {l.stretches.map((w, j) => (
                          <p key={j} className="text-[11px]">‚Ä¢ {w.name} ({w.reps})</p>
                        ))}
                      </div>
                    )}
                  </>
                )}

                {l.type === "gym" && (
                  <>
                    {l.warmup && l.warmup.length > 0 && (
                      <div className="mt-1">
                        <p className="text-[11px] text-gray-400 mb-1">Warm‚Äëup</p>
                        {l.warmup.map((w, j) => (
                          <p key={j} className="text-[11px]">‚Ä¢ {w.name} ({w.reps})</p>
                        ))}
                      </div>
                    )}

                    {l.exercises && l.exercises.length > 0 && (
                      <div className="mt-1">
                        <p className="text-[11px] text-gray-400 mb-1">Exercises</p>
                        {l.exercises.map((ex, j) => (
                          <p key={j} className="text-[11px]">
                            ‚Ä¢ {ex.name}
                            {Array.isArray(ex.sets) && ex.sets.length > 0
                              ? ` ‚Äî ${ex.sets.length} sets`
                              : ""}
                          </p>
                        ))}
                      </div>
                    )}

                    {l.warmdown && l.warmdown.length > 0 && (
                      <div className="mt-1">
                        <p className="text-[11px] text-gray-400 mb-1">Warm‚Äëdown</p>
                        {l.warmdown.map((w, j) => (
                          <p key={j} className="text-[11px]">‚Ä¢ {w.name} ({w.reps})</p>
                        ))}
                      </div>
                    )}
                  </>
                )}

                <button
                  onClick={() => {
                    setActiveWorkout({
                      ...l,
                      logIndex: l._idx,
                      date: new Date(),
                      completed: false
                    });
                    setPopupDay(null);
                  }}
                  className="w-full bg-green-600 rounded-xl py-2 text-xs"
                >
                  Start Workout
                </button>

                <button
                  onClick={() => deleteLog(l._idx)}
                  className="w-full bg-red-600 rounded-xl py-2 text-xs mt-1"
                >
                  Delete Workout
                </button>
              </div>
            ))
          )}
        </div>
      </div>
    );
  })() : null;

  /* GYM BUILDER */
  const GymBuilder = showGymBuilder ? (
    <div className="fixed inset-0 bg-black/60 flex items-end justify-center z-50">
      <div className="w-full max-h-[85%] bg-[#111111] rounded-t-3xl pt-4 px-5 pb-6 overflow-y-auto">
        <div className="flex justify-between items-center mb-4">
          <p className="font-semibold text-lg">New Gym Workout</p>
          <button
            onClick={()=>setShowGymBuilder(false)}
            className="text-sm text-gray-400"
          >
            Close
          </button>
        </div>

        {/* Routine name */}
        <div className="space-y-2 mb-4">
          <p className="text-xs text-gray-400">Routine name</p>
          <input
            className="w-full p-3 rounded-xl bg-[#2C2C2E] text-base"
            placeholder="Push Day, Legs, Upper A..."
            value={gymName}
            onChange={e=>setGymName(e.target.value)}
          />
        </div>

        {/* Warm-up */}
        <div className="space-y-2 mb-4">
          <div className="flex justify-between items-center">
            <p className="text-xs text-gray-400">Warm‚Äëup</p>
            <button
              onClick={()=>setWarmupItems([...warmupItems,{name:"",reps:""}])}
              className="text-xs text-blue-400"
            >
              + Add
            </button>
          </div>
          {warmupItems.length === 0 && (
            <p className="text-[11px] text-gray-500">No warm‚Äëup items yet.</p>
          )}
          {warmupItems.map((w,i)=>(
            <div key={i} className="flex gap-2 mb-1">
              <input
                className="flex-1 p-2 rounded-lg bg-[#2C2C2E] text-base"
                placeholder="Movement"
                value={w.name}
                onChange={e=>{
                  const next=[...warmupItems];
                  next[i]={...next[i],name:e.target.value};
                  setWarmupItems(next);
                }}
              />
              <input
                className="w-28 p-2 rounded-lg bg-[#2C2C2E] text-base"
                placeholder="Reps/time"
                value={w.reps}
                onChange={e=>{
                  const next=[...warmupItems];
                  next[i]={...next[i],reps:e.target.value};
                  setWarmupItems(next);
                }}
              />
            </div>
          ))}
        </div>

        {/* Exercises */}
        <div className="space-y-2 mb-4">
          <div className="flex justify-between items-center">
            <p className="text-xs text-gray-400">Exercises</p>
            <button
              onClick={()=>setExercises([...exercises,{name:"",sets:"",reps:""}])}
              className="text-xs text-blue-400"
            >
              + Add
            </button>
          </div>
          {exercises.length === 0 && (
            <p className="text-[11px] text-gray-500">No exercises yet.</p>
          )}
          {exercises.map((ex,i)=>(
            <div key={i} className="flex gap-2 mb-1">
              <input
                className="flex-1 p-2 rounded-lg bg-[#2C2C2E] text-base"
                placeholder="Exercise"
                value={ex.name}
                onChange={e=>{
                  const next=[...exercises];
                  next[i]={...next[i],name:e.target.value};
                  setExercises(next);
                }}
              />
              <input
                className="w-20 p-2 rounded-lg bg-[#2C2C2E] text-base"
                placeholder="Sets"
                value={ex.sets}
                onChange={e=>{
                  const next=[...exercises];
                  next[i]={...next[i],sets:e.target.value};
                  setExercises(next);
                }}
              />
              <input
                className="w-20 p-2 rounded-lg bg-[#2C2C2E] text-base"
                placeholder="Reps"
                value={ex.reps}
                onChange={e=>{
                  const next=[...exercises];
                  next[i]={...next[i],reps:e.target.value};
                  setExercises(next);
                }}
              />
            </div>
          ))}
        </div>

        {/* Warm-down */}
        <div className="space-y-2 mb-4">
          <div className="flex justify-between items-center">
            <p className="text-xs text-gray-400">Warm‚Äëdown</p>
            <button
              onClick={()=>setWarmDownItems([...warmDownItems,{name:"",reps:""}])}
              className="text-xs text-blue-400"
            >
              + Add
            </button>
          </div>
          {warmDownItems.length === 0 && (
            <p className="text-[11px] text-gray-500">No warm‚Äëdown items yet.</p>
          )}
          {warmDownItems.map((w,i)=>(
            <div key={i} className="flex gap-2 mb-1">
              <input
                className="flex-1 p-2 rounded-lg bg-[#2C2C2E] text-base"
                placeholder="Movement"
                value={w.name}
                onChange={e=>{
                  const next=[...warmDownItems];
                  next[i]={...next[i],name:e.target.value};
                  setWarmDownItems(next);
                }}
              />
              <input
                className="w-28 p-2 rounded-lg bg-[#2C2C2E] text-base"
                placeholder="Reps/time"
                value={w.reps}
                onChange={e=>{
                  const next=[...warmDownItems];
                  next[i]={...next[i],reps:e.target.value};
                  setWarmDownItems(next);
                }}
              />
            </div>
          ))}
        </div>

        {/* Day selector */}
        <div className="space-y-2 mb-6">
          <p className="text-xs text-gray-400">Day</p>
          <select
            className="w-full p-3 rounded-xl bg-[#2C2C2E] text-base"
            value={gymDayIndex}
            onChange={e => setGymDayIndex(+e.target.value)}
          >
            {WEEK.map((d, i) => (
              <option key={i} value={i}>{d}</option>
            ))}
          </select>
        </div>

        <button
          onClick={saveGymWorkout}
          className="w-full bg-blue-500 rounded-xl py-3 text-sm font-semibold"
        >
          Save Workout
        </button>
      </div>
    </div>
  ) : null;

  /* RUN BUILDER */
  const RunBuilder = showRunBuilder ? (
    <div className="fixed inset-0 bg-black/60 flex items-end justify-center z-50">
      <div className="w-full max-h-[85%] bg-[#111111] rounded-t-3xl pt-4 px-5 pb-6 overflow-y-auto">
        <div className="flex justify-between items-center mb-4">
          <p className="font-semibold text-lg">New Run</p>
          <button
            onClick={()=>setShowRunBuilder(false)}
            className="text-sm text-gray-400"
          >
            Close
          </button>
        </div>

        {/* RUN NAME */}
        <div className="space-y-2 mb-4">
          <p className="text-xs text-gray-400">Run name</p>
          <input
            className="w-full p-3 rounded-xl bg-[#2C2C2E] text-base"
            placeholder="5K Tempo, Easy Loop..."
            value={runName}
            onChange={e => setRunName(e.target.value)}
          />
        </div>

        {/* RUN TYPE */}
        <div className="space-y-2 mb-4">
          <p className="text-xs text-gray-400">Run type</p>
          <select
            className="w-full p-3 rounded-xl bg-[#2C2C2E] text-base"
            value={runType}
            onChange={e => setRunType(e.target.value)}
          >
            <option>Easy</option>
            <option>Tempo</option>
            <option>Long</option>
            <option>Other</option>
          </select>
        </div>

        {/* RUN WARM-UP */}
        <div className="space-y-2 mb-4">
          <div className="flex justify-between items-center">
            <p className="text-xs text-gray-400">Warm‚Äëup</p>
            <button
              onClick={() => setRunWarmup([...runWarmup, { name: "", reps: "" }])}
              className="text-xs text-blue-400"
            >
              + Add
            </button>
          </div>

          {runWarmup.length === 0 && (
            <p className="text-[11px] text-gray-500">No warm‚Äëup items yet.</p>
          )}

          {runWarmup.map((w, i) => (
            <div key={i} className="flex gap-2 mb-1">
              <input
                className="flex-1 p-2 rounded-lg bg-[#2C2C2E] text-base"
                placeholder="Movement"
                value={w.name}
                onChange={e => {
                  const next = [...runWarmup];
                  next[i] = { ...next[i], name: e.target.value };
                  setRunWarmup(next);
                }}
              />
              <input
                className="w-28 p-2 rounded-lg bg-[#2C2C2E] text-base"
                placeholder="Reps/time"
                value={w.reps}
                onChange={e => {
                  const next = [...runWarmup];
                  next[i] = { ...next[i], reps: e.target.value };
                  setRunWarmup(next);
                }}
              />
            </div>
          ))}
        </div>

        {/* RUN STRETCHES */}
        <div className="space-y-2 mb-6">
          <div className="flex justify-between items-center">
            <p className="text-xs text-gray-400">Stretches / Warm‚Äëdown</p>
            <button
              onClick={() => setRunStretches([...runStretches, { name: "", reps: "" }])}
              className="text-xs text-blue-400"
            >
              + Add
            </button>
          </div>

          {runStretches.length === 0 && (
            <p className="text-[11px] text-gray-500">No stretches yet.</p>
          )}

          {runStretches.map((w, i) => (
            <div key={i} className="flex gap-2 mb-1">
              <input
                className="flex-1 p-2 rounded-lg bg-[#2C2C2E] text-base"
                placeholder="Stretch"
                value={w.name}
                onChange={e => {
                  const next = [...runStretches];
                  next[i] = { ...next[i], name: e.target.value };
                  setRunStretches(next);
                }}
              />
              <input
                className="w-28 p-2 rounded-lg bg-[#2C2C2E] text-base"
                placeholder="Reps/time"
                value={w.reps}
                onChange={e => {
                  const next = [...runStretches];
                  next[i] = { ...next[i], reps: e.target.value };
                  setRunStretches(next);
                }}
              />
            </div>
          ))}
        </div>

        {/* Day selector */}
        <div className="space-y-2 mb-6">
          <p className="text-xs text-gray-400">Day</p>
          <select
            className="w-full p-3 rounded-xl bg-[#2C2C2E] text-base"
            value={runDayIndex}
            onChange={e => setRunDayIndex(+e.target.value)}
          >
            {WEEK.map((d, i) => (
              <option key={i} value={i}>{d}</option>
            ))}
          </select>
        </div>

        <button
          onClick={saveRun}
          className="w-full bg-blue-500 rounded-xl py-3 text-sm font-semibold"
        >
          Save Run
        </button>
      </div>
    </div>
  ) : null;

function GymWorkoutScreen({
  activeWorkout,
  setActiveWorkout,
  setActiveTab,
  logs,
  setLogs,
  handleSetComplete
}) {
  return (
    <div className="fixed inset-0 bg-black z-50 flex flex-col overflow-hidden">

      {/* HEADER */}
      <div className="p-5 pb-3 flex justify-between items-center">
        <p className="text-lg font-semibold">{activeWorkout?.name}</p>

        <button
          onClick={() => {
            setActiveTab("workout");   // ‚≠ê navigate back
          }}
          className="text-sm text-gray-400"
        >
          Close
        </button>
      </div>

      {/* REST TIMER */}
      {restEndTime !== null && (
        <div className="px-5">
          <div className="p-5 rounded-2xl bg-[#1C1C1E] flex flex-col items-center justify-center mb-3">
            <p className="text-sm text-gray-400">Rest</p>
            <p className="text-5xl font-bold mt-1">{timeLeft}s</p>
          </div>
        </div>
      )}

      {/* SCROLLABLE CONTENT */}
      <div className="flex-1 overflow-y-auto px-5 pb-10">

        {/* WARM-UP */}
        {activeWorkout?.warmup?.length > 0 && (
          <div className="mb-6">
            <p className="text-xs text-gray-400 mb-1">Warm‚Äëup</p>
            {activeWorkout.warmup.map((w, i) => (
              <div key={i} className="p-3 bg-[#1C1C1E] rounded-xl mb-2">
                <p className="text-sm">{w.name}</p>
                <p className="text-xs text-gray-400">{w.reps}</p>
              </div>
            ))}
          </div>
        )}

        {/* EXERCISES */}
        {Array.isArray(activeWorkout?.exercises) &&
          activeWorkout.exercises.map((ex, exIndex) => {
            const sets = Array.isArray(ex.sets) ? ex.sets : [];

            return (
              <div key={exIndex} className="mb-6">
                <p className="font-semibold mb-2">{ex.name}</p>

                {sets.length === 0 && (
                  <p className="text-xs text-gray-500">No sets added</p>
                )}

                {sets.map((set, setIndex) => (
                  <div
                    key={setIndex}
                    className="flex items-center justify-between bg-[#1C1C1E] p-3 rounded-xl mb-2"
                  >
                    <input
                      type="checkbox"
                      checked={!!set.completed}
                      onChange={() => handleSetComplete(exIndex, setIndex)}
                      className="w-5 h-5 accent-green-500"
                    />

                    <div className="flex-1 ml-3">
                      <p className="text-sm font-medium">
                        {set.reps} reps
                      </p>
                    </div>
                  </div>
                ))}
              </div>
            );
          })
        }

        {/* WARM-DOWN */}
        {activeWorkout?.warmdown?.length > 0 && (
          <div className="mb-6">
            <p className="text-xs text-gray-400 mb-1">Warm‚Äëdown</p>
            {activeWorkout.warmdown.map((w, i) => (
              <div key={i} className="p-3 bg-[#1C1C1E] rounded-xl mb-2">
                <p className="text-sm">{w.name}</p>
                <p className="text-xs text-gray-400">{w.reps}</p>
              </div>
            ))}
          </div>
        )}

        {/* MARK AS DONE */}
        <button
          onClick={() => {
            setLogs(
              logs.map((log, idx) => {
                if (idx === activeWorkout?.logIndex) {
                  return {
                    ...log,
                    completed: true,
                    date: activeWorkout?.date || new Date()
                  };
                }
                return log;
              })
            );

            setActiveTab("workout");   // ‚≠ê go back
          }}
          className="w-full bg-blue-500 py-4 rounded-2xl text-lg font-semibold mt-4"
        >
          Mark as Done
        </button>

      </div>
    </div>
  );
}
  
  /* MAIN RENDER */
/* MAIN RENDER */
return (
  <div>

    {tab === "home" && <Home />}
    {tab === "calendar" && <Calendar />}
    {tab === "settings" && (
      <SettingsView
        settings={settings}
        setSettings={setSettings}
        goals={goals}
        updateGoal={updateGoal}
      />
    )}

    {tab === "workout" && (
      <WorkoutTab
        activeWorkout={activeWorkout}
        setActiveWorkout={setActiveWorkout}
        setTab={setTab}
      />
    )}

    {tab === "execute" && (
    activeWorkout?.type === "gym" ? (
      <GymWorkoutScreen
        activeWorkout={activeWorkout}
        setActiveWorkout={setActiveWorkout}
        setActiveTab={setTab}
        logs={logs}
        setLogs={setLogs}
        handleSetComplete={handleSetComplete}
      />
    ) : (
      <RunWorkoutScreen
        activeWorkout={activeWorkout}
        setActiveWorkout={setActiveWorkout}
        setActiveTab={setTab}
        logs={logs}
        setLogs={setLogs}
      />
    )
  )}
      
    {/* Bottom Navigation */}
    <div className="fixed bottom-4 inset-x-0 flex justify-center">
      <div className="glass-nav px-6 py-2 rounded-2xl flex gap-8">
        <button onClick={() => setTab("home")}>üè†</button>
        <button onClick={() => setTab("calendar")}>üìÖ</button>
        <button onClick={() => setTab("settings")}>‚öôÔ∏è</button>
        <button onClick={() => setTab("workout")}>üí™</button>
      </div>
    </div>

    {DayPopup}
    {GymBuilder}
    {RunBuilder}

  </div>
);

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
