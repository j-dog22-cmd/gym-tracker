<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fitness Planner</title>

  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    html, body {
      height: 100%;
      background: black;
      color: white;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      margin: 0;
    }
    .soft-border { border: 1px solid rgba(255,255,255,0.08); }
    .glass-nav { background: rgba(255,255,255,0.08); backdrop-filter: blur(20px); }
  </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
/* ---------------- HELPERS ---------------- */
const WEEK = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];
const dayIndex = d => d.getDay() === 0 ? 6 : d.getDay() - 1;
const today = new Date();

function sameDay(a,b){
  const da = new Date(a), db = new Date(b);
  return da.toDateString() === db.toDateString();
}

/* ---------------- RING COMPONENT ---------------- */
function Ring({ value, total, color }) {
  const size = 52, stroke = 6;
  const r = (size - stroke) / 2;
  const c = 2 * Math.PI * r;
  return (
    <svg width={size} height={size}>
      <circle r={r} cx={size/2} cy={size/2} stroke="rgba(255,255,255,0.15)" strokeWidth={stroke} fill="none" />
      <circle
        r={r}
        cx={size/2}
        cy={size/2}
        stroke={color}
        strokeWidth={stroke}
        fill="none"
        strokeLinecap="round"
        strokeDasharray={c}
        strokeDashoffset={c * (1 - Math.min(1,value/total))}
        style={{ transform: "rotate(-90deg)", transformOrigin: "50% 50%" }}
      />
    </svg>
  );
}
/* ---------------- MAIN APP COMPONENT ---------------- */
function App() {
  /* SETTINGS */
  const [settings,setSettings] = React.useState(()=>{
    return JSON.parse(localStorage.getItem("settings")) || {
      name:"Alex",
      weeklyGym:3,
      weeklyRun:3,
      monthlyGym:12,
      monthlyRun:12,
      rest:60,
      gymColor:"#22c55e",
      runColor:"#38bdf8"
    };
  });
  React.useEffect(()=>{
    localStorage.setItem("settings",JSON.stringify(settings));
  },[settings]);

  /* LOGS */
  const [logs,setLogs] = React.useState(()=>{
    return JSON.parse(localStorage.getItem("logs")) || [];
  });
  React.useEffect(()=>{
    localStorage.setItem("logs",JSON.stringify(logs));
  },[logs]);

  /* UI STATE */
  const [tab,setTab] = React.useState("home");
  const [activeDay,setActiveDay] = React.useState(dayIndex(today));
  const [popupDay,setPopupDay] = React.useState(null);

  const [showGymBuilder,setShowGymBuilder] = React.useState(false);
  const [showRunBuilder,setShowRunBuilder] = React.useState(false);

  /* GYM BUILDER STATE */
  const [gymName,setGymName] = React.useState("");
  const [gymDayIndex,setGymDayIndex] = React.useState(dayIndex(today));
  const [warmupItems,setWarmupItems] = React.useState([]);
  const [exercises,setExercises] = React.useState([]);

  /* RUN BUILDER STATE */
  const [runName,setRunName] = React.useState("");
  const [runType,setRunType] = React.useState("Easy");
  const [runDayIndex,setRunDayIndex] = React.useState(dayIndex(today));

  /* WEEK CALCULATION */
  const weekStart = new Date(today);
  weekStart.setDate(today.getDate() - dayIndex(today));

  function dateFromWeekIndex(idx) {
    const d = new Date(weekStart);
    d.setDate(weekStart.getDate() + idx);
    return d;
  }

  const weekLogs = logs.filter(l => {
    const d = new Date(l.date);
    return d >= weekStart;
  });

  const gymWeek = weekLogs.filter(l => l.type === "gym").length;
  const runWeek = weekLogs.filter(l => l.type === "run").length;

  function logsForDate(d) {
    return logs.filter(l => sameDay(l.date,d));
  }

  /* SAVE GYM WORKOUT */
  function saveGymWorkout() {
    const date = dateFromWeekIndex(gymDayIndex);
    const newLog = {
      type: "gym",
      date,
      name: gymName || "Gym Workout",
      warmup: warmupItems,
      exercises: exercises
    };
    setLogs([...logs,newLog]);
    setGymName("");
    setWarmupItems([]);
    setExercises([]);
    setShowGymBuilder(false);
  }

  /* SAVE RUN */
  function saveRun() {
    const date = dateFromWeekIndex(runDayIndex);
    const newLog = {
      type: "run",
      date,
      name: runName || "Run",
      runType
    };
    setLogs([...logs,newLog]);
    setRunName("");
    setRunType("Easy");
    setShowRunBuilder(false);
  }

  /* DELETE WORKOUT */
  function deleteLog(globalIndex){
    setLogs(logs.filter((_,i)=>i!==globalIndex));
  }
