<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fitness Planner</title>

  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    html, body {
      height: 100%;
      background: black;
      color: white;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      margin: 0;
    }
    .soft-border { border: 1px solid rgba(255,255,255,0.08); }
    .glass-nav { background: rgba(255,255,255,0.08); backdrop-filter: blur(20px); }
  </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
/* ---------------- HELPERS ---------------- */
const WEEK = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];
const dayIndex = d => d.getDay() === 0 ? 6 : d.getDay() - 1;
const today = new Date();

function sameDay(a,b){
  const da = new Date(a), db = new Date(b);
  return da.toDateString() === db.toDateString();
}

/* ---------------- RING ---------------- */
function Ring({ value, total, color }) {
  const size = 52, stroke = 6;
  const r = (size - stroke) / 2;
  const c = 2 * Math.PI * r;
  const ratio = total > 0 ? Math.min(1, value / total) : 0;

  return (
    <svg width={size} height={size}>
      <circle
        r={r}
        cx={size/2}
        cy={size/2}
        stroke="rgba(255,255,255,0.15)"
        strokeWidth={stroke}
        fill="none"
      />
      <circle
        r={r}
        cx={size/2}
        cy={size/2}
        stroke={color}
        strokeWidth={stroke}
        fill="none"
        strokeLinecap="round"
        strokeDasharray={c}
        strokeDashoffset={c * (1 - ratio)}
        style={{ transform: "rotate(-90deg)", transformOrigin: "50% 50%" }}
      />
    </svg>
  );
}

/* ---------------- APP ---------------- */
function App() {
  /* SETTINGS */
  const [settings, setSettings] = React.useState(() => {
    return JSON.parse(localStorage.getItem("settings")) || {
      name: "Alex",
      weeklyGym: 3,
      weeklyRun: 3,
      monthlyGym: 12,
      monthlyRun: 12,
      defaultRest: 60,     // ‚Üê fixed
      gymColor: "#22c55e",
      runColor: "#38bdf8"
    };
  });
  
  React.useEffect(() => {
    localStorage.setItem("settings", JSON.stringify(settings));
  }, [settings]);

  /* LOGS */
  // logs now store both planned + completed workouts
  // completed ones are counted in the rings
  const [logs,setLogs] = React.useState(()=>{
    return JSON.parse(localStorage.getItem("logs")) || [];
  });
  React.useEffect(()=>{
    localStorage.setItem("logs",JSON.stringify(logs));
  },[logs]);

  /* UI STATE */
  const [tab,setTab] = React.useState("home");
  const [activeDay,setActiveDay] = React.useState(dayIndex(today));
  const [popupDay,setPopupDay] = React.useState(null); // index 0‚Äì6

  const [showGymBuilder,setShowGymBuilder] = React.useState(false);
  const [showRunBuilder,setShowRunBuilder] = React.useState(false);

  // Rest timer
  const [restTimer, setRestTimer] = React.useState(null);
  const [activeWorkout, setActiveWorkout] = React.useState(null);

  // Weekly recurring plan
  const [gymDayIndex, setGymDayIndex] = React.useState(0);
  const [runDayIndex, setRunDayIndex] = React.useState(0);
  
  // Gym builder state
  const [gymName,setGymName] = React.useState("");
  const [warmupItems,setWarmupItems] = React.useState([]);
  const [exercises,setExercises] = React.useState([]);
  const [warmDownItems,setWarmDownItems] = React.useState([]);
  
  // Run builder state
  const [runName,setRunName] = React.useState("");
  const [runType,setRunType] = React.useState("Easy");
  const [runWarmup, setRunWarmup] = React.useState([]);
  const [runStretches, setRunStretches] = React.useState([]);

    const finishWorkout = () => {
    setLogs(logs.map((log) => {
      if (
        sameDay(log.date, activeWorkout.date) &&
        log.name === activeWorkout.name &&
        log.type === activeWorkout.type
      ) {
        return { ...log, completed: true };
      }
      return log;
    }));
  
    setActiveWorkout(null);
    setRestTimer(null);
  };
    
  /* WEEK CALC */
  const weekStart = new Date(today);
  weekStart.setDate(today.getDate() - dayIndex(today));

  const weekLogs = logs.filter(l => {
    const d = new Date(l.date);
    return d >= weekStart;
  });

  // Rings now count ONLY completed workouts
  const gymWeek = weekLogs.filter(l => l.type === "gym" && l.completed).length;
  const runWeek = weekLogs.filter(l => l.type === "run" && l.completed).length;

  function logsForDate(d) {
  const idx = dayIndex(d);   // 0 = Monday, 1 = Tuesday, etc.
  return logs.filter(l => l.dayIndex === idx);
}

  /* ADD GYM WORKOUT (planned) */
  function saveGymWorkout() {
    const newPlan = {
      type: "gym",
      dayIndex: gymDayIndex,   // recurring weekly
      name: gymName || "Gym Workout",
      warmup: warmupItems,
      exercises,
      warmdown: warmDownItems,
      completed: false
    };
  
    setLogs([...logs, newPlan]);
    setGymName("");
    setWarmupItems([]);
    setExercises([]);
    setWarmDownItems([]);
    setShowGymBuilder(false);
  }
  
  /* ADD RUN (planned) */
  function saveRun() {
  const newPlan = {
    type: "run",
    dayIndex: runDayIndex,   // recurring weekly
    name: runName || "Run",
    runType,
    warmup: runWarmup,
    stretches: runStretches,
    completed: false
  };

  setLogs([...logs, newPlan]);
  setRunName("");
  setRunType("Easy");
  setRunWarmup([]);
  setRunStretches([]);
  setShowRunBuilder(false);
}
  /* DELETE WORKOUT (by global index) */
  function deleteLog(globalIndex){
    setLogs(logs.filter((_,i)=>i!==globalIndex));
  }
  
function handleSetComplete(exIndex, setIndex) {
  if (!activeWorkout || !activeWorkout.exercises) return;

  const updated = { ...activeWorkout, exercises: [...activeWorkout.exercises] };
  const ex = { ...updated.exercises[exIndex] };

  ex.sets = ex.sets.map((s, i) =>
    i === setIndex ? { ...s, completed: !s.completed } : s
  );

  updated.exercises[exIndex] = ex;
  setActiveWorkout(updated);

  // Start rest timer when a set is ticked ON
  const justCompleted = ex.sets[setIndex].completed;
  if (justCompleted) {
    setRestTimer(settings.defaultRest || 60);
  }
}
  /* REST TIMER COUNTDOWN */
  React.useEffect(() => {
    if (restTimer === null) return;

    if (restTimer > 0) {
      const id = setTimeout(() => {
        setRestTimer(t => t - 1);
      }, 1000);
      return () => clearTimeout(id);
    }

    if (restTimer === 0) {
      if (navigator.vibrate) navigator.vibrate(300);
    }
  }, [restTimer]);

  /* HOME */
  const Home = (
    <div className="p-5 pb-40 space-y-6">
      <h1 className="text-2xl font-semibold">Hey, {settings.name}</h1>

   {/* WEEK SELECTOR WITH DOTS + TODAY HIGHLIGHT */}
<div className="flex gap-2 mt-3">
  {WEEK.map((d, i) => {
    // Check if this weekday has recurring workouts
    const hasGym = logs.some(l => l.type === "gym" && l.dayIndex === i);
    const hasRun = logs.some(l => l.type === "run" && l.dayIndex === i);

    let dotColor = null;
    if (hasGym && hasRun) dotColor = "#ef4444";      // red
    else if (hasRun) dotColor = "#38bdf8";           // blue
    else if (hasGym) dotColor = "#22c55e";           // green

    // Today highlight
    const isToday = dayIndex(today) === i;

    return (
      <button
        key={i}
        onClick={() => {
          setActiveDay(i);
          setPopupDay(i);
        }}
        className={
          "p-3 rounded-xl soft-border flex flex-col items-center " +
          (i === activeDay ? "bg-[#1C1C1E] " : "") +
          (isToday ? "border border-white/40 bg-[#1C1C1E] " : "")
        }
      >
        <p className="text-xs">{d}</p>

        {/* Show weekday abbreviation */}
        <p className={"text-sm " + (isToday ? "font-bold text-white" : "")}>
          {d.slice(0, 3)}
        </p>

        {dotColor && (
          <div
            className="mt-1 rounded-full"
            style={{ width: "4px", height: "4px", backgroundColor: dotColor }}
          />
        )}
      </button>
    );
  })}
</div>

      {/* WEEK PROGRESS */}
      <div className="space-y-4 mt-4">
        <div className="p-4 bg-[#1C1C1E] rounded-2xl soft-border flex justify-between items-center">
          <div>
            <p>Gym this week</p>
            <p className="text-xs">{gymWeek}/{settings.weeklyGym}</p>
          </div>
          <Ring value={gymWeek} total={settings.weeklyGym} color={settings.gymColor} />
        </div>
        <div className="p-4 bg-[#1C1C1E] rounded-2xl soft-border flex justify-between items-center">
          <div>
            <p>Runs this week</p>
            <p className="text-xs">{runWeek}/{settings.weeklyRun}</p>
          </div>
          <Ring value={runWeek} total={settings.weeklyRun} color={settings.runColor} />
        </div>
      </div>

      {/* PLAN HEADER */}
      <p className="text-lg font-semibold mt-4">Your Plan</p>

      {/* TODAY / TOMORROW WITH DOTS PER WORKOUT */}
      <div className="grid grid-cols-2 gap-3">
        {[0,1].map(o=>{
          const d = new Date();
          d.setDate(today.getDate()+o);
          const label = o === 0 ? "Today" : "Tomorrow";
          const dayLogs = logsForDate(d);

          return (
            <div
              key={o}
              onClick={()=>setPopupDay(dayIndex(d))}
              className="p-4 bg-[#1C1C1E] rounded-2xl soft-border space-y-2"
            >
              <p className="text-xs">{label}</p>
              <p className="font-semibold">{WEEK[dayIndex(d)]}</p>

              {dayLogs.length > 0 ? (
                dayLogs.map((l,i)=>(
                  <p key={i} className="text-xs flex items-center gap-1">
                    <span
                      className="inline-block rounded-full"
                      style={{
                        width:"4px",
                        height:"4px",
                        backgroundColor:
                          l.type === "gym" ? "#22c55e" :
                          l.type === "run" ? "#38bdf8" :
                          "#ef4444"
                      }}
                    />
                    {l.name || (l.type==="gym" ? "Gym Workout" : "Run")}
                    {l.completed && (
                      <span className="ml-1 text-[10px] text-green-400">‚úì</span>
                    )}
                  </p>
                ))
              ) : (
                <p className="text-xs text-gray-400">No workouts scheduled</p>
              )}
            </div>
          );
        })}
      </div>

    {/* QUICK ADD */}
    <div className="grid grid-cols-2 gap-3 mt-2">
      <button
        onClick={()=>{
          setGymDayIndex(activeDay);   // use weekday index
          setShowGymBuilder(true);
        }}
        className="p-4 bg-[#1C1C1E] rounded-2xl soft-border"
      >
        ‚ûï New Workout
      </button>
    
      <button
        onClick={()=>{
          setRunDayIndex(activeDay);   // use weekday index
          setShowRunBuilder(true);
        }}
        className="p-4 bg-[#1C1C1E] rounded-2xl soft-border"
      >
        ‚ûï New Run
      </button>
    </div>
  
        {/* MONTHLY GOALS */}
        <div className="p-4 bg-[#1C1C1E] rounded-2xl soft-border mt-2">
          <p className="font-semibold mb-2">Monthly Goals</p>
          <p className="text-xs">
            Gym {logs.filter(l=>l.type==="gym" && l.completed).length}/{settings.monthlyGym}
          </p>
          <p className="text-xs">
            Run {logs.filter(l=>l.type==="run" && l.completed).length}/{settings.monthlyRun}
          </p>
        </div>
      </div>
    );

  /* PLACEHOLDER CALENDAR & SETTINGS */
 const Calendar = (() => {
  // Build a full month grid
  const [currentMonth, setCurrentMonth] = React.useState(() => {
    const d = new Date();
    return new Date(d.getFullYear(), d.getMonth(), 1);
  });

  const year = currentMonth.getFullYear();
  const month = currentMonth.getMonth();

  // First day of month
  const firstDay = new Date(year, month, 1);
  const startDay = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1;

  // Days in month
  const daysInMonth = new Date(year, month + 1, 0).getDate();

  // Build array of 42 cells (6 weeks)
  const cells = [];
  for (let i = 0; i < 42; i++) {
    const dayNum = i - startDay + 1;
    const dateObj = new Date(year, month, dayNum);
    const valid = dayNum >= 1 && dayNum <= daysInMonth;

    // Find logs for this date
    let hasGym = false;
    let hasRun = false;
    
    if (valid) {
      // 1. Completed logs (have real dates)
      const completedLogs = logs.filter(l => l.date && sameDay(l.date, dateObj));
    
      if (completedLogs.some(l => l.type === "gym")) hasGym = true;
      if (completedLogs.some(l => l.type === "run")) hasRun = true;
    
      // 2. Planned weekly logs (recurring)
      const weekday = (dateObj.getDay() + 6) % 7; // convert Sun=0 ‚Üí 6, Mon=1 ‚Üí 0
    
      const plannedLogs = logs.filter(l => l.dayIndex === weekday);
    
      if (plannedLogs.some(l => l.type === "gym")) hasGym = true;
      if (plannedLogs.some(l => l.type === "run")) hasRun = true;
    }

    let dotColor = null;
    if (hasGym && hasRun) dotColor = "#ef4444"; // both
    else if (hasGym) dotColor = "#22c55e";
    else if (hasRun) dotColor = "#38bdf8";

    const isToday = valid && sameDay(dateObj, today);

    cells.push({
      valid,
      dateObj,
      dayNum,
      dotColor,
      isToday
    });
  }

  return (
    <div className="p-5 pb-32 space-y-4">
      <div className="flex justify-between items-center">
        <button
          onClick={() =>
            setCurrentMonth(new Date(year, month - 1, 1))
          }
          className="text-xl"
        >
          ‚Äπ
        </button>

        <p className="text-lg font-semibold">
          {currentMonth.toLocaleString("default", { month: "long" })} {year}
        </p>

        <button
          onClick={() =>
            setCurrentMonth(new Date(year, month + 1, 1))
          }
          className="text-xl"
        >
          ‚Ä∫
        </button>
      </div>

      {/* Weekday labels */}
      <div className="grid grid-cols-7 text-center text-xs text-gray-400">
        {["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map(d => (
          <p key={d}>{d}</p>
        ))}
      </div>

      {/* Calendar grid */}
      <div className="grid grid-cols-7 gap-2 mt-2">
        {cells.map((c, i) => (
          <button
            key={i}
            disabled={!c.valid}
            onClick={() => {
              setPopupDay(dayIndex(c.dateObj));
              setActiveDay(dayIndex(c.dateObj));
            }}
            className={
              "h-14 rounded-xl flex flex-col items-center justify-center soft-border " +
              (c.valid ? "bg-[#1C1C1E]" : "opacity-20") +
              (c.isToday ? " border border-white/40" : "")
            }
          >
            <p className="text-sm">{c.valid ? c.dayNum : ""}</p>

            {c.dotColor && (
              <div
                className="mt-1 rounded-full"
                style={{
                  width: "5px",
                  height: "5px",
                  backgroundColor: c.dotColor
                }}
              />
            )}
          </button>
        ))}
      </div>
    </div>
  );
})();;

  const SettingsView = (
    <div className="p-4 space-y-3">
      <p className="font-semibold">Settings</p>
      <input
        className="w-full p-3 rounded-xl bg-[#2C2C2E] text-base"
        value={settings.name}
        onChange={e=>setSettings({...settings,name:e.target.value})}
        placeholder="Name"
      />

      <div className="p-4 bg-[#1C1C1E] rounded-2xl soft-border space-y-2">
        <p className="text-sm font-semibold">Rest Timer (seconds)</p>
        <input
          type="number"
          min="5"
          max="300"
          value={settings.rest}
          onChange={e => setSettings({...settings, rest: Number(e.target.value)})}
          className="w-full p-2 rounded-xl bg-[#2A2A2A] text-sm"
        />
      </div>

      <button
        onClick={()=>{
          localStorage.clear();
          location.reload();
        }}
        className="bg-red-500 p-3 rounded-xl text-sm"
      >
        Reset App
      </button>
    </div>
  );

  /* DAY POPUP WITH START + DELETE */
const DayPopup = popupDay !== null ? (() => {
  // popupDay is already a weekday index (0‚Äì6)
  const dayLogs = logs
    .map((l, i) => ({ ...l, _idx: i }))
    .filter(l => l.dayIndex === popupDay);   // match by weekday, not date

  return (
    <div className="fixed inset-0 bg-black/60 flex items-end justify-center z-40">
      <div className="w-full max-h-[80%] bg-[#111111] rounded-t-3xl p-5 space-y-3 overflow-y-auto">
        <div className="flex justify-between items-center mb-2">
          <p className="font-semibold text-lg">{WEEK[popupDay]} routines</p>
          <button onClick={() => setPopupDay(null)} className="text-sm text-gray-400">
            Close
          </button>
        </div>

        {dayLogs.length === 0 ? (
          <p className="text-xs text-gray-400">No workouts scheduled.</p>
        ) : (
          dayLogs.map((l, i) => (
            <div key={i} className="p-3 rounded-2xl bg-[#1C1C1E] soft-border space-y-2">
              {/* TITLE */}
              <p className="text-sm font-semibold">
                {l.type === "gym" ? (l.name || "Gym Workout") : (l.name || "Run")}
                {l.completed && (
                  <span className="ml-1 text-[10px] text-green-400">‚úì Done</span>
                )}
              </p>

              {/* RUN SECTION */}
              {l.type === "run" && (
                <>
                  <p className="text-xs text-gray-400">Type: {l.runType}</p>

                  {l.warmup && l.warmup.length > 0 && (
                    <div className="mt-1">
                      <p className="text-[11px] text-gray-400 mb-1">Warm‚Äëup</p>
                      {l.warmup.map((w, j) => (
                        <p key={j} className="text-[11px]">‚Ä¢ {w.name} ({w.reps})</p>
                      ))}
                    </div>
                  )}

                  {l.stretches && l.stretches.length > 0 && (
                    <div className="mt-1">
                      <p className="text-[11px] text-gray-400 mb-1">Stretches</p>
                      {l.stretches.map((w, j) => (
                        <p key={j} className="text-[11px]">‚Ä¢ {w.name} ({w.reps})</p>
                      ))}
                    </div>
                  )}
                </>
              )}

              {/* GYM SECTION */}
              {l.type === "gym" && (
                <>
                  {l.warmup && l.warmup.length > 0 && (
                    <div className="mt-1">
                      <p className="text-[11px] text-gray-400 mb-1">Warm‚Äëup</p>
                      {l.warmup.map((w, j) => (
                        <p key={j} className="text-[11px]">‚Ä¢ {w.name} ({w.reps})</p>
                      ))}
                    </div>
                  )}

                  {l.exercises && l.exercises.length > 0 && (
                    <div className="mt-1">
                      <p className="text-[11px] text-gray-400 mb-1">Exercises</p>
                      {l.exercises.map((ex, j) => (
                        <p key={j} className="text-[11px]">
                          ‚Ä¢ {ex.name} ‚Äî {ex.sets} x {ex.reps}
                        </p>
                      ))}
                    </div>
                  )}

                  {l.warmdown && l.warmdown.length > 0 && (
                    <div className="mt-1">
                      <p className="text-[11px] text-gray-400 mb-1">Warm‚Äëdown</p>
                      {l.warmdown.map((w, j) => (
                        <p key={j} className="text-[11px]">‚Ä¢ {w.name} ({w.reps})</p>
                      ))}
                    </div>
                  )}
                </>
              )}

              {/* START WORKOUT */}
              <button
                onClick={() => {
                  setActiveWorkout({
                    ...l,
                    date: new Date(),   // actual workout date when you start it
                    completed: false
                  });
                  setRestTimer(null);
                  setPopupDay(null);
                }}
                className="w-full bg-green-600 rounded-xl py-2 text-xs"
              >
                Start Workout
              </button>

              {/* DELETE BUTTON */}
              <button
                onClick={() => deleteLog(l._idx)}
                className="w-full bg-red-600 rounded-xl py-2 text-xs mt-1"
              >
                Delete Workout
              </button>
            </div>
          ))
        )}
      </div>
    </div>
  );
})() : null;

  /* BOTTOM-SHEET GYM BUILDER */
  const GymBuilder = showGymBuilder ? (
    <div className="fixed inset-0 bg-black/60 flex items-end justify-center z-50">
      <div className="w-full max-h-[85%] bg-[#111111] rounded-t-3xl pt-4 px-5 pb-6 overflow-y-auto">
        <div className="flex justify-between items-center mb-4">
          <p className="font-semibold text-lg">New Gym Workout</p>
          <button
            onClick={()=>setShowGymBuilder(false)}
            className="text-sm text-gray-400"
          >
            Close
          </button>
        </div>

        {/* Routine name */}
        <div className="space-y-2 mb-4">
          <p className="text-xs text-gray-400">Routine name</p>
          <input
            className="w-full p-3 rounded-xl bg-[#2C2C2E] text-base"
            placeholder="Push Day, Legs, Upper A..."
            value={gymName}
            onChange={e=>setGymName(e.target.value)}
          />
        </div>

        {/* Warm-up */}
        <div className="space-y-2 mb-4">
          <div className="flex justify-between items-center">
            <p className="text-xs text-gray-400">Warm‚Äëup</p>
            <button
              onClick={()=>setWarmupItems([...warmupItems,{name:"",reps:""}])}
              className="text-xs text-blue-400"
            >
              + Add
            </button>
          </div>
          {warmupItems.length === 0 && (
            <p className="text-[11px] text-gray-500">No warm‚Äëup items yet.</p>
          )}
          {warmupItems.map((w,i)=>(
            <div key={i} className="flex gap-2 mb-1">
              <input
                className="flex-1 p-2 rounded-lg bg-[#2C2C2E] text-base"
                placeholder="Movement"
                value={w.name}
                onChange={e=>{
                  const next=[...warmupItems];
                  next[i]={...next[i],name:e.target.value};
                  setWarmupItems(next);
                }}
              />
              <input
                className="w-28 p-2 rounded-lg bg-[#2C2C2E] text-base"
                placeholder="Reps/time"
                value={w.reps}
                onChange={e=>{
                  const next=[...warmupItems];
                  next[i]={...next[i],reps:e.target.value};
                  setWarmupItems(next);
                }}
              />
            </div>
          ))}
        </div>

        {/* Exercises */}
        <div className="space-y-2 mb-4">
          <div className="flex justify-between items-center">
            <p className="text-xs text-gray-400">Exercises</p>
            <button
              onClick={()=>setExercises([...exercises,{name:"",sets:"",reps:""}])}
              className="text-xs text-blue-400"
            >
              + Add
            </button>
          </div>
          {exercises.length === 0 && (
            <p className="text-[11px] text-gray-500">No exercises yet.</p>
          )}
          {exercises.map((ex,i)=>(
            <div key={i} className="flex gap-2 mb-1">
              <input
                className="flex-1 p-2 rounded-lg bg-[#2C2C2E] text-base"
                placeholder="Exercise"
                value={ex.name}
                onChange={e=>{
                  const next=[...exercises];
                  next[i]={...next[i],name:e.target.value};
                  setExercises(next);
                }}
              />
              <input
                className="w-20 p-2 rounded-lg bg-[#2C2C2E] text-base"
                placeholder="Sets"
                value={ex.sets}
                onChange={e=>{
                  const next=[...exercises];
                  next[i]={...next[i],sets:e.target.value};
                  setExercises(next);
                }}
              />
              <input
                className="w-20 p-2 rounded-lg bg-[#2C2C2E] text-base"
                placeholder="Reps"
                value={ex.reps}
                onChange={e=>{
                  const next=[...exercises];
                  next[i]={...next[i],reps:e.target.value};
                  setExercises(next);
                }}
              />
            </div>
          ))}
        </div>

        {/* Warm-down */}
        <div className="space-y-2 mb-4">
          <div className="flex justify-between items-center">
            <p className="text-xs text-gray-400">Warm‚Äëdown</p>
            <button
              onClick={()=>setWarmDownItems([...warmDownItems,{name:"",reps:""}])}
              className="text-xs text-blue-400"
            >
              + Add
            </button>
          </div>
          {warmDownItems.length === 0 && (
            <p className="text-[11px] text-gray-500">No warm‚Äëdown items yet.</p>
          )}
          {warmDownItems.map((w,i)=>(
            <div key={i} className="flex gap-2 mb-1">
              <input
                className="flex-1 p-2 rounded-lg bg-[#2C2C2E] text-base"
                placeholder="Movement"
                value={w.name}
                onChange={e=>{
                  const next=[...warmDownItems];
                  next[i]={...next[i],name:e.target.value};
                  setWarmDownItems(next);
                }}
              />
              <input
                className="w-28 p-2 rounded-lg bg-[#2C2C2E] text-base"
                placeholder="Reps/time"
                value={w.reps}
                onChange={e=>{
                  const next=[...warmDownItems];
                  next[i]={...next[i],reps:e.target.value};
                  setWarmDownItems(next);
                }}
              />
            </div>
          ))}
        </div>

        {/* Day selector */}
        <div className="space-y-2 mb-6">
          <p className="text-xs text-gray-400">Day</p>
          <select
            className="w-full p-3 rounded-xl bg-[#2C2C2E] text-base"
            value={gymDayIndex}
            onChange={e => setGymDayIndex(+e.target.value)}
          >
            {WEEK.map((d, i) => (
              <option key={i} value={i}>{d}</option>
            ))}
          </select>
        </div>

        <button
          onClick={saveGymWorkout}
          className="w-full bg-blue-500 rounded-xl py-3 text-sm font-semibold"
        >
          Save Workout
        </button>
      </div>
    </div>
  ) : null;

  /* BOTTOM-SHEET RUN BUILDER */
  const RunBuilder = showRunBuilder ? (
    <div className="fixed inset-0 bg-black/60 flex items-end justify-center z-50">
      <div className="w-full max-h-[85%] bg-[#111111] rounded-t-3xl pt-4 px-5 pb-6 overflow-y-auto">
        {/* HEADER */}
        <div className="flex justify-between items-center mb-4">
          <p className="font-semibold text-lg">New Run</p>
          <button
            onClick={()=>setShowRunBuilder(false)}
            className="text-sm text-gray-400"
          >
            Close
          </button>
        </div>

        {/* RUN NAME */}
        <div className="space-y-2 mb-4">
          <p className="text-xs text-gray-400">Run name</p>
          <input
            className="w-full p-3 rounded-xl bg-[#2C2C2E] text-base"
            placeholder="5K Tempo, Easy Loop..."
            value={runName}
            onChange={e => setRunName(e.target.value)}
          />
        </div>

        {/* RUN TYPE */}
        <div className="space-y-2 mb-4">
          <p className="text-xs text-gray-400">Run type</p>
          <select
            className="w-full p-3 rounded-xl bg-[#2C2C2E] text-base"
            value={runType}
            onChange={e => setRunType(e.target.value)}
          >
            <option>Easy</option>
            <option>Tempo</option>
            <option>Long</option>
            <option>Other</option>
          </select>
        </div>

        {/* RUN WARM-UP */}
        <div className="space-y-2 mb-4">
          <div className="flex justify-between items-center">
            <p className="text-xs text-gray-400">Warm‚Äëup</p>
            <button
              onClick={() => setRunWarmup([...runWarmup, { name: "", reps: "" }])}
              className="text-xs text-blue-400"
            >
              + Add
            </button>
          </div>

          {runWarmup.length === 0 && (
            <p className="text-[11px] text-gray-500">No warm‚Äëup items yet.</p>
          )}

          {runWarmup.map((w, i) => (
            <div key={i} className="flex gap-2 mb-1">
              <input
                className="flex-1 p-2 rounded-lg bg-[#2C2C2E] text-base"
                placeholder="Movement"
                value={w.name}
                onChange={e => {
                  const next = [...runWarmup];
                  next[i] = { ...next[i], name: e.target.value };
                  setRunWarmup(next);
                }}
              />
              <input
                className="w-28 p-2 rounded-lg bg-[#2C2C2E] text-base"
                placeholder="Reps/time"
                value={w.reps}
                onChange={e => {
                  const next = [...runWarmup];
                  next[i] = { ...next[i], reps: e.target.value };
                  setRunWarmup(next);
                }}
              />
            </div>
          ))}
        </div>

        {/* RUN STRETCHES / WARM-DOWN */}
        <div className="space-y-2 mb-6">
          <div className="flex justify-between items-center">
            <p className="text-xs text-gray-400">Stretches / Warm‚Äëdown</p>
            <button
              onClick={() => setRunStretches([...runStretches, { name: "", reps: "" }])}
              className="text-xs text-blue-400"
            >
              + Add
            </button>
          </div>

          {runStretches.length === 0 && (
            <p className="text-[11px] text-gray-500">No stretches yet.</p>
          )}

          {runStretches.map((w, i) => (
            <div key={i} className="flex gap-2 mb-1">
              <input
                className="flex-1 p-2 rounded-lg bg-[#2C2C2E] text-base"
                placeholder="Stretch"
                value={w.name}
                onChange={e => {
                  const next = [...runStretches];
                  next[i] = { ...next[i], name: e.target.value };
                  setRunStretches(next);
                }}
              />
              <input
                className="w-28 p-2 rounded-lg bg-[#2C2C2E] text-base"
                placeholder="Reps/time"
                value={w.reps}
                onChange={e => {
                  const next = [...runStretches];
                  next[i] = { ...next[i], reps: e.target.value };
                  setRunStretches(next);
                }}
              />
            </div>
          ))}
        </div>

        {/* Day selector */}
        <div className="space-y-2 mb-6">
          <p className="text-xs text-gray-400">Day</p>
          <select
            className="w-full p-3 rounded-xl bg-[#2C2C2E] text-base"
            value={runDayIndex}
            onChange={e => setRunDayIndex(+e.target.value)}
          >
            {WEEK.map((d, i) => (
              <option key={i} value={i}>{d}</option>
            ))}
          </select>
        </div>

        {/* SAVE BUTTON */}
        <button
          onClick={saveRun}
          className="w-full bg-blue-500 rounded-xl py-3 text-sm font-semibold"
        >
          Save Run
        </button>
      </div>
    </div>

  /* WORKOUT SCREEN */
const WorkoutScreen = activeWorkout ? (
  <div className="fixed inset-0 bg-black z-50 p-5 overflow-y-auto">

    {/* HEADER */}
    <div className="flex justify-between items-center mb-4">
      <p className="text-lg font-semibold">{activeWorkout.name}</p>
      <button
        onClick={() => {
          setActiveWorkout(null);
          setRestTimer(null);
        }}
        className="text-sm text-gray-400"
      >
        Close
      </button>
    </div>

    {/* SAFE EXERCISE RENDERING */}
    {Array.isArray(activeWorkout.exercises) && activeWorkout.exercises.map((ex, exIndex) => {
      const sets = Array.isArray(ex.sets) ? ex.sets : [];

      return (
        <div key={exIndex} className="mb-4">
          <p className="font-semibold mb-2">{ex.name}</p>

          {sets.length === 0 && (
            <p className="text-xs text-gray-500">No sets added</p>
          )}

          {sets.map((set, setIndex) => (
            <div key={setIndex} className="flex items-center gap-2 mb-1">
              <input
                type="checkbox"
                checked={set.completed}
                onChange={() => handleSetComplete(exIndex, setIndex)}
                className="w-5 h-5 accent-green-500"
              />
              <p className="text-sm">{set.weight}kg √ó {set.reps}</p>
            </div>
          ))}
        </div>
      );
    })}

    {/* REST TIMER */}
    {restTimer !== null && (
      <div className="mt-4 p-3 rounded-xl bg-[#1C1C1E] flex items-center justify-between">
        <p className="text-xs text-gray-300">Rest</p>
        <p className="text-lg font-semibold">{restTimer}s</p>
      </div>
    )}

    {/* FINISH WORKOUT */}
    <button
      onClick={finishWorkout}
      className="w-full bg-green-600 rounded-xl py-3 text-sm font-semibold mt-4"
    >
      Mark as Done
    </button>

    {/* GYM WORKOUT EXECUTION */}
    {activeWorkout.type === "gym" && (
      <div className="space-y-4 mt-6">

        {/* Warm-up */}
        {activeWorkout.warmup?.length > 0 && (
          <div>
            <p className="text-xs text-gray-400 mb-1">Warm‚Äëup</p>
            {activeWorkout.warmup.map((w,i)=>(
              <div key={i} className="p-3 bg-[#1C1C1E] rounded-xl mb-2">
                <p className="text-sm">{w.name}</p>
                <p className="text-xs text-gray-400">{w.reps}</p>
              </div>
            ))}
          </div>
        )}

        {/* Warm-down */}
        {activeWorkout.warmdown?.length > 0 && (
          <div>
            <p className="text-xs text-gray-400 mb-1">Warm‚Äëdown</p>
            {activeWorkout.warmdown.map((w,i)=>(
              <div key={i} className="p-3 bg-[#1C1C1E] rounded-xl mb-2">
                <p className="text-sm">{w.name}</p>
                <p className="text-xs text-gray-400">{w.reps}</p>
              </div>
            ))}
          </div>
        )}

      </div>
    )}

    {/* RUN WORKOUT EXECUTION */}
    {activeWorkout.type === "run" && (
      <div className="space-y-4 mt-6">
        <p className="text-xs text-gray-400">Type: {activeWorkout.runType}</p>

        {/* Warm-up */}
        {activeWorkout.warmup?.length > 0 && (
          <div>
            <p className="text-xs text-gray-400 mb-1">Warm‚Äëup</p>
            {activeWorkout.warmup.map((w,i)=>(
              <div key={i} className="p-3 bg-[#1C1C1E] rounded-xl mb-2">
                <p className="text-sm">{w.name}</p>
                <p className="text-xs text-gray-400">{w.reps}</p>
              </div>
            ))}
          </div>
        )}

        {/* Stretches */}
        {activeWorkout.stretches?.length > 0 && (
          <div>
            <p className="text-xs text-gray-400 mb-1">Stretches</p>
            {activeWorkout.stretches.map((w,i)=>(
              <div key={i} className="p-3 bg-[#1C1C1E] rounded-xl mb-2">
                <p className="text-sm">{w.name}</p>
                <p className="text-xs text-gray-400">{w.reps}</p>
              </div>
            ))}
          </div>
        )}
      </div>
    )}

    {/* MARK AS DONE FOR RUN */}
    <button
      onClick={() => {
        setLogs(logs.map((log, idx) => {
          if (
            sameDay(log.date, activeWorkout.date) &&
            log.name === activeWorkout.name &&
            log.type === activeWorkout.type
          ) {
            return {...log, completed: true};
          }
          return log;
        }));
        setActiveWorkout(null);
        setRestTimer(null);
      }}
      className="w-full bg-blue-500 py-4 rounded-2xl text-lg font-semibold mt-6"
    >
      Mark as Done
    </button>

  </div>
) : null;

  return (
    <div>
      {tab==="home" && Home}
      {tab==="calendar" && Calendar}
      {tab==="settings" && SettingsView}

      {WorkoutScreen}

      <div className="fixed bottom-4 inset-x-0 flex justify-center">
        <div className="glass-nav px-6 py-2 rounded-2xl flex gap-8">
          <button onClick={()=>setTab("home")}>üè†</button>
          <button onClick={()=>setTab("calendar")}>üìÖ</button>
          <button onClick={()=>setTab("settings")}>‚öôÔ∏è</button>
        </div>
      </div>

      {DayPopup}
      {GymBuilder}
      {RunBuilder}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
